{"title":"บันทึกปัญหาเรื่อง Network ใน Docker compose","link":"https://www.somkiat.cc/problem-network-in-docker-compose/","date":1620467516000,"content":"<p><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/05/docker-network-150x150.jpg\" /></p>\n<figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/05/docker-network.jpg\" /></figure>\n\n\n\n<p><strong>ปัญหา</strong></p>\n\n\n\n<p>ทำการพัฒนาระบบงานด้วย NodeJS <br />ทำงานร่วมกับ MySQL ผ่าน ORM library ชื่อว่า <a href=\"https://sequelize.org/\" target=\"_blank\">Sequelize</a><br />ในการ build และ run สำหรับการพัฒนา จะใช้งาน Docker compose<br />แต่ตอน run เจอปัญหา การเชื่อมต่อไปยัง MySQL ดังนี้</p>\n\n\n\n<span></span>\n\n\n\n[gist id=\"c46ad8902e80c47ed2d9d88cdd45b83a\" file=\"1.txt\"]\n\n\n\n<p><strong>เพิ่มเติมเกี่ยวกับ config การเชื่อมต่อไปยัง MySQL จาก NodeJS ดังนี้</strong></p>\n\n\n\n[gist id=\"c46ad8902e80c47ed2d9d88cdd45b83a\" file=\"config.json\"]\n\n\n\n<p><strong>ส่วน Docker compose file เป็นดังนี้</strong></p>\n\n\n\n[gist id=\"c46ad8902e80c47ed2d9d88cdd45b83a\" file=\"docker-compose.yml\"]\n\n\n\n<p><strong>Environment ที่ใช้งาน ประกอบไปด้วย</strong></p>\n\n\n\n<ul><li>Mac OS</li><li>Docker Desktop 3.3.1</li></ul>\n\n\n\n<p><strong>วิธีการแก้ไขเบื้องต้น</strong></p>\n\n\n\n<p>เป็นปัญหาที่แปลกดี เพราะว่า<br />การใช้ docker compose นั้น ทุก ๆ service นั้น<br />จะใช้งาน network เดียวกันอยู่แล้ว<br />น่าจะติดต่อสื่อสารกันได้สิ<br />เพราะว่าใน configuration file ก็อ้างถึงชื่อ service เลย</p>\n\n\n\n<p>แต่จาก error message แล้ว แสดงว่า<br />ตัว sequlize พยายาม resolve IP ไปยัง 127.0.0.1 เสมอ<br />หรือว่าเป็นเพราะตัว sequlize เอง !!</p>\n\n\n\n<p>ส่วนการแก้ไขปัญหาเฉพาะหน้าหรือง่าย ๆ คือ<br />การเพิ่ม <strong><a href=\"https://docs.docker.com/compose/compose-file/compose-file-v3/#network_mode\" target=\"_blank\">network_mode ใน Docker compose file</a></strong> ไปเลย<br />ซึ่งทำการ config ได้หลายรูปแบบ ดังนี้</p>\n\n\n\n<ul><li>container:&lt;container id&gt;</li><li>service:&lt;service name&gt;</li><li>bridge/host/none</li></ul>\n\n\n\n<p>ส่วนที่เลือกใช้คือ service ไปเลย ดังนี้</p>\n\n\n\n[gist id=\"c46ad8902e80c47ed2d9d88cdd45b83a\" file=\"docker-compose1.yml\"]\n\n\n\n<p>ทำให้สามารถทำงานต่อไปได้แล้ว</p>\n","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"7e1de8f04ee1305cb1c1729585d0b2928e50075a97dd1c411413e1ab09a33d98","category":"Thai"}