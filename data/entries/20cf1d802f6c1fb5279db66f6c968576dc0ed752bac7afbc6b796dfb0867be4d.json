{"title":"[ESP8266-Sonoff] มาลอง TASMOTA firmware สำหรับ Sonoff กันครับ","link":"https://thanapon.info/sonoff-tasmota/","date":1574860165000,"content":"<p>สวัสดีครับหลังจากที่หายไปหลายเดือน</p>\n\n\n\n<p>พอดีได้มีโอกาสไปลองเล่น Sonoff มา ซึ่งรุ่นที่ได้ลองจะเป็น Module Sonoff Basic ลักษณะจะคล้ายๆกับบัลลาสต์เลยครับแต่ขนาดตัวจะเล็กกว่าประมาณครึ่งเลยที่เดียวครับ โดยปกติแล้วหลักจากที่เราซื้อ Sonoff มาทางผู้ผลิตเขาก็ได้ให้แอพพลิเคชั่นมาด้วยชื่อว่า eWeLink รองรับทั้ง Android และ iOS นะครับสามารถลองโหลดมาเล่นได้ซึ่งภายในแอพจะเป็นควบคุมการเปิด-ปิดไฟตามสไตล์ของ Smart Home ครับ</p>\n\n\n\n<div><figure><img src=\"https://miro.medium.com/max/500/0*R0xEVc6P_0YHMeCB.jpg\" /></figure></div>\n\n\n\n<p>อุปกรณ์หลักๆภายใน Sonoff Basic รุ่นนี้จะใช้ ESP8266, Relay Module และ Power Supply สำหรับแปลงไฟ 220 VAC ไป 5 VDC ส่วนตารางข้างล่างนี้จะเป็นสเปคคร่าวๆนะครับ</p>\n\n\n\n<div><figure><img src=\"https://miro.medium.com/max/652/1*yM9WzoMthL59pI1FQvCIXg.png\" /></figure></div>\n\n\n\n<p>เข้าเรื่องเลยละกันครับ จากรูป Schematic ของ Sonoff Basic ข้างบนเราจะสังเกตเห็นว่า เอ๊ะ มันมีพอร์ทสำหรับ UART หรือ Serial-TTL ให้เราด้วยซึ่งถ้าคนที่เคยเรียนรู้เกี่ยวกับ Hardware มาจะเข้าใจว่าเป็นพอร์ทสำหรับการส่งข้อมูลและรับข้อมูลสำหรับ Microcontroller นะครับ ใช่ครับ! หลักจากนั้นผมก็ได้ตามไปศึกษาเกี่ยวกับ sonoff แล้วก็ได้พบว่าเราสามารถสร้าง Custom Firmware ของเราขึ้นมาได้เอง แต่วันนี่เราคงไม่พูดถึงนะครับ</p>\n\n\n\n<p>โดยวันนี้ผมจะมาแนะนำ Firmware ที่คิดว่าความสามารถครอบคลุมในเรื่องของ Smart Home ชื่อว่า <strong>Tasmota</strong> กันนะครับ</p>\n\n\n\n<h2><strong>What is Tasmota ?</strong></h2>\n\n\n\n<p>Tasmota คือ Opensouce Firmware สำหรับ ESP8266 ซึ่งถูกสร้างขึ้นมาสำหรับ Sonoff โดยเฉพาะสามารถรองรับ Sonoff ได้หลายๆโมดูลครับไม่ว่าจะเป็น Sonoff Basic, Sonoff T1 1Ch จนถึง Sonoff T1 3Ch ครับ จริงๆสามารถเข้าไปเช็คดูว่า Firmware นี้ Compatibility รุ่นไหนบ้างได้จากตรงนี้เลยครับ &gt;&gt; <a href=\"https://github.com/arendst/Tasmota/wiki/Modules\">Sonoff Module Compatibility</a></p>\n\n\n\n<p>Firmware Tasmota นี้จะเพิ่มความสามารถให้ Sonoff ของเราคือ</p>\n\n\n\n<ul><li>Web UI config</li><li>Control over MQTT, HTTP</li><li>Timer, Schedule</li><li>Web Admin Authentication</li><li>OTA firmware update</li><li>Integration with Smart home System: Home Assistant</li></ul>\n\n\n\n<p>เนื่องจากเป็น Opensorce Firmware ทาง Developer เขาก็ได้แจก code มาด้วย ผู้ใช้งานสามารถแก้ไข source code ได้ผ่าน Arduino IDE และ Platform IO ด้วยครับ</p>\n\n\n\n<h2>Requirement</h2>\n\n\n\n<ul><li>Sonoff Basic</li><li>USB to Serial</li><li>Single Row Male Pin Header</li><li>Soldering Iron &amp; Soldering Lead</li><li>Firmware Flashing Tool : <a href=\"https://github.com/espressif/esptool/releases\">Esptool.py</a></li><li><a href=\"https://github.com/arendst/Tasmota/releases/download/v6.7.1/sonoff-basic.bin\">Tasmota Firmware</a></li></ul>\n\n\n\n<h2>ของพร้อมคนพร้อมเริ่มกันเลยนะครับ</h2>\n\n\n\n<ul><li>แกะ Sonoff ให้เหลือแค่บอร์ดสีเขียวๆกันก่อนนะครับ</li><li>จากนั้นให้นำก้างปลาตัวผู้มาเสียบที่รู 4 รู เล็กๆ ซึ่งจะอยู่ใกล้ๆกับตัวเก็บประจุและปุ่มกด</li><li>บัดกรีไปเลยครับ เป็นอันเสร็จขั้นตอนการเตรียมอุปกรณ์ หลังจากนั้นไปยังฝั่งซอร์ฟแวร์บ้าง</li></ul>\n\n\n\n<div><figure><img src=\"https://miro.medium.com/max/321/1*VBF8-H-cYDXUISPo3x4Ndg.png\" /></figure></div>\n\n\n\n<ul><li>ต่อสายระหว่าง USB to Serial กับ Sonoff Basic ก่อนนะครับ<br /><strong>**ในระหว่างต่อสาย USB to Serial ห้ามต่อ Sonoff เข้ากับไฟบ้านโดยเด็ดขาดนะครับ และควรใช้ USB to Serial แบบที่ VCC = 3.3v นะครับเพราะถ้ามากกว่านี้อาจจะไปทำลาย Microcontroller ของ Sonoff ได้ครับ**</strong></li></ul>\n\n\n\n<div><figure><img src=\"https://miro.medium.com/max/351/1*vRRV9E_8-Bu0EbSRfSRGOg.png\" /></figure></div>\n\n\n\n<div><figure><img src=\"https://miro.medium.com/max/421/1*r5DK8yV_gi7R5yfGHSCgmA.png\" /></figure></div>\n\n\n\n<ul><li>หลังจากต่อสายเสร็จแล้วให้เรานำ USB to Serial เสียบเข้ากับคอมพิวเตอร์ของเราเพื่อจะทำการอัพโหลดเฟิร์มแวร์ <strong>โดยก่อนจะเสียบเข้ากับคอมนั้นให้เรากดปุ่มที่อยู่บนบอร์ดก่อนเพื่อให้ Sonoff ของเราเข้าสู่โหมด Upload ก่อนครับ วิธีกดก็กดค้างไว้เลยพร้อมกับเสียบสาย USB to Serial</strong></li></ul>\n\n\n\n<div><figure><img src=\"https://miro.medium.com/max/494/1*fGj-UGWw7pFyoCeaF0kRHQ.png\" /></figure></div>\n\n\n\n<ul><li>เมื่อ Sonoff Basic ของเราพร้อมสำหรับการอัพโหลดแล้วให้เราทดสอบโดยการใช้ esptool เช็คค่า MAC Address ของ Sonoff ก่อน <strong>หลังจากที่ได้ MAC Address มา Sonoff จะ Reset ตัวเองด้วยนะครับ ฉะนั้นเราจำเป็นต้องทำการเสียบ USB to Serial ใหม่พร้อมกับกดปุ่มด้วยนะครับเพื่อเข้าสู่โหมด Upload</strong><br />**ในขั้นตอนนี้ผมจะใช้ esptool สำหรับการอัพโหลดนะครับโดย esptool นั้นจะรันผ่าน Windows PowerShell (Windows) และ Terminal (Linux) ท่านผู้อ่านต้องทำการติดตั้ง esptool ก่อนนะครับ**</li></ul>\n\n\n\n<pre>- esptool.py -p COM3 read_mac //read mac address of sonoff</pre>\n\n\n\n<div><figure><img src=\"https://miro.medium.com/max/752/1*fTk1xzso6mB2etCqoXZkmw.png\" /></figure></div>\n\n\n\n<ul><li>จากนั้นทำการอัพโหลด <a href=\"https://github.com/arendst/Tasmota/releases/tag/v6.7.1\">Tasmota firmware</a> กันครับ <strong>หลังจากที่ esptool อัพโหลดเฟิร์มแวร์เสร็จแล้ว Sonoff เราจะต้องทำการ restart Sonoff 1 รอบนะครับเพื่อให้ Sonoff ของเราเข้าสู่โหมด Normal โดยสังเกตจากการกะพริบของหลอดไฟ</strong></li></ul>\n\n\n\n<pre>- esptool.py --port COM3 erase_flash //erase flash memory of sonoff<br />- esptool.py --port COM3 write_flash -fs 1MB -fm dout 0x0 tasmota.bin //upload tasmota firmware</pre>\n\n\n\n<div><figure><img src=\"https://miro.medium.com/max/752/1*WRoJ_WfueItbjr9gKPx1Qg.png\" /></figure></div>\n\n\n\n<ul><li>เมื่ออัพโหลดเฟิร์มแวร์เสร็จแล้ว ขั้นต่อไปทำการเชื่อมโทรศัพท์ของเราเข้ากับ WIFI Access point ของ Sonoff โดยชื่อจะขึ้นต้นเป็น <strong>sonoff-xxx </strong>ครับ เมื่อเชื่อมต่อเสร็จสิ้นระบบจะ redirect URL มาที่ 192.168.4.1 ซึ่งจะเป็น IP ของ Sonoff เพื่อให้เราใส่ชื่อ AP และ Password สำหรับเชื่อมต่อกับเน็ตที่บ้านของเรา</li></ul>\n\n\n\n<div><figure><img src=\"https://miro.medium.com/max/421/1*66HuqU_b8AXrTDz2tlU5Jw.png\" /></figure></div>\n\n\n\n<div><figure><img src=\"https://miro.medium.com/max/234/1*P69-SslQQL66eTfvgVE8FA.png\" /></figure></div>\n\n\n\n<ul><li>หลังจาก Sonoff เชื่อมต่อกับ WIFI ที่บ้านเราแล้ว ถัดมาเราจะสามารถควบคุม Sonoff ผ่าน Web UI โดยจำเป็นต้องเข้าผ่าน IP ของ Sonoff ซึ่ง IP นี้จะเป็น IP Address ที่ Router ที่บ้านของเราเป็นคนจ่ายให้กับตัวอุปกรณ์ซึ่งเราสามารถใช้ โปรแกรม IP Scanner สแกนหาได้เลยครับแล้วก็เข้าตาม IP Address นั้น</li></ul>\n\n\n\n<div><figure><img src=\"https://miro.medium.com/max/499/1*zDzdpXpvTutfDLyBKZ3AMQ.png\" /></figure></div>\n\n\n\n<p>เสร็จสิ้นการอัพโหลด Tasmota Firmware สำหรับ Sonoff แล้วครับ จากความเห็นส่วนตัวผมคิดว่า Tasmota นั้นไม่ได้มีดีแค่หน้า Web UI นะครับส่วนหลักๆที่ผมคิดว่าเจ๋งคือน่าจะเป็น Wifi config manager และการเชื่อมต่อกับ MQTT ได้ ซึ่งเราน่าจะเอาไปประยุกต์ใช้กับหลายๆโปรเจคได้เหมือนกันครับ ไว้เดี๋ยวเรื่องต่อไปผมจะมาเขียนการเชื่อมต่อ MQTT กับ Tasmota Firmware ให้นะครับ</p>\n\n\n\n<h2>สำหรับวันนี้ขอบคุณและสวัสดีครับ</h2>\n\n\n\n<blockquote><p><a href=\"https://github.com/arendst/Tasmota\" target=\"_blank\">https://github.com/arendst/Tasmota</a></p><cite>Alternative firmware for ESP8266 with easy configuration using webUI, OTA updates, automation using timers or rules, expandability and entirely local control over MQTT, HTTP, Serial or KNX.</cite></blockquote>\n\n\n\n<blockquote><p><a href=\"https://www.itead.cc/wiki/Sonoff\">https://www.itead.cc/wiki/Sonoff</a></p><cite>Home automation is “The Internet of Things”. It simply means the way all devices or appliances are networked together to provide customers with a ..</cite></blockquote>\n<p>The post <a href=\"https://thanapon.info/sonoff-tasmota/\">[ESP8266-Sonoff] มาลอง TASMOTA firmware สำหรับ Sonoff กันครับ</a> appeared first on <a href=\"https://thanapon.info\">Thanapon</a>.</p>","author":"thanapon.tap","siteTitle":"Thanapon","siteHash":"6a039c2f54d76e4c49227d80968f2a30de5427cc57525c047c383ea3563cde5f","entryHash":"20cf1d802f6c1fb5279db66f6c968576dc0ed752bac7afbc6b796dfb0867be4d","category":"Thai"}