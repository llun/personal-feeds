{"title":"Get Started Using Amazon FSx File Gateway for Fast, Cached Access to File Server Data in the Cloud","link":"https://aws.amazon.com/blogs/aws/get-started-using-amazon-fsx-file-gateway-for-fast-cached-access-to-file-server-data-in-the-cloud/","date":1619555088000,"content":"<p>As traditional workloads continue to migrate to the cloud, some customers have been unable to take advantage of cloud-native services to host data typically held on their on-premises file servers. For example, data commonly used for team and project file sharing, or with content management systems, has needed to reside on-premises due to issues of high latency, or constrained or shared bandwidth, between customer premises and the cloud.</p> \n<p>Today, I’m pleased to announce <a href=\"https://aws.amazon.com/storagegateway/file/fsx/\">Amazon FSx File Gateway</a>, a new type of <a href=\"https://aws.amazon.com/storagegateway/\">AWS Storage Gateway</a> that helps you access data stored in the cloud with <a href=\"https://aws.amazon.com/fsx/windows/\">Amazon FSx for Windows File Server</a>, instead of continuing to use and manage on-premises file servers. <span>Amazon FSx File Gateway</span> uses network optimization and caching so it appears to your users and applications as if the shared data were still on-premises. By moving and consolidating your file server data into <span>Amazon FSx for Windows File Server</span>, you can take advantage of the scale and economics of cloud storage, and divest yourself of the undifferentiated maintenance involved in managing on-premises file servers, while <span>Amazon FSx File Gateway</span> solves issues around latency and bandwidth.</p> \n<p><strong><span>Replacing On-premises File Servers</span><br /> </strong><span>Amazon FSx File Gateway</span> is an ideal solution to consider when replacing your on-premises file servers. Low-latency access ensures you can continue to use latency-sensitive on-premises applications, and caching conserves shared bandwidth between your premises and the cloud, which is especially important when you have many users all attempting to access file share data directly.</p> \n<p>You can attach an <span>Amazon FSx file system</span> and present it through a gateway to your applications and users provided they are all members of the same Active Directory domain, and the AD infrastructure can be hosted in AWS Directory Service, or managed on-premises.</p> \n<p>Your data, as mentioned, resides in <span>Amazon FSx for Windows File Server</span>, a fully managed, highly reliable and resilient file system, eliminating the complexity involved in setting up and operating file servers, storage volumes, and backups. <span>Amazon FSx for Windows File Server</span> provides a fully native Windows file system in the cloud, with full Server Message Block (SMB) protocol support, and is accessible from Windows, Linux, and macOS systems running in the cloud or on-premises. Built on Windows Server, <span>Amazon FSx for Windows File Server</span> also exposes a rich set of administrative features including file restoration, data deduplication, Active Directory integration, and access control via Access Control Lists (ACLs).</p> \n<p><strong><span>Choosing the Right Gateway</span><br /> </strong>You may be aware of <a href=\"https://aws.amazon.com/storagegateway/file/\">Amazon S3 File Gateway</a> (originally named File Gateway), and might now be wondering which type of workload is best suited for the two gateways:</p> \n<ul> \n <li><strong>With <span>Amazon S3 File Gateway</span></strong>, you can access data stored in <a href=\"https://aws.amazon.com/s3/\">Amazon Simple Storage Service (S3)</a> as files, and it’s also a solution for file ingestion into <span>S3</span> for use in running object-based workloads and analytics, and for processing data that exists in on-premises files.</li> \n <li><strong><span>Amazon FSx File Gateway</span>,</strong> on the other hand, is a solution for moving network-attached storage (NAS) into the cloud while continuing to have low-latency, seamless access for your on-premises users. This includes two general-purpose NAS use-cases that use the SMB file protocol: end-user home directories and departmental or group file shares. <span>Amazon FSx File Gateway</span> supports multiple users sharing files, with advanced data management features such as access controls, snapshots for data protection, integrated backup, and more.</li> \n</ul> \n<p>One additional unique feature I want to note is <span>Amazon FSx File Gateway</span> integration with backups. This includes backups taken directly within <a href=\"https://aws.amazon.com/fsx/\">Amazon FSx</a> and those coordinated by <a href=\"https://aws.amazon.com/backup/\">AWS Backup</a>. Prior to a backup starting, <span>Amazon FSx for Windows File Server</span> communicates with each attached gateway to ensure any uncommitted data gets flushed. This helps further reduce your administrative overhead and worries when moving on-premises file shares into the cloud.</p> \n<p><span><strong>Working with <span>Amazon FSx File Gateway</span></strong></span><br /> <span>Amazon FSx File Gateway</span> is available using multiple platform options. You can order and deploy a <a href=\"https://aws.amazon.com/storagegateway/hardware-appliance/\" target=\"_blank\">hardware appliance</a> into your on-premises environment, deploy as a virtual machine into your on-premises environment (VMware ESXi, Microsoft Hyper-V, Linux KVM), or deploy in cloud as an <a href=\"https://aws.amazon.com/ec2/\">Amazon Elastic Compute Cloud (EC2)</a> instance. The available options are displayed as you start to create a gateway from the <span>AWS Storage Gateway</span> Management Console, together with setup instructions for each option.</p> \n<p>Below, I choose to use an <span>EC2</span> instance for my gateway.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/03/26/fsxfgw_host_platforms-1.png\"><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/03/26/fsxfgw_host_platforms-1.png\" /></a></p> \n<p>The process of setting up a gateway is pretty straightforward and as the <a href=\"https://docs.aws.amazon.com/filegateway/latest/filefsxw/create-gateway-file.html\" target=\"_blank\">documentation here</a> goes into detail, I’m not going to repeat the flow in this post. Essentially, the steps involved are to first create a gateway, then join it to your domain. Next, you attach an <span>Amazon FSx file system</span>. After that, your remote clients can work with the data on the file system, but the important difference is that they connect using a network share to the gateway instead of to the <span>Amazon FSx file system</span>.</p> \n<p>Below is the general configuration for my gateway, created in <span>US East (N. Virginia)</span>.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/03/27/fsxfgw-gateway-details.png\"><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/03/27/fsxfgw-gateway-details.png\" /></a></p> \n<p>And here are the details of my <span>Amazon FSx file system</span>, running in an <a href=\"https://aws.amazon.com/vpc/\">Amazon Virtual Private Cloud (VPC)</a> in <span>US East (N. Virginia)</span>, that will be attached to my gateway.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/04/06/fsx-details-1.png\"><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/04/06/fsx-details-1.png\" /></a></p> \n<p>Note that I have created and activated the gateway in the same region as the source <span>Amazon FSx file system</span>, and will manage the gateway from <span>US East (N. Virginia)</span>. The gateway virtual machine (VM) is deployed as an <span>EC2</span> instance running in a <span>VPC</span> in our remote region, <span>US West (Oregon)</span>. I’ve also established a peering connection between the two <span>VPC</span>s.</p> \n<p>Once I have attached the <span>Amazon FSx file system</span> to my <span>Amazon FSx File Gateway</span>, in the <span>AWS Storage Gateway</span> Management Console I select <strong>FSx file systems</strong> and then the respective file system instance. This gives me the details of the command needed by my remote users to connect to the gateway.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/04/06/fsxfgw-attachment-2.png\"><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/04/06/fsxfgw-attachment-2.png\" /></a></p> \n<p><strong><span>Exploring an End-user Scenario with <span>Amazon FSx File Gateway</span></span><br /> </strong>Let’s explore a scenario that may be familiar to many readers, that of a “head office” that has moved its NAS into the cloud, with one or more “branch offices” in remote locations that need to connect to those shares and the files they hold. In this case, my head office/branch office scenario is for a fictional photo agency, and is set up so I can explore the gateway’s cache refresh functionality. For this, I’m imagining a scenario where a remote user deletes some files accidentally, and then needs to contact an admin in the head office to have them restored. This is possibly a fairly common scenario, and one I know I’ve had to both request, and handle, in my career!</p> \n<p>My head office for my fictional agency is located in <span>US East (N. Virginia)</span> and the local admin for that office (me) has a network share attached to the <span>Amazon FSx file system</span> instance. My branch office, where my agency photographers work, is located in the <span>US West (Oregon)</span> region, and users there connect to my agency’s network over a VPN (an <a href=\"https://aws.amazon.com/directconnect/\">AWS Direct Connect</a> setup could also be used). In this scenario, I simulate the workstations at each office using <span>Amazon Elastic Compute Cloud (EC2)</span> instances.</p> \n<p>In my fictional agency, photographers upload images to my agency’s <span>Amazon FSx file system</span>, connected via a network share to the the gateway. Even though my fictional head office, and the <span>Amazon FSx file system</span> itself are resources located on the east coast, the gateway and its cache provide a fast, low latency connection for users in the remote branch office, making it seem as though there is a local NAS. After photographers upload images from their assignments, additional staff in the head office do some basic work on them, and make the partly-processed images available back to the photographers on the west coast via the file share.</p> \n<p>The image below illustrates the resource setup for my fictional agency.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/03/29/fsxfgw_system_setup-2.png\"><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/03/29/fsxfgw_system_setup-2.png\" /></a></p> \n<p>I have set up scheduled multiple daily backups for the file system, as you might expect, but I’ve also gone a step further and enabled shadow copies on my <span>Amazon FSx file system</span>. Remember, <span>Amazon FSx for Windows File Server</span> <strong>is</strong> a Windows File Server instance, it just happens to be running in the cloud. You can find details of how to set up shadow copies (which are not enabled by default) in the <a href=\"https://docs.aws.amazon.com/fsx/latest/WindowsGuide/shadow-copies-fsxW.html#setting-up-fsx-shadow-copies\" target=\"_blank\">documentation here</a>. For the purposes of the fictional scenario in this blog post, I set up a schedule so that my shadow copies are taken every hour.</p> \n<p>Back to my fictional agency. One of my photographers on the west coast, Alice, is logged in and working with a set of images that have already had some work done on them by the head office. In this image, it’s apparent Alice is connected and working on her images via the network share IP marked in an earlier image in this post – this is the gateway file share.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/03/28/pre-fsxfgw-data-deletion-1.png\"><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/03/28/pre-fsxfgw-data-deletion-1.png\" /></a></p> \n<p>Suddenly, disaster strikes and Alice accidentally deletes all of the files in the folder she was working in. Picking up the phone, she calls the admin (me) in the east coast head office and explains the situation, wondering if we can get the files back.</p> \n<p>Since I’d set up scheduled daily backups of the file system, I could probably restore the deleted files from there. This would involve a restore to a new file system, then copying the files from that new file system to the existing one (and deleting the new file system instance afterwards). But, having enabled shadow copies, in this case I can restore the deleted files without resorting to the backups. And, because I enabled automated cache refreshes on my gateway, with the refresh period set to every 5 minutes, Alice will see the restored files relatively quickly.</p> \n<p>My admin machine (in the east coast office) has a network share to the <span>Amazon FSx file system</span>, so I open an explorer view onto the share, right-click the folder in question, and select <strong>Restore previous versions</strong>. This gives me a dialog where I can select the most recent shadow copy.</p> \n<p><a href=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/03/28/fsx-admin-restore-1.png\"><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/03/28/fsx-admin-restore-1.png\" /></a></p> \n<p>I ask Alice to wait 5 minutes, then refresh her explorer view. The changes in the <span>Amazon FSx file system</span> are propagated to the cache on the gateway and sure enough, she sees the files she accidentally deleted and can resume work. (When I saw this happen for real in my test setup, even though I was expecting it, I let out a whoop of delight!). Overall, I hope you can see how easy it is to set up and operate an <span>Amazon FSx File Gateway</span> with an <span>Amazon FSx for Windows File Server</span>.</p> \n<p><span><strong>Get Started Today with <span>Amazon FSx File Gateway</span></strong></span><br /> <span>Amazon FSx File Gateway</span> provides a low-latency, efficient connection for remote users when moving on-premises Windows file systems into the cloud. This benefits users who experience higher latencies, and shared or limited bandwidth, between their premises and the cloud. <a href=\"https://aws.amazon.com/storagegateway/file/fsx/\">Amazon FSx File Gateway</a> is available today in all commercial <a href=\"https://aws.amazon.com/\">AWS</a> regions where <a href=\"https://aws.amazon.com/fsx/windows/\">Amazon FSx for Windows File Server</a> is available. It’s also available in the <span>AWS GovCloud (US-West)</span> and <span>AWS GovCloud (US-East)</span> regions, and the Amazon <span>China (Beijing)</span>, and <span>China (Ningxia)</span> regions.</p> \n<p><strong>You can learn more <a href=\"https://aws.amazon.com/storagegateway/file/fsx/\" target=\"_blank\">on this feature page</a>, and get started right away using the <a href=\"https://docs.aws.amazon.com/filegateway/latest/filefsxw/what-is-file-fsxw.html\" target=\"_blank\">feature documentation</a>.</strong></p>","author":"Steve Roberts","siteTitle":"AWS News Blog","siteHash":"6093e072e4117ec22616e844cb857d03ca62c57a411a8affc77cb5e8b6b15bf6","entryHash":"4ff1fac4a58dbf9ba19bd8c8dea08a1022c2b811592c890452192a3e91ccdc4a","category":"Tech"}