{"title":"Getting Started with Amazon ECS Anywhere – Now Generally Available","link":"https://aws.amazon.com/blogs/aws/getting-started-with-amazon-ecs-anywhere-now-generally-available/","date":1622135606000,"content":"<p>Since <a href=\"https://aws.amazon.com/ecs/\">Amazon Elastic Container Service</a> (Amazon ECS) was launched in 2014, AWS has released other options for running Amazon ECS tasks outside of an AWS Region such as <a href=\"https://aws.amazon.com/wavelength\">AWS Wavelength</a>, an offering for mobile edge devices or <a href=\"https://aws.amazon.com/outposts/\">AWS Outposts</a>, a service that extends to customers’ environments using hardware owned and fully managed by AWS.</p> \n<p>But some customers have applications that need to run on premises due to regulatory, latency, and data residency requirements or the desire to leverage existing infrastructure investments. In these cases, customers have to install, operate, and manage separate container orchestration software and need to use disparate tooling across their AWS and on-premises environments. Customers asked us for a way to manage their on-premises containers without this added complexity and cost.</p> \n<p>Following Jeff’s <a href=\"https://aws.amazon.com/blogs/aws/reinvent-2020-preannouncements-for-tuesday-december-1/\">preannouncement</a> last year, I am happy to announce the general availability of <a href=\"https://aws.amazon.com/ecs/anywhere\">Amazon ECS Anywhere</a>, a new capability in Amazon ECS that enables customers to easily run and manage container-based applications on premises, including virtual machines (VMs), bare metal servers, and other customer-managed infrastructure.</p> \n<p>With ECS Anywhere, you can run and manage containers on any customer-managed infrastructure using the same cloud-based, fully managed, and highly scalable container orchestration service you use in AWS today. You no longer need to prepare, run, update, or maintain your own container orchestrators on premises, making it easier to manage your hybrid environment and leverage the cloud for your infrastructure by installing simple agents.</p> \n<p>ECS Anywhere provides consistent tooling and APIs for all container-based applications and the same Amazon ECS experience for cluster management, workload scheduling, and monitoring both in the cloud and on customer-managed infrastructure. You can now enjoy the benefits of reduced cost and complexity by running container workloads such as data processing at edge locations on your own hardware maintaining reduced latency, and in the cloud using a single, consistent container orchestrator.</p> \n<p><strong><u>Amazon ECS Anywhere – Getting Started</u></strong><br /> To get started with ECS Anywhere, register your on-premises servers or VMs (also referred to as External instances) in the ECS cluster. The <a href=\"https://aws.amazon.com/systems-manager\">AWS Systems Manager</a> Agent, Amazon ECS container agent, and Docker must be installed on these external instances. Your external instances require an IAM role that permits them to communicate with AWS APIs. For more information, see <a href=\"https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs-anywhere-iam.html\">Required IAM permissions</a> in the ECS Developer Guide.</p> \n<p>To create a cluster for ECS Anywhere, on the <strong>Create Cluster</strong> page in the <a href=\"https://console.aws.amazon.com/ecs/home?#/clusters/create/new\">ECS console</a>, choose the <strong>Networking Only</strong> template. This option is for use with either <a href=\"https://aws.amazon.com/fargate\">AWS Fargate</a> or external instance capacity. We recommend that you use the AWS Region that is geographically closest to the on-premises servers you want to register.</p> \n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/05/26/2021-ecs-anywhere-0-Creating-Cluster.png\" /></p> \n<p>This creates an empty cluster to register external instances. On the <strong>ECS Instances</strong> tab, choose <strong>Register External Instances</strong> to get activation codes and an installation script.</p> \n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/05/26/2021-ecs-anywhere-0-Creating-Cluster-1.png\" /></p> \n<p>On the <strong>Step 1: External instances activation details</strong> page, in <strong>Activation key duration (in days)</strong>, enter the number of days the activation key should remain active. The activation key can be used for up to 1,000 activations. In <strong>Number of instances</strong>, enter the number of external instances you want to register to your cluster. In <strong>Instance role</strong>, enter the IAM role to associate with your external instances.</p> \n<p>Choose <strong>Next step </strong>to get a registration command.</p> \n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/05/26/2021-ecs-anywhere-2-Register-External-Instances.png\" /></p> \n<p>On the <strong>Step 2: Register external instances</strong> page, copy the registration command. Run this command on the external instances you want to register to your cluster.</p> \n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/05/26/2021-ecs-anywhere-2-Register-External-Instances-2.png\" /></p> \n<p>Paste the registration command in your on-premise servers or VMs. Each external instance is then registered as an AWS Systems Manager managed instance, which is then registered to your Amazon ECS clusters.</p> \n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/05/26/2021-ecs-anywhere-2-Register-External-Instances-3.png\" /></p> \n<p>Both <code>x86_64</code> and <code>ARM64</code> CPU architectures are supported. The following is a list of supported operating systems:</p> \n<ul> \n <li>CentOS 7, CentOS 8</li> \n <li>RHEL 7</li> \n <li>Fedora 32, Fedora 33</li> \n <li>openSUSE Tumbleweed</li> \n <li>Ubuntu 18, Ubuntu 20</li> \n <li>Debian 9, Debian 10</li> \n <li>SUSE Enterprise Server 15</li> \n</ul> \n<p>When the ECS agent has started and completed the registration, your external instance will appear on the <strong>ECS Instances</strong> tab.</p> \n<p>You can also add your external instances to the existing cluster. In this case, you can see both Amazon EC2 instances and external instances are prefixed with <code>mi-*</code> together.</p> \n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/05/26/2021-ecs-anywhere-1-ECS-Instances.png\" /></p> \n<p>Now that the external instances are registered to your cluster, you are ready to create a task definition. Amazon ECS provides the <code>requiresCompatibilities</code> parameter to validate that the task definition is compatible with the the <code>EXTERNAL</code> launch type when creating your service or running your standalone task. The following is an example task definition:</p> \n<pre><code>{\n\t\"requiresCompatibilities\": [\n\t\t\"EXTERNAL\"\n\t],\n\t\"containerDefinitions\": [{\n\t\t\"name\": \"nginx\",\n\t\t\"image\": \"public.ecr.aws/nginx/nginx:latest\",\n\t\t\"memory\": 256,\n\t\t\"cpu\": 256,\n\t\t\"essential\": true,\n\t\t\"portMappings\": [{\n\t\t\t\"containerPort\": 80,\n\t\t\t\"hostPort\": 8080,\n\t\t\t\"protocol\": \"tcp\"\n\t\t}]\n\t}],\n\t\"networkMode\": \"bridge\",\n\t\"family\": \"nginx\"\n}</code></pre> \n<p>You can create a task definition in the <a href=\"https://console.aws.amazon.com/ecs/home?#/taskDefinitions/create\">ECS console</a>. In <strong>Task Definition</strong>, choose <strong>Create new task definition</strong>. For <strong>Launch type</strong>, choose <strong>EXTERNAL</strong> and then configure the task and container definitions to use external instances.</p> \n<p>On the <strong>Tasks</strong> tab, choose <strong>Run new task</strong>. On the <strong>Run Task</strong> page, for <strong>Cluster</strong>, choose the cluster to run your task definition on. In <strong>Number of tasks</strong>, enter the number of copies of that task to run with the <code>EXTERNAL</code> launch type.</p> \n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/05/26/2021-ecs-anywhere-3-Run-task.png\" /></p> \n<p>Or, on the <strong>Services</strong> tab, choose <strong>Create</strong>. <strong>Configure service</strong> lets you specify copies of your task definition to run and maintain in a cluster. To run your task in the registered external instance, for <strong>Launch type</strong>, choose <strong>EXTERNAL</strong>. When you choose this launch type, load balancers, tag propagation, and service discovery integration are not supported.</p> \n<p>The tasks you run on your external instances must use the <code>bridge</code>, <code>host</code>, or <code>none</code> network modes. The <code>awsvpc</code> network mode isn’t supported. For more information about each network mode, see <a href=\"https://docs.aws.amazon.com/AmazonECS/latest/bestpracticesguide/networking-networkmode.html\">Choosing a network mode</a> in the Amazon ECS Best Practices Guide.</p> \n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/05/26/2021-ecs-anywhere-4-Congigure-Service.png\" /></p> \n<p>Now you can run your tasks and associate a mix of <code>EXTERNAL</code>, <code>FARGATE</code>, and <code>EC2</code> capacity provider types with the same ECS service and specify how you would like your tasks to be split across them.</p> \n<p><img src=\"https://d2908q01vomqb2.cloudfront.net/da4b9237bacccdf19c0760cab7aec4a8359010b0/2021/05/26/2021-ecs-anywhere-4-Congigure-Service-2.png\" /></p> \n<p><strong><u>Things to Know</u></strong><br /> Here are a couple of things to keep in mind:</p> \n<p><strong>Connectivity</strong>: In the event of loss of network connectivity between the ECS agent running on the on-premises servers and the ECS control plane in the AWS Region, existing ECS tasks will continue to run as usual. If tasks still have connectivity with other AWS services, they will continue to communicate with them for as long as the task role credentials are active. If a task launched as part of a service crashes or exits on its own, ECS will be unable to replace it until connectivity is restored.</p> \n<p><strong>Monitoring</strong>: With ECS Anywhere, you can get <a href=\"https://aws.amazon.com/cloudwatch\">Amazon CloudWatch</a> metrics for your clusters and services, use the CloudWatch Logs driver (<code>awslogs</code>) to get your containers’ logs, and access the ECS CloudWatch event stream to monitor your clusters’ events.</p> \n<p><strong>Networking</strong>: ECS external instances are optimized for running applications that generate outbound traffic or process data. If your application requires inbound traffic, such as a web service, you will need to employ a workaround to place these workloads behind a load balancer until the feature is supported natively. For more information, see <a href=\"https://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs-anywhere.html#ecs-anywhere-networking\">Networking with ECS Anywhere</a>.</p> \n<p><strong>Data Security</strong>: To help customers maintain data security, ECS Anywhere only sends back to the AWS Region metadata related to the state of the tasks or the state of the containers (whether they are running or not running, performance counters, and so on). This communication is authenticated and encrypted in transit through Transport Layer Security (TLS).</p> \n<p><strong><u>ECS Anywhere Partners</u></strong><br /> ECS Anywhere integrates with a variety of <a href=\"https://aws.amazon.com/ecs/anywhere/partners/\">ECS Anywhere partners</a> to help customers take advantage of ECS Anywhere and provide additional functionality for the feature. Here are some of the blog posts that our partners wrote to share their experiences and offerings. <em>(I am updating this article with links as they are published.)</em></p> \n<p><strong><u>Now Available</u></strong><br /> <a href=\"https://aws.amazon.com/ecs/anywhere/\">Amazon ECS Anywhere</a> is now available in all commercial regions except AWS China Regions where ECS is supported. With ECS Anywhere, there are no minimum fees or upfront commitments. You pay per instance hour for each managed ECS Anywhere task. ECS Anywhere free tier includes 2200 instance hours per month for six months per account for all regions. For more information, see the <a href=\"https://aws.amazon.com/ecs/anywhere/pricing/\">pricing page</a>.</p> \n<p>To learn more, see <a href=\"http://docs.aws.amazon.com/AmazonECS/latest/developerguide/ecs-anywhere.html\">ECS Anywhere</a> in the Amazon ECS Developer Guide. Please send feedback to the <a href=\"https://forums.aws.amazon.com/forum.jspa?forumID=187\">AWS forum for Amazon ECS</a> or through your usual AWS Support contacts.</p> \n<p><strong><a href=\"https://aws.amazon.com/ecs/anywhere/?sc_detail=blog_cta1\">Get started</a> with the Amazon ECS Anywhere today.</strong></p> \n<p>– <a href=\"https://twitter.com/channyun\">Channy</a></p> \n<p><em>Update. Watch a <a href=\"https://www.youtube.com/watch?v=k01AdJC-dcA&amp;t=2975s\">cool demo of ECS Anywhere</a> to operate a Raspberry Pi cluster at home office and read its <a href=\"https://aws.amazon.com/blogs/containers/building-an-amazon-ecs-anywhere-home-lab-with-amazon-vpc-network-connectivity/\">deep-dive blog post</a>.</em></p> \n<p></p>","author":"Channy Yun","siteTitle":"AWS News Blog","siteHash":"6093e072e4117ec22616e844cb857d03ca62c57a411a8affc77cb5e8b6b15bf6","entryHash":"667e59e835b78c120a6112f83143ab9809097796f3a81d86ecca570ace886d82","category":"Tech"}