{"title":"Fix WordPress Missed Schedule","link":"https://markpeak.net/fix-wordpress-missed-schedule/","date":1616467502000,"content":"<p>รัน WordPress มาหลายเว็บ เพิ่งมาเจอปัญหากับเว็บนี้ markpeak.net ว่าตั้งเวลาโพสต์ล่วงหน้าแล้วมักโพสต์ไม่ออกอยู่บ่อยครั้งๆ (ขึ้นว่า missed schedule)</p>\n<p>ปัญหาไม่ร้ายแรงนัก เพราะไม่ได้ใช้โพสต์ล่วงหน้าบ่อย แต่เจอหลายทีเข้าก็รำคาญเหมือนกัน เลยต้องมานั่งสาเหตุและวิธีแก้ไข ตอนนี้แก้ได้แล้วก็มาบันทึกไว้</p>\n<h2>สาเหตุ</h2>\n<p>อย่างแรกเลยคือ ระบบการตั้งเวลาของ WordPress ใช้แนวคิดเดียวกับ cron (เซอร์วิสตั้งเวลาของ Unix) แต่เนื่องจาก WordPress เป็นเว็บแอปพลิเคชันที่ไม่ได้รัน cron จริงๆ จึงต้องใช้วิธีสร้าง cron ปลอมของตัวเองขึ้นมา โดยใช้ &#8220;คนเข้าเว็บ&#8221; เป็นตัว trigger มาเช็คว่ามีงาน scheduled ต้องทำหรือไม่ (คนเข้าเว็บ 1 ครั้ง จะเรียกฐานข้อมูลมาดูว่ามีอะไรต้องรันไหม ถ้าไม่มีคนเข้าเว็บช่วงนั้น ก็จะไม่มี trigger นี้ เป็นเหตุให้ scheduled ไม่ทำงาน)</p>\n<p>ดังนั้น ในกรณีที่เป็นเว็บเล็กๆ ทราฟฟิกน้อย และตั้งเวลาโพสต์ในช่วงที่คนเข้าน้อยพอดี (เช่น ตอนเช้า) ก็มีโอกาสที่ missed schedule ได้ง่าย</p>\n<h2>ทางแก้ไข #1 ตั้ง cron จริงๆ</h2>\n<p>วิธีแก้ไขที่ตรงไปตรงมาที่สุดคือ ถ้า cron ปลอมไม่รัน เราก็ไปตั้งค่า cron จริงๆ ในเซิร์ฟเวอร์ซะเลยสิ</p>\n<p>วิธีการนี้จำเป็นต้องมีสิทธิการเข้าถึงระดับโฮสต์ด้วย (ถ้าไม่มีก็ต้องแก้แบบ #2) ซึ่งแต่ละโฮสต์มีวิธีทำแตกต่างกันไป</p>\n<p>โฮสต์ที่ผมใช้งานนั้นใช้ซอฟต์แวร์ Plesk บริหารจัดการ วิธีตั้งค่า cron คือเข้าไปที่ Domain &gt; เลือกโดเมนที่ต้องการ แล้วคลิกที่เมนู Scheduled Tasks ด้านขวามือ</p>\n<p><img loading=\"lazy\" class=\"aligncenter size-large wp-image-2232\" src=\"https://markpeak.net/wp-content/uploads/2021/03/pleask1-1024x431.png\" alt=\"\" width=\"700\" height=\"295\" srcset=\"https://markpeak.net/wp-content/uploads/2021/03/pleask1-1024x431.png 1024w, https://markpeak.net/wp-content/uploads/2021/03/pleask1-300x126.png 300w, https://markpeak.net/wp-content/uploads/2021/03/pleask1-768x323.png 768w, https://markpeak.net/wp-content/uploads/2021/03/pleask1-700x295.png 700w, https://markpeak.net/wp-content/uploads/2021/03/pleask1.png 1095w\" sizes=\"(max-width: 700px) 100vw, 700px\" />กดปุ่ม Add Task จะเจอหน้าจอดังภาพ สิ่งสำคัญคือเราต้องระบุในช่อง Command ว่าจะรันอะไร ให้ใส่ตามนี้ ก็คือบอกว่าให้เซิร์ฟเวอร์รันคำสั่ง cron ของ WordPress ให้หน่อยนะ (แก้ตรงโดเมนเนมให้เป็นเว็บของเรา)</p>\n<blockquote><p>Wget -O /dev/null https://domain.com/wp-cron.php?doing_wp_cron</p></blockquote>\n<p>ส่วนตรง Run ให้ระบุความถี่ อันนี้ขึ้นกับว่าต้องการถี่แค่ไหน กรณีของผมที่ใช้ไม่บ่อย คิดว่าชั่วโมงละครั้งก็พอเพียง (ถ้าอยากให้ละเอียดขึ้น เช่น ทุก 5 นาทีหรือ 15 นาที เขียนเป็น <a href=\"https://www.thegeekstuff.com/2011/07/cron-every-5-minutes/\">crontab</a> ได้)</p>\n<p><img loading=\"lazy\" class=\"aligncenter size-full wp-image-2233\" src=\"https://markpeak.net/wp-content/uploads/2021/03/plesk2.png\" alt=\"\" width=\"835\" height=\"676\" srcset=\"https://markpeak.net/wp-content/uploads/2021/03/plesk2.png 835w, https://markpeak.net/wp-content/uploads/2021/03/plesk2-300x243.png 300w, https://markpeak.net/wp-content/uploads/2021/03/plesk2-768x622.png 768w, https://markpeak.net/wp-content/uploads/2021/03/plesk2-700x567.png 700w\" sizes=\"(max-width: 835px) 100vw, 835px\" /> ตั้งค่า cron ของเซิร์ฟเวอร์เสร็จแล้ว ให้ไปปิด cron ปลอมของ WordPress ด้วย จะได้ไม่ตีกัน</p>\n<p>วิธีการคือเข้าไปแก้ไฟล์ wp-config.php ใน File Manager ของโฮสต์ (อยู่ในโฟลเดอร์ด้านนอกสุด) แล้วเพิ่มค่านี้ไปที่บรรทัดสุดท้าย</p>\n<blockquote><p>define(&#8216;DISABLE_WP_CRON&#8217;, true);</p></blockquote>\n<p><img loading=\"lazy\" class=\"aligncenter size-full wp-image-2234\" src=\"https://markpeak.net/wp-content/uploads/2021/03/wp-config.png\" alt=\"\" width=\"652\" height=\"290\" srcset=\"https://markpeak.net/wp-content/uploads/2021/03/wp-config.png 652w, https://markpeak.net/wp-content/uploads/2021/03/wp-config-300x133.png 300w\" sizes=\"(max-width: 652px) 100vw, 652px\" /></p>\n<p>เท่านี้ก็เรียบร้อย ลองตั้งเวลาโพสต์แล้วน่าจะใช้งานได้ไม่มีปัญหาแล้ว</p>\n<h2>ทางแก้ #2 ใช้ปลั๊กอินช่วย</h2>\n<p>แต่ถ้าใช้โฮสต์ที่เข้าไม่ถึงสิทธิหลังบ้านแบบทางแก้ #1 ก็มีทางเลือกอื่นๆ คือใช้ปลั๊กอินช่วย การทำงานของมันคือ ใช้การเข้าเว็บเป็น trigger แต่จะเช็คอีกรอบว่ามี missed schedule ค้างอยู่หรือไม่ (ซึ่ง WordPress ปกติจะเช็คแค่ว่ามี scheduled หรือไม่ ถ้าพลาดแล้วคือพลาดเลย ไม่กลับมาเช็คซ้ำให้)</p>\n<p>ปลั๊กอินตัวนี้คือ <a href=\"https://wordpress.org/plugins/scheduled-post-trigger/\">Scheduled Post Trigger</a> วิธีนี้ผมไม่ได้ลอง เลยไม่สามารถเล่าได้ว่าผลเป็นอย่างไร</p>\n<p>ข้อมูลอ้างอิงจาก <a href=\"https://betterstudio.com/blog/how-to-fix-wordpress-missed-schedule/\">BetterStudio</a></p>The post <a href=\"https://markpeak.net/fix-wordpress-missed-schedule/\">Fix WordPress Missed Schedule</a> first appeared on <a href=\"https://markpeak.net\">markpeak.net</a>.","author":"Isriya Paireepairit","siteTitle":"markpeak.net","siteHash":"174209a41ef21fd794de2993285c799df6ec31048fd82206fb5c8fe38898acfe","entryHash":"f7555297ce957137e12bea2dbdbd5b93ccc6cb2903b6b8b8775cc569a0c40cd0","category":"Thai"}