{"title":"[PostgreSQL] How to check null in jsonb array","link":"http://visibletrap.blogspot.com/2020/12/postgresql-how-to-check-null-in-jsonb.html","date":1608524520004,"content":"<div style=\"text-align: left;\">&nbsp;Use&nbsp;<span style=\"font-family: courier;\">jsonb_array_elements</span> &nbsp;to convert jsonb array to set (queriable similar to normal table) then we can use&nbsp; <span style=\"font-family: courier;\">where x::text = 'null'</span> to match the null value.</div><div style=\"text-align: left;\"><br />Examples:</div><div style=\"text-align: left;\"><br /><span style=\"font-family: courier;\">=&gt; select x-&gt;'id' as id&nbsp;<br /></span><span style=\"font-family: courier;\">from jsonb_array_elements(<br /></span><span style=\"font-family: courier;\">'[{\"id\": 4, \"val\": [null,1,null]},&nbsp;<br /></span><span style=\"font-family: courier;\">{\"id\": 2, \"val\": [3]}]'::jsonb<br /></span><span style=\"font-family: courier;\">) as x,&nbsp;<br /></span><span style=\"font-family: courier;\">jsonb_array_elements(x-&gt;'val') as y&nbsp;<br /></span><span style=\"font-family: courier;\">where y::text = 'null';<br /></span><span style=\"font-family: courier;\">&nbsp;id&nbsp;<br /></span><span style=\"font-family: courier;\">----<br /></span><span style=\"font-family: courier;\">&nbsp;4<br /></span><span style=\"font-family: courier;\">&nbsp;4<br /></span><span style=\"font-family: courier;\">(2 rows)</span><span style=\"font-family: courier;\"><br /></span><span style=\"font-family: courier;\"><br /></span><span style=\"font-family: courier;\"><br /></span><span style=\"font-family: courier;\">=&gt; select x-&gt;'id' as id<br /></span><span style=\"font-family: courier;\">from jsonb_array_elements(<br /></span><span style=\"font-family: courier;\">'[{\"id\": 4, \"val\": [null,1,null]},&nbsp;<br /></span><span style=\"font-family: courier;\">{\"id\": 2, \"val\": [3]}]'::jsonb<br /></span><span style=\"font-family: courier;\">) as x,&nbsp;<br /></span><span style=\"font-family: courier;\">jsonb_array_elements(x-&gt;'val') as y&nbsp;<br /></span><span style=\"font-family: courier;\">group by x-&gt;'id'&nbsp;<br /></span><span style=\"font-family: courier;\">having count(x) filter (where y::text&nbsp; = 'null') &gt; 1;<br /></span><span style=\"font-family: courier;\">&nbsp;id&nbsp;<br /></span><span style=\"font-family: courier;\">----------<br /></span><span style=\"font-family: courier;\">&nbsp;4<br /></span><span style=\"font-family: courier;\">(1 row)</span></div><div style=\"text-align: left;\"><span style=\"font-family: courier;\"><br /></span></div><div style=\"text-align: left;\"><span style=\"font-family: courier;\"><br /></span></div><div style=\"text-align: left;\"><span style=\"font-family: inherit; font-size: x-small;\">Adapted from:&nbsp;<a href=\"https://dba.stackexchange.com/a/257799\">https://dba.stackexchange.com/a/257799</a></span></div><p><span style=\"font-family: courier;\"></span></p>","author":"Tap","siteTitle":"tAp's blog","siteHash":"ec0b5758aa5280680c8b6839677ce27021dd9d4295725ce4f0e9f298aad77c91","entryHash":"ab0240bb7bd8b8364ababb35eb49c0d742f02d08310bfce5dc18f1a6e025854d","category":"Tech"}