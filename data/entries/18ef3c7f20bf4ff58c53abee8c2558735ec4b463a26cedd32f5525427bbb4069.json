{"title":"[Go] บันทึกแก้ไขปัญหาในการจัดการ JSON นิดหน่อย (JSON Serialization)","link":"https://www.somkiat.cc/not-go-with-json-serialization/","date":1620919839000,"content":"<p><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/05/go-json-150x150.jpg\" /></p>\n<figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/05/go-json.jpg\" /></figure>\n\n\n\n<p><strong>ปัญหา</strong><br />ในงานที่ทำ มีกรณีของการทำงานร่วมกับข้อมูลในรูปแบบ JSON<br />ซึ่งในบาง field/property อาจจะมีข้อมูลมาบ้าง ไม่มีบ้าง<br />แถมเป็น null/nill ได้อีก<br />ทำให้การแปลงข้อมูล JSON มาเป็น Struct <br />ไม่ตรงตามที่ต้องการเท่าไร<br />จึงลองหาวิธีการแก้ไขนิดหน่อย</p>\n\n\n\n<span></span>\n\n\n\n<p><strong>แนวทางการแก้ไข</strong></p>\n\n\n\n<p>เริ่มจาก code ปกติงานได้ปกติ</p>\n\n\n\n[gist id=\"56a87e374f87ebcf988f5ab06f89fa56\" file=\"1.go\"]\n\n\n\n<p><strong>แต่เมื่อถ้าบาง property ไม่ได้กำหนดค่า</strong></p>\n\n\n\n<p>จะมีค่าเป็น zero value <br />ยกตัวอย่างที่ property Amount</p>\n\n\n\n[gist id=\"56a87e374f87ebcf988f5ab06f89fa56\" file=\"2.go\"]\n\n\n\n<p><strong>สิ่งที่ต้องการคือ ถ้าไม่ทำการกำหนดค่าของ property Amount </strong></p>\n\n\n\n<p>จะไม่แสดง property Amount มาด้วย<br />โดยเพิ่ม json literal ชื่อว่า <strong>omitempty</strong><br />ก็ทำตามนี้</p>\n\n\n\n[gist id=\"56a87e374f87ebcf988f5ab06f89fa56\" file=\"3.go\"]\n\n\n\n<p><strong>แต่ก็มีบางกรณี ที่มีกำหนดค่าเป็น nil มาด้วย มันจะซับซ้อนไปไหน ?</strong></p>\n\n\n\n<p>จัดการข้อมูลต้นทางดี ๆ ไม่ได้หรือไง ?<br />ตอบเลย ไม่ได้ เศร้า !!<br />ดังนั้นแก้ไขกันหน่อย <br />ด้วยการให้ property ที่มีชนิดเป็น int ให้สามารถรับค่า nil ได้<br />ด้วยการเปลี่ยนเป็น pointer ดังนี้</p>\n\n\n\n[gist id=\"56a87e374f87ebcf988f5ab06f89fa56\" file=\"4.go\"]\n\n\n\n<p>ก็พอแก้ไขให้ทำงานที่ต้องการได้บ้าง</p>\n","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"18ef3c7f20bf4ff58c53abee8c2558735ec4b463a26cedd32f5525427bbb4069","category":"Thai"}