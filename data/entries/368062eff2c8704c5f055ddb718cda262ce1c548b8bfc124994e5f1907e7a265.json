{"title":"ว่าด้วยเรื่อง ID ของ document ใน ElasticSearch","link":"https://www.somkiat.cc/id-in-elasticsearch/","date":1624376729000,"content":"<p><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/06/elasticsearch-150x150.jpg\" /></p>\n<figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/06/elasticsearch.jpg\" /></figure>\n\n\n\n<p>วันนี้เจอปัญหาเรื่อง _id field ของ document ใน ElasticSearch<br />พบว่าในการย้ายเอกสารจาก version ที่ต่ำกว่า 5.0 มายัง version เกิน 5.0<br />อาจจะทำการ dump หรือ reindex ก็ได้<br />จะเจอ error ที่น่าสนใจคือ <strong><em>\"id is too long, must be no longer than 512 bytes but was: 513\"</em></strong></p>\n\n\n\n<span></span>\n\n\n\n<p>คำถามคือ มีสาเหตุมาจากอะไร ?<br />เมื่อไปดูเอกสารใน <strong><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-id-field.html\">Elasticsearch :: _id field</a></strong><br />ก็บอกไว้ว่า ความยาวของ _id ต้องไปเกิน 512 bytes<br />ดังนั้นถ้ายาวเกิน 512 จะถูก reject</p>\n\n\n\n<p>เมื่อไปดูใน <strong><a href=\"https://github.com/elastic/elasticsearch/blob/68c33dc7137bc303664b4322dbb63be649b30782/server/src/main/java/org/elasticsearch/action/index/IndexRequest.java#L209\">source code</a></strong> ก็พบว่าทำการ hard code ไว้เลย</p>\n\n\n\n[gist id=\"7bdc56a2ac311fce25d07fb369852ba9\" file=\"1.java\"]\n\n\n\n<p><strong>คำถามคือ จะแก้ไขปัญหานี้อย่างไร ?</strong></p>\n\n\n\n<p>การแก้ไขไม่ยากคือ การลบ _id ทิ้ง หรือ ทำการ กำหนด _id ให้เป็น null ก่อน<br />จากนั้นจึงทำการ dump หรือ reindex นั้นเอง<br />ยกตัวอย่างการเขียน <strong><a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/master/modules-scripting-painless.html\" target=\"_blank\">painless script</a></strong> ได้เลย</p>\n\n\n\n[gist id=\"7bdc56a2ac311fce25d07fb369852ba9\" file=\"1.txt\"]\n\n\n\n<p><strong>Reference Websites</strong></p>\n\n\n\n<p><a href=\"https://www.joshmlwood.com/elasticsearch-ids-are-hard/\" target=\"_blank\">https://www.joshmlwood.com/elasticsearch-ids-are-hard/</a><br /><a href=\"https://discuss.elastic.co/t/reindexing-failed-validation-failed-1-id-is-too-long-must-be-no-longer-than-512-bytes-but-was-672/185650/4\" target=\"_blank\">https://discuss.elastic.co/t/reindexing-failed-validation-failed-1-id-is-too-long-must-be-no-longer-than-512-bytes-but-was-672/185650/4</a></p>\n","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"368062eff2c8704c5f055ddb718cda262ce1c548b8bfc124994e5f1907e7a265","category":"Thai"}