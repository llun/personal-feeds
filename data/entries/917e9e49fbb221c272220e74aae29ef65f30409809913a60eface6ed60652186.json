{"title":"What’s New In Flutter 2?","link":"https://smashingmagazine.com/2021/03/flutter2-stable-mobile-web-desktop-development-native-speed-one-codebase/","date":1615982400000,"content":"<p>Last year, I wrote two articles here on Smashing Magazine about using <a href=\"https://flutter.dev/\">Flutter</a> on web and desktop platforms. <a href=\"https://www.smashingmagazine.com/2020/04/responsive-web-desktop-development-flutter/\">The first article</a> was a general introduction to web and desktop development, and focused on building responsive UI; <a href=\"https://www.smashingmagazine.com/2020/06/common-cross-platform-issues-flutter/\">the second article</a> was about the challenges you might face when trying to develop a Flutter app that runs on multiple platforms.</p>\n<p>Back then, Flutter support for non-mobile platforms wasn’t considered stable and production-ready by the Flutter team, but things have changed now.</p>\n<h3>Flutter 2 Is Here</h3>\n<p>On the 3rd of March, Google held the <a href=\"https://www.youtube.com/watch?v=yll3SNXvQCw\">Flutter Engage event</a>, where Fluter 2.0 was launched. This release is really a proper 2.0 release, with <a href=\"https://medium.com/flutter/whats-new-in-flutter-2-0-fe8e95ecc65\">many changes</a> promising to make Flutter <em>really</em> ready for going beyond mobile app development.</p>\n<p>The change that is central to understanding why Flutter 2.0 matters is that <em>web development</em> is now officially part of the <strong>stable channel</strong> and desktop support will follow soon on the stable channel as well. In fact, it is currently enabled in release candidate-like form as an early release beta snapshot in the stable channel.</p>\n<p>In the announcement, Google didn’t just give a hint of what the future of Flutter will be like. There were also actual examples of how large companies are already working on Flutter apps to replace their existing apps with ones that perform better and allow developers to be more productive. E.g. the world’s biggest car manufacturer, Toyota, will now be building the infotainment system on their cars using Flutter.</p>\n<p>Another interesting announcement — this one showing how fast Flutter is improving as a cross-platform SDK — is Canonical’s announcement that, in addition to developing their new Ubuntu installer using Flutter, they will also be using <strong>Flutter as their default option</strong> to build desktop apps.</p>\n<p>They also released <a href=\"https://github.com/ubuntu/yaru.dart\">a Flutter version of Ubuntu’s Yaru theme</a>, which we will use later in the article to build a Flutter desktop app that looks perfectly at home in the Ubuntu desktop, also using some more of the new Flutter features. You can take a look at <a href=\"https://developers.googleblog.com/2021/03/announcing-flutter-2.html\">Google’s Flutter 2 announcement</a> to get a more complete picture.</p>\n<p>Let’s look at some of the <strong>technical changes to Flutter</strong> which got onto the stable channel with version 2.0 and build a very simple example desktop app with Flutter before we draw some conclusions on what specific project types we could and couldn’t use Flutter for as of now.</p>\n<h3>General Usability Changes For Bigger Devices</h3>\n<p>According to the announcement, many changes have been made to Flutter to provide better support for devices that aren’t mobile devices.</p>\n<p>For example, an obvious example of something that was needed for web and desktop apps and until now had to be done using third-party packages or by implementing it yourself is a <strong>scrollbar</strong>.</p>\n<p>Now there is a built-in <code>Scrollbar</code> which can fit right into your app, looking exactly how a scrollbar should look in the specific platform: with or without a track, with the possibility of scrolling by clicking on the track, for example, which is huge if you want your users to feel right at home from the start when using your Flutter app. You can also theme it and customize it.</p>\n<p>It also looks like at some point Flutter will automatically <strong>show suitable scrollbars</strong> when the content of the app is scrollable.</p>\n<p>Meanwhile, you can just wrap any scrollable view with the scrollbar widget of your choice and create a <strong><code>ScrollController</code></strong> to add as the <code>controller</code> for both the scrollbar and the scrollable widget (in case you’ve never used a <code>ScrollController</code>, you use exactly like a <code>TextEditingController</code> for a <code>TextField</code>). You can see an example of the use of a regular Material scrollbar a bit further down this article in the desktop app example.</p>\n<h3>Flutter Web Changes</h3>\n<p>Flutter for the web was already in a quite usable form, but there were performance and usability issues which meant it never felt as polished as mobile Flutter. With the release of Flutter 2.0, there have been many improvements to it, especially when it comes to <strong>performance</strong>.</p>\n<p>The compilation target, previously very experimental and tricky to use to render your app (with WebAssembly and Skia) is now called <strong>CanvasKit</strong>. It’s been refined to offer a consistent and performant experience when going from running a Flutter app natively on mobile devices to running it in a browser.</p>\n<p>Now, by default, your app will render using CanvasKit for desktop web users and with the default HTML renderer (which has had improvements as well, but is not as good as CanvasKit) for mobile web users.</p>\n<p>If you’ve tried to use Flutter to build web apps, you might have noticed it wasn’t particularly intuitive to have something as simple as a hyperlink. Now at least, you can create hyperlinks a bit more like you would when using HTML, using the <code>Link</code> class.</p>\n<p>This is actually not an addition to Flutter itself, but a recent addition to <a href=\"https://pub.dev/packages/url_launcher\">Google’s <code>url_launcher</code> package</a>. You can find a complete description and examples of usage of the <code>Link</code> class in <a href=\"https://pub.dev/documentation/url_launcher/latest/link/Link-class.html\">the official API reference</a>.</p>\n<p><strong>Text selection</strong> was improved as now the pivot point corresponds to where the user started selecting text and not the left edge of the <code>SelectableText</code> in question. Also, now Copy/Cut/Paste options exist and work properly.</p>\n<p>Nevertheless, text selection still isn’t top-notch as it’s not possible to select text across different <code>SelectableText</code> widgets and selectable text still isn’t default, but we will talk about this as well as other outstanding Flutter web drawbacks (lack of SEO support, first and foremost) in the conclusion to this article.</p>\n<h3>Flutter Desktop Changes</h3>\n<p>When <a href=\"https://www.smashingmagazine.com/2020/04/responsive-web-desktop-development-flutter/\">I wrote about web and desktop development with Flutter last year</a>, I focused mostly on building web apps with Flutter, given that desktop development was still considered very experimental (not even on the <code>beta</code> channel). Now though, Flutter desktop support is soon to follow web support and will be going stable.</p>\n<p><strong>Performance and stability</strong> have been improved quite a lot, and the improvements in general usability for bigger devices operated with a mouse and keyboard that benefit web apps so much also mean that Flutter desktop apps are now more usable.</p>\n<p>There is still a lack of tooling for desktop apps and there are still many quite severe outstanding bugs, so don’t try to use it for your next desktop app project meant for public distribution.</p>\n<h3>Example Desktop App Built With Flutter</h3>\n<p>Flutter desktop support is now quite stable and usable though, and it will surely get better in the future just as much as Flutter in its entirety has gotten better until now, so let’s give it a try to <strong>see it in action</strong>! You can <a href=\"https://github.com/carzacc/flutter_ubuntu_desktop_example\">download the entire code example on a GitHub repo</a>.</p>\n<p>The app we will build is the following very simple app. We have a sidebar navigation along with some content items for each of the navigation sections.</p>\n<p><img src=\"https://cloud.netlifyusercontent.com/assets/344dbf88-fdf9-42bb-adb4-46f01eedd629/e3a9f52d-72ee-4816-a4cc-cb7453c65148/ubuntuapptree.png\" /></p>\n<p>We are going to restrict the <code>Column</code> on the left (the one showing the controls for the widgets to show on the right side of the app) to a certain width (400 pixels for example) using a <code>Container</code>, whereas the <code>GridView</code> on the right should be <code>Expanded</code> to fill the view.</p>\n<p>On the left side of the <code>Row</code> (within the <code>Column</code>), the <code>ListView</code> should expand to <strong>fill the vertical space</strong> below the <code>Row</code> of buttons at the top. Within the <code>Row</code> at the top, we also need to expand the <code>TextButton</code> (the reset button) to fill the space to the right of the left and right chevron <code>IconButton</code>s.</p>\n<p>The resulting <code>HomePageState</code> that does all of that, along with the necessary logic to show the right stuff on the right depending on what the user selects on the left, is the following:</p>\n<div>\n <pre><code>class HomePageState extends State&lt;HomePage&gt; {\n  int selected = 0;\n\n  ScrollController _gridScrollController = ScrollController();\n\n  incrementSelected() {\n    if (selected != widget.dataToShow.length - 1) {\n      setState(() {\n        selected++;\n      });\n    }\n  }\n\n  decrementSelected() {\n    if (selected != 0) {\n      setState(() {\n        selected--;\n      });\n    }\n  }\n\n  @override\n  Widget build(BuildContext context) {\n    return Scaffold(\n      body: Row(\n        children: [\n          Container(\n              color: Colors.black12,\n              width: 400.0,\n              child: Column(\n                children: [\n                  Row(\n                    children: [\n                      IconButton(\n                        icon: Icon(Icons.chevron_left),\n                        onPressed: decrementSelected,\n                      ),\n                      IconButton(\n                        icon: Icon(Icons.chevron_right),\n                        onPressed: incrementSelected,\n                      ),\n                      Expanded(\n                          child: Center(\n                        child: TextButton(\n                          child: Text(\"Reset\"),\n                          onPressed: () =&gt; setState(() =&gt; selected = 0),\n                        ),\n                      ))\n                    ],\n                  ),\n                  Expanded(\n                    child: ListView.builder(\n                      itemCount: widget.dataToShow.length,\n                      itemBuilder: (_, i) =&gt; ListTile(\n                        title: Text(widget.dataToShow[i].key),\n                        leading: i == selected\n                            ? Icon(Icons.check)\n                            : Icon(Icons.not_interested),\n                        onTap: () {\n                          setState(() {\n                            selected = i;\n                          });\n                        },\n                      ),\n                    ),\n                  ),\n                ],\n              )),\n          Expanded(\n            child: Scrollbar(\n              isAlwaysShown: true,\n              controller: _gridScrollController,\n              child: GridView.builder(\n                  controller: <em>gridScrollController,\n                  itemCount: widget.dataToShow[selected].value.length,\n                  gridDelegate: SliverGridDelegateWithMaxCrossAxisExtent(\n                      maxCrossAxisExtent: 200.0),\n                  itemBuilder: (</em>, i) =&gt; Container(\n                        width: 200.0,\n                        height: 200.0,\n                        child: Padding(\n                          padding: const EdgeInsets.all(8.0),\n                          child: Card(\n                            child: Center(\n                                child:\n                                    Text(widget.dataToShow[selected].value[i])),\n                          ),\n                        ),\n                      )),\n            ),\n          ),\n        ],\n      ),\n    );\n  }\n}\n</code></pre>\n</div>\n\n<p>and we’re done!</p>\n<p>Then you build your app with</p>\n<pre><code>flutter build ${OS_NAME}\n</code></pre>\n\n<p>where <code>${OS_NAME}</code> is the name of your OS, the same you used earlier to enable Flutter desktop development using <code>flutter config</code>.</p>\n<p>The compiled binary to run your app will be</p>\n\n<pre><code>build/linux/x64/release/bundle/flutter_ubuntu_desktop_example</code></pre>\n\n<p>on Linux and</p>\n\n<pre><code>build\\windows\\runner\\Release\\flutter_ubuntu_desktop_example.exe</code></pre>\n\n<p>on Windows, you can run that and you’ll get the app that I showed you at the start of this section.</p>\n<p>On macOS, you need to open <code>macos/Runner.xcworkspace</code> in Xcode and then use Xcode to build and run your app.</p>\n<h3>Other Flutter Changes</h3>\n<p>There have also been a few changes that also affect mobile development with Flutter, and here is just a brief selection of some of them.</p>\n<p>A feature that so many of us, Flutter developers, wanted is better <strong>support for Admob ads</strong>, and it’s now finally included in the official <a href=\"https://pub.dev/packages/google_mobile_ads\"><code>google_mobile_ads</code></a> package. Another one is <code>autocomplete</code>; there is an <a href=\"https://api.flutter.dev/flutter/material/Autocomplete-class.html\"><code>Autocomplete</code> material widget for it</a>, as well as <a href=\"https://api.flutter.dev/flutter/widgets/RawAutocomplete-class.html\">a more customizable <code>RawAutocomplete</code> widget</a>.</p>\n<p>The addition of the <code>Link</code> that we discussed in the section about web development actually <strong>applies to all platforms</strong>, even though its effects will be felt most by those working on Flutter web projects.</p>\n<h4>Recent Dart Language Changes</h4>\n<p>It is important to be aware of the changes that were made to the Dart language that affect Flutter app development.</p>\n<p>In particular, Dart 2.12 brought <strong>C language interoperability support</strong> (described in detail and with instructions for different platforms <a href=\"https://flutter.dev/docs/development/platform-integration/c-interop\">on the official Flutter website</a>); also, sound <code>null-safety</code> was added to the stable Dart release channel.</p>\n<h4><code>null-safety</code></h4>\n\n<p>The biggest change that was made to Dart is the introduction of sound <code>null-safety</code> that it’s getting more and more support from third-party packages as well as the Google-developed libraries and packages.</p>\n<p><em>Null safety</em> brings <strong>compiler optimizations</strong> and reduces the chance of runtime errors so, even though right now it’s optional to support it, it is important you start at least understanding how to make your app null-safe.</p>\n<p>At the moment though, that may not be an option for you as not all Pub packages are fully null-safe and that means that if you need one of those packages for your app you won’t be able to take advantage of the benefits on null-safety.</p>\n<p></p><h4>Making Your App <code>null-safe</code><p></p>\n<p>If you’ve ever worked with Kotlin, Dart’s approach to null safety will be somewhat familiar to you. Take a look at <a href=\"https://dart.dev/null-safety/understanding-null-safety\">Dart’s official guide on it</a> for a more complete guide to Dart’s <code>null-safety</code>.</p>\n<p>All of the types you’re familiar with (<code>String</code>, <code>int</code>, <code>Object</code>, <code>List</code>, your own classes, etc.) are now non-nullable: their value can <em>never</em> be <code>null</code>.</p>\n<p>This means that a function that has a non-nullable return type <strong>must always return a value</strong>, or else you’ll get a compilation error and you always have to initialize non-nullable variables, unless it’s a local variable that gets assigned a value before it’s ever used.</p>\n<p>If you want a variable to be nullable you need to add a question mark to the end of the type name, e.g. when declaring an integer like this:</p>\n<pre><code>int? a = 1\n</code></pre>\n\n<p>At any point, you can set it to <code>null</code> and the compiler won’t cry about it.</p>\n<p>Now, what if you have a nullable value and use it for something that requires a non-nullable value? To do that, you can simply check it isn’t null:</p>\n<pre><code>void function(int? a) {\n    if(a != null) {\n        // a is an int here\n    }\n}\n</code></pre>\n\n<p>If you <em>know</em> with 100% certainty that a variable exists and isn’t null you can just use the <code>!</code> operator, like this:</p>\n<pre><code>String unSafeCode(String? s) =&gt; s!;\n</code></pre>\n\n\n\n<h3>Drawing Conclusions: What Can We Do With Flutter 2?</h3>\n<p>As Flutter keeps evolving, there are more and more things we can do with it, but it’s still not reasonable to say that Flutter can be used for any app development project of any kind.</p>\n<p>On the mobile side, it’s unlikely you’re going to run into something that Flutter isn’t great at because it’s been supported since the start and it’s been polished. Most things you’ll ever need are already there.</p>\n<p>On the other hand, web and desktop aren’t quite there yet.</p>\n<p><strong>Desktop is still a bit buggy</strong> and Windows apps (which are an important part of desktop development) still require a lot of work before they look good. The situation is better on Linux and macOS only to an extent.</p>\n<p><strong>The web is in a much better place than desktop</strong>. You can build decent web apps, but you’re still mostly limited to single-page applications and Progressive Web Apps. We still most certainly don’t want to use it for content-centric apps where indexability and SEO are needed.</p>\n<p>Content-centric apps probably will not be that great because text selection still isn’t top-notch, as we’ve seen in the section about the current state of Flutter for the web.</p>\n<p>If you need the web version of your Flutter app, though, Flutter for the web will probably be just fine, especially as there are a huge amount of <strong>web-compatible packages</strong> around already and the list is always growing.</p>\n<h3>Additional Resources</h3>\n<ul>\n<li><a href=\"https://www.youtube.com/watch?v=zSbsIiluixw\">Keynote (Flutter Engage)</a>, YouTube</li>\n<li><a href=\"https://medium.com/flutter/whats-new-in-flutter-2-0-fe8e95ecc65\">What’s New in Flutter 2</a>, Flutter, Medium</li>\n<li><a href=\"https://dart.dev/null-safety/understanding-null-safety\">Understanding <code>null safety</code></a>, Dart.dev</li>\n<li><a href=\"https://www.smashingmagazine.com/2020/04/responsive-web-desktop-development-flutter/\">Responsive Web And Desktop Development With Flutter</a>, Smashing Magazine</li>\n<li><a href=\"https://www.smashingmagazine.com/2020/06/common-cross-platform-issues-flutter/\">Solving Common Cross-Platform Issues When Working With Flutter</a>, Smashing Magazine</li>\n</ul>\n</h4>","author":"","siteTitle":"Articles on Smashing Magazine — For Web Designers And Developers","siteHash":"ab069ca35bf300e9db0da36f49701f66485a5b0d2db0471dfeee07cef6204939","entryHash":"917e9e49fbb221c272220e74aae29ef65f30409809913a60eface6ed60652186","category":"Tech"}