{"title":"ส่องใบรับรองฉีดวัคซีน COVID ยุโรป การออกแบบฟอร์ตแมตใบรับรองเพื่อ QR โดยเฉพาะ","link":"https://www.blognone.com/node/123596","date":1625600357000,"content":"<div><div><div><p><a href=\"https://www.blognone.com/node/123529\">สัปดาห์ที่ผ่านมาสหภาพยุโรปเริ่มเดินหน้าออกใบรับรอง COVID-19 แบบดิจิทัล</a> ทำให้ชาติสมาชิกสามารถสแกน QR เพื่อตรวจสอบใบรับรองได้ ผมสำรวจการออกแบบ QR ที่สหภาพยุโรปออกแบบครั้งนี้ พบว่ามีความน่าสนใจหลายประการ<a href=\"https://github.com/eu-digital-green-certificates/dgc-overview\">โดยเฉพาะกระบวนการออกใบรับรอง</a>ที่ง่ายเนื่องจากสามารถออกใบรับรองผ่านแอปหรือแม้แต่พิมพ์ใบรับรองเป็นกระดาษด้วยตัวเอง, ยังมีความปลอดภัยสูงด้วยกระบวนการยืนยันข้อมูลด้วยลายเซ็นดิจิทัล, และสุดท้ายคือการออกแบบฟอร์แมตข้อมูลถูกออกแบบด้วยเทคนิคหลายอย่างเพื่อให้ QR มีขนาดเล็กที่สุดเท่าที่เป็นไปได้ เพื่อให้สแกนได้ง่าย</p>\n<p><img src=\"https://www.blognone.com/sites/default/files/externals/c9f4ce6ca8a2ed3f8e2fee011ccaa6af.jpg\" /></p>\n<h3>เริ่มจาก JSON Schema</h3>\n<p>ข้อมูลในใบรับรอง COVID-19 ของสหภาพยุโรปนั้นเริ่มต้นจาก<a href=\"https://ec.europa.eu/health/sites/default/files/ehealth/docs/covid-certificate_json_specification_en.pdf\">ความต้องการออกใบรับรอง 3 ประเภท</a>เพื่อยืนยันว่าผู้ถือใบรับรองปลอดภัยเพียงพอที่จะเดินทางไปยังประเทศต่างๆ ในสหภาพยุโรปได้โดยไม่ต้องถูกกักตัว โดยใบรับรองมีข้อมูลพื้นฐานเหมือนกันทุกใบ ได้แก่ เวอร์ชั่นข้อมูล, ชื่อผู้ถือใบรับรอง, และวันเกิดผู้ถือใบรับรอง (เพื่อยืนยันว่าตรงกับบัตรประจำตัว)</p>\n<p><img src=\"https://www.blognone.com/sites/default/files/externals/b091c2513b6efa0361af03c027a489ea.png\" /></p>\n<p>จากนั้นภายในจะมีใบรับรองประเภทย่อยอีก 3 ประเภท ได้แก่</p>\n<ul>\n<li>v (vaccinated) ใบรับรองว่าฉีดวัคซีนเรียบร้อยแล้ว ระบุข้อมูลวัคซีน ชื่อวัคซีน, ผู้ผลิต, วันที่ฉีด, จำนวนโดสที่ฉีด, จำนวนโดสที่ต้องฉีด (วัคซีนบางตัวต้องการเข็มเดียว หรือบางประเทศระบุให้ผู้หายป่วยได้รับเข็มเดียว), ผู้ออกใบรับรอง</li>\n<li>t (test) ใบรับรองผลการตรวจ COVID-19 ระบุเทคนิคการตรวจ, อุปกรณ์ที่ใช้ตรวจ, วันที่ตรวจ, ผลการตรวจ, หน่วยงานผู้ตรวจ, ผู้ออกใบรับรอง</li>\n<li>r (recovery) ใบรับรองหายป่วย ระบุวันที่ตรวจพบเชื้อ, วันที่ยืนยันว่าหายป่วย (ต้องหลังวันพบเชื้อ 11 วันขึ้นไป), วันหมดอายุใบรับรอง (ไม่เกิน 180 วัน), ผู้ออกใบรับรอง</li>\n</ul>\n<h3>แปลงเป็นไบนารี เซ็น บีบอัด</h3>\n<p>จากข้อมูลแบบ JSON ทีมงานเริ่มแนวทางการบีบอัดข้อมูลนี้ให้เล็กที่สุดเพื่อให้ได้ QR ที่สแกนได้ง่าย โดยใช้มาตรฐาน CBOR (<a href=\"https://www.rfc-editor.org/rfc/rfc8949.html\">RFC8949</a>) ที่เทียบเท่ากับ JSON แต่เป็นไบนารีทำให้ข้อมูลมีขนาดเล็กกว่า จากก่อนหน้านี้ที่ตัว schema ของข้อมูลก็ออกแบบให้มีขนาดเล็กด้วยชื่อฟิลด์ย่อให้สั้น (nam = name, dob = date of birth, is = issuer) อยู่แล้ว</p>\n<p>หลังจากแปลงข้อมูลเป็น CBOR แล้ว ข้อความภายในใบรับรองจะถูกเซ็นด้วยกุญแจลับของหน่วยงานออกใบรับรองที่มักเป็นกระทรวงสาธารณสุขของแต่ละชาติ โดยการเซ็นใช้ฟอร์แมต COSE (<a href=\"https://datatracker.ietf.org/doc/html/rfc8152\">RFC8152</a>) ไฟล์ที่ได้จะพร้อมใช้สำหรับการตรวจสอบโดยชาติสมาชิกแล้ว</p>\n<p>แต่เนื่องจากข้อมูลจำนวนมากในใบรับรองเป็นสตริงที่อาจจะบีบอัดลงไปได้อีก มาตรฐานใบรับรองระบุให้บีบอัดไบนารีด้วย DEFLATE ไปอีกขั้น</p>\n<h3>Base-45 และ QR</h3>\n<p>หลังจากบีบอัดแล้วข้อมูลใบรับรองแบบไบนารีจะได้ขนาดเล็กเพื่อส่งต่อแล้ว แต่เนื่องจากกระบวนการส่งต่อไฟล์นั้นทำได้ลำบาก การออกใบรับรองเป็น QR นั้นง่ายกว่ามาก เพราะทุกคนสามารถพิมพ์หรือเพียงแสดงหน้าจอโทรศัพท์ให้หน่วยงานตรวจสอบ แต่ QR นั้นไม่รองรับข้อมูลแบบไบนารีโดยตรง โดยทั่วไปแล้วหากต้องการเข้ารหัสข้อมูลไบนารีเป็นสตริง นักพัฒนาก็มักจะใช้งาน Base-64 เพื่อให้แน่ใจว่าปลายทางอ่านข้อมูลได้</p>\n<p>แต่ Base-64 นั้นมีปัญหาว่าจะเพิ่มขนาดข้อมูลไปถึง 33% โดยข้อมูล 3 ไบต์ (24 บิต) เมื่อแปลงเป็น Base-64 จะใช้ขนาด 4 ไบต์ (32 บิต) ทางผู้ออกแบบใบรับรองของสหภาพยุโรปอาศัยฟีเจอร์ Alphanumeric ของมาตรฐาน QR (ISO18004) ที่สามารถแสดงข้อมูลตัวอักษร (A-Z), ตัวเลข (0-9), และสัญลักษณ์อีก 9 แบบ รวม 45 อักขระ ตัวอักษรทุกๆ 2 ตัวจะใช้บิตบน QR ทั้งหมด 11 บิตเท่านั้น</p>\n<p>ความได้เปรียบของโหมด 45 ตัวอักษรของ QR ทำให้มีการเสนอ<a href=\"https://datatracker.ietf.org/doc/draft-faltstrom-base45/\">มาตรฐาน Base-45</a> เข้าไปยัง IETF โดย Base-45 สามารถเข้ารหัสข้อมูล 2 ไบต์ (16 บิต) โดยใช้ 3 ตัวอักษร เมื่อรวมเข้ากับโหมด 45 ตัวอักษรของ QR จะทำให้<strong>ทุกๆ 4 ไบต์ (32 บิต) จะใช้ข้อมูลบน QR จริงๆ เพียง 33 บิตเท่านั้น</strong> นับว่าเป็นกระบวนการเข้ารหัสที่ได้ประสิทธิพื้นที่ QR สูง โดยคงความเข้ากันได้กับโปรแกรมอ่าน QR จำนวนมาก</p>\n<h3>การกระจายกุญแจสาธารณะ</h3>\n<p><img src=\"https://www.blognone.com/sites/default/files/externals/399bcbabb5000da3f44ac329d6d91418.jpg\" /></p>\n<p>กระบวนการตรวจสอบใบรับรอง COSE นี้ต้องอาศัยการกระจายกุญแจสาธารณะของหน่วยงานออกใบรับรองทุกหน่วย ให้กับชาติสมาชิกอื่นๆ ชาติสมาชิกจะกระจายกุญแจสาธารณะของตัวเองเข้าไปยัง EU gateway วันละรอบ เพื่อให้ชาติสมาชิกอื่นๆ ที่จะดาวน์โหลดวันละรอบเช่นกัน เมื่อแต่ละชาติสมาชิกดาวน์โหลดรายการกุญแจสาธารณะแล้วก็จะสามารถยืนยันความถูกต้องของใบรับรอง COVID-19 ได้โดยไม่มีการส่งต่อข้อมูลในตัวใบรับรองแต่อย่างใด เจ้าหน้าที่เพียงตรวจสอบชื่อและวันเกิดให้ตรงกับใบรับรองและยืนยันว่าเงื่อนไขของชาติตนยอมรับเงื่อนไข (การฉีดวัคซีน, หายป่วย, หรือผลทดสอบเป็นลบ) หรือไม่</p>\n<p>นอกจากนี้ระบบหลังบ้านยังมีระบบแชร์กฎการตรวจสอบว่าแต่ละชาติมีเงื่อนไขยอมรับการเดินทางหรือวัคซีนอย่างไรให้อัพโหลดผ่าน EU gateway เพื่อให้ชาติสมาชิกตรวจสอบได้ว่าเงื่อนไขในใบรับรองนั้นสามารถเดินทางไปชาติใดได้บ้าง</p>\n<p>กระบวนการออกใบรับรองดิจิทัลนั้นมีมานานแล้ว ที่เราเห็นทุกวันนี้คือหนังสือเดินทาง (passport) อิเล็กทรอนิกส์ที่ภายในคือข้อมูลดิจิทัลพร้อมลายเซ็นดิจิทัลของกระทรวงต่างประเทศชาติต่างๆ แต่หนังสือเดินทางใช้เวลาในการอิมพลีเมนต์ระบบยาวนาน หลายชาติยังไม่ได้ใช้เครื่องอ่านข้อมูลดิจิทัล หรือแม้แต่บางชาติที่ใช้งานก็ไม่ได้ตรวจสอบความถูกต้องของลายเซ็นดิจิทัล เหตุผลหนึ่งคือการออกหนังสือเดินทางนั้นใช้เวลายาวนาน หนังสือเดินทางอาจจะมีอายุการใช้งานถึง 10 ปี การออกหนังสือเดินทางมีต้นทุนสูง การเปลี่ยนผ่านใช้เวลานาน การออกแบบหนังสือรับรองดิจิทัลในรูปแบบ QR ของยุโรปครั้งนี้เปิดทางให้องค์กรจำนวนมากสามารถอ่านและยืนยันเอกสารดิจิทัลได้ง่ายภายในเวลาอันรวดเร็ว การกระจายใบรับรองและการเพิ่มจำนวนจุดตรวจสามารถทำได้ทั่วถึง เพราะประชาชนทั่วไปเพียงถือ QR โดยไม่ต้องอาศัยเอกสารสำคัญที่มีเทคโนโลยีการผลิตซับซ้อน ฝั่งเจ้าหน้าที่ผู้ตรวจสอบเองก็ใช้เพียงโทรศัพท์มือถือที่มีกล้องเท่านั้น น่าสนใจว่าแนวทางการออกแบบครั้งนี้จะมีการใช้งานต่อไปในอนาคตได้มากน้อยเพียงใด</p>\n</div></div></div><div><div>Topics: </div><div><div><a href=\"/topics/eu\">EU</a></div><div><a href=\"/topics/covid-19\">COVID-19</a></div></div></div>","author":"lew","siteTitle":"Blognone","siteHash":"ededadcf18490b3937e7dd89ebe8c00dc129addbdf1ebe4aff1f458146693da0","entryHash":"405647c51ea5cb47564b60eb86f129d85bc842e19bf8cd6f08ed74b9c883c3c3","category":"Thai"}