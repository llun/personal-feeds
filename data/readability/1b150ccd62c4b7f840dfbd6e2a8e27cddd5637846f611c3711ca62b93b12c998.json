{"title":"Raspberry Pi OS added a Microsoft repo. No, it’s not an evil secret","link":"https://arstechnica.com/?p=1740528","date":1612809775000,"content":"<div id=\"readability-page-1\" class=\"page\"><div><header><h4>it's just a repo folks —</h4><h2 itemprop=\"description\">Adding Microsoft's repository allows Pi users to \"apt install code\" and be done.</h2></header><div itemprop=\"articleBody\"><div><ul><li data-thumb=\"https://cdn.arstechnica.net/wp-content/uploads/2021/02/vscode-in-sources-list-d-150x150.png\" data-src=\"https://cdn.arstechnica.net/wp-content/uploads/2021/02/vscode-in-sources-list-d.png\" data-responsive=\"https://cdn.arstechnica.net/wp-content/uploads/2021/02/vscode-in-sources-list-d-980x551.png 1080, https://cdn.arstechnica.net/wp-content/uploads/2021/02/vscode-in-sources-list-d-1440x810.png 2560\" data-sub-html=\"#caption-1740546\"><figure><figcaption id=\"caption-1740546\"><span></span><p>The controversial Pi update just adds Microsoft's VS Code repo in a separate file in sources.list.d. No actual packages were installed.</p><p><span></span> Jim Salter</p></figcaption></figure></li><li data-thumb=\"https://cdn.arstechnica.net/wp-content/uploads/2021/02/microsoft-vscode-repo-150x150.png\" data-src=\"https://cdn.arstechnica.net/wp-content/uploads/2021/02/microsoft-vscode-repo.png\" data-responsive=\"https://cdn.arstechnica.net/wp-content/uploads/2021/02/microsoft-vscode-repo-980x551.png 1080, https://cdn.arstechnica.net/wp-content/uploads/2021/02/microsoft-vscode-repo-1440x810.png 2560\" data-sub-html=\"#caption-1740544\"><figure><figcaption id=\"caption-1740544\"><span></span><p>Digging in one step further, we can see that there are only three packages in the newly added repo; all three are Visual Studio Code related. (The other two packages are alternate builds, with newer versions of Electron and some other changes.)</p><p><span></span> Jim Salter</p></figcaption></figure></li><li data-thumb=\"https://cdn.arstechnica.net/wp-content/uploads/2021/02/vscode-metadata-missing-fixed-150x150.png\" data-src=\"https://cdn.arstechnica.net/wp-content/uploads/2021/02/vscode-metadata-missing-fixed.png\" data-responsive=\"https://cdn.arstechnica.net/wp-content/uploads/2021/02/vscode-metadata-missing-fixed-980x551.png 1080, https://cdn.arstechnica.net/wp-content/uploads/2021/02/vscode-metadata-missing-fixed-1440x810.png 2560\" data-sub-html=\"#caption-1740557\"><figure><figcaption id=\"caption-1740557\"><span></span><p>My only real complaint about the Microsoft repo and packages is a lack of descriptive metadata. This is clearly an honest oversight on Microsoft's part, since the metadata (although awfully basic) is present in apt-cache search, just not in apt search.</p><p><span></span> Jim Salter</p></figcaption></figure></li></ul></div><p>We were recently alerted to something of a tempest in a teapot: when the Raspberry Pi Foundation made it easier to install Microsoft's Visual Studio Code development environment, some Linux users mistook it for a sort of Mark of the Beast, with concerns being <a href=\"https://www.cyberciti.biz/linux-news/heads-up-microsoft-repo-secretly-installed-on-all-raspberry-pis-linux-os/\">raised</a> about telemetry and \"what Microsoft repo secretly installed without your knowledge.\"</p><p>It's true that an update recently pushed to Raspberry Pi OS added a Microsoft repo to Raspberry Pi OS systems—but it's not true that it added any actual packages whatsoever.</p><h2>Investigating the changes</h2><figure><a href=\"https://cdn.arstechnica.net/wp-content/uploads/2021/02/pi400.jpg\" data-height=\"1056\" data-width=\"1440\" alt=\"Just to the right of the 40-pin GPIO header, you can see the Pi 400's SD card slot. Want to play with two different distros without the hassle of uninstalling and reinstalling when you switch? Just use two different SD cards!\"><img alt=\"Just to the right of the 40-pin GPIO header, you can see the Pi 400's SD card slot. Want to play with two different distros without the hassle of uninstalling and reinstalling when you switch? Just use two different SD cards!\" src=\"https://cdn.arstechnica.net/wp-content/uploads/2021/02/pi400-640x469.jpg\" width=\"640\" height=\"469\" srcset=\"https://cdn.arstechnica.net/wp-content/uploads/2021/02/pi400-1280x939.jpg 2x\"></a><figcaption><p><a href=\"https://cdn.arstechnica.net/wp-content/uploads/2021/02/pi400.jpg\" data-height=\"1056\" data-width=\"1440\">Enlarge</a> <span>/</span> Just to the right of the 40-pin GPIO header, you can see the Pi 400's SD card slot. Want to play with two different distros without the hassle of uninstalling and reinstalling when you switch? Just use two different SD cards!</p><p>Jim Salter</p></figcaption></figure><p>Luckily, my own Raspberry Pi 400 was running Ubuntu, not Raspberry Pi OS, which made it easy to switch back to see what changes occurred in the system. Equally luckily, the Raspberry Pi 400 is almost ideally suited to distro-hopping—all I needed to do to get a pre-update version of Pi OS running was to power my Pi off, swap SD cards from the Ubuntu card I had been using to my old Pi OS card, and then fire it back up. Presto, a pre-update Pi!</p><p>Next, I made a copy of the entire <code>/etc/apt/</code>&nbsp;directory on my Pi 400, with <code>tar czvf ~/aptbackup.tar.gz /etc/apt</code>. With backup in place, I did <code>apt update ; apt upgrade -y</code>&nbsp;to apply all the upgrades to my system that it had missed since it was last running Pi OS.</p><p>To make a long story short, the only change to my package management was the addition of a single file, <code>/etc/apt/sources.list.d/vscode.list</code>. That file added a single repository to my sources: <code>http://packages.microsoft.com/repos/code</code>, with branches <code>stable</code>&nbsp;and <code>main</code>. If we look at the actual content of <code>http://packages.microsoft.com/repos/code</code>, we can see it only contains three packages: <code>code</code>, <code>code-exploration</code>, and <code>code-insiders</code>.</p><p>Finally, performing <code>apt policy code</code>&nbsp;confirms that Visual Studio Code was not actually installed on my system—it's just&nbsp;<em>easier</em> to install (and update!) now, since its parent repository is part of my sources list, along with the GPG code verifying the contents of that repository.</p><h2>Why add a third-party repo?</h2><p>Prior to the Pi Foundation adding Microsoft's repo for Visual Studio Code to the list, <a href=\"https://pimylifeup.com/raspberry-pi-visual-studio-code/\">installing</a> that IDE required some extra, and rather non-Linux-y, steps. You needed to open up a Web browser, go to the Visual Studio Code <a href=\"https://code.visualstudio.com/#alt-downloads\">download page</a>, and navigate a few more minor hurdles—for example, you need to know that your system wants <code>deb</code>&nbsp;files and not <code>rpm</code>, that your Pi needs ARM architecture packages, and finally whether those packages should be <code>ARM</code>&nbsp;or <code>ARM64</code>&nbsp;(which is different for different models of Pi).</p><p>Once you had downloaded the hopefully correct version of the Visual Studio Code package, you then needed to locate the downloaded package and execute it—typically, by finding it in File Manager and double-clicking it. Once that was done, you'd need to authenticate as a privileged user, and finally the package (and its dependencies) would begin to download and install themselves on your Pi.</p><p>By contrast, now that the <code>code</code>&nbsp;repo (and its GPG key) are installed on the system, a user can simply <code>sudo apt install code</code>. This is a more Unix-like way to do things, it's considerably simpler, and it can be far more easily performed without a GUI available as well.</p><p>We can already hear some users grumbling that it wasn't that hard to install VS Code the old way—and to them, we'd like to point out that the primary purpose of the Raspberry Pi foundation isn't to provide advanced users with cheap toys, it's to facilitate computer education by removing roadblocks.</p><p>The first of those roadblocks, arguably, was of course price—it's difficult to impossible to get a full-featured, general-purpose computing device for less than it costs to buy a Pi. But the difficulty of getting started with writing code is another of those potential roadblocks—so making it easier to install a very popular IDE is very much in line with the Pi Foundation's core mission.</p><h2>What are the consequences?</h2><p>With Microsoft's repository for VS Code installed on the system, each time the system checks for updates, the server at <code>http://packages.microsoft.com</code>&nbsp;gets queries to see if there are any changes to the packages it makes available. If you squint your eyes really tight and hold your mouth just right, you might argue that this constitutes \"telemetry\"—you touched a Microsoft server, right?</p><p>However, this is, in Pi founder Eben Upton's words, \"pretty thin gruel.\" The only tool touching that Web server is <code>apt</code>&nbsp;itself, and it does not reveal anything about the user's system—it simply checks to see what's in <code>/repos/vscode/dists/stable</code>&nbsp;and downloads the appropriate <code>Contents-*.gz</code>&nbsp;file for your system architecture. On my Pi 400, that's <code>Contents-arm64.gz</code>; on older 32-bit Pis, it would be <code>Contents-armhf.gz</code>.</p><p>With the Contents file downloaded, <code>apt</code>&nbsp;then parses it to determine what package versions are available. This data informs <code>apt</code>'s responses to any user requests to <code>install</code>&nbsp;a matching package name and also lets it know whether there are newer versions of&nbsp;<em>installed</em> packages that should be downloaded and put in place after an <code>apt upgrade</code>&nbsp;or <code>apt dist-upgrade</code>&nbsp;command. But none of this information is leaked to Microsoft unless the user actually&nbsp;<em>has</em> installed <code>code</code>; in that case, Microsoft will know when a newer version of it is downloaded (since that, too, comes from `packages.microsoft.com`).</p><p>For the overwhelmingly paranoid, there is one further possibility: if Microsoft were to make packages available in its repo with the same names as packages in the standard <code>raspbian.raspberripi.org</code>&nbsp;repository specified in <code>/etc/apt/sources.list</code>, it could override the \"real\" system packages with others of its own making.</p><p>However, that would be an incredibly obvious change on Microsoft's part—one that would be detected almost immediately after the company made it—and would effectively result in the immediate destruction of all the goodwill in the Linux community the company has spent the last <a href=\"https://cloudblogs.microsoft.com/windowsserver/2015/05/06/microsoft-loves-linux/\">six years</a>&nbsp;painstakingly building. This does not strike us as a reasonable concern.</p><h2>OK, fine. What if I still don't like it?</h2><p>If you've gotten this far and you're still upset that a Microsoft repo is present on your Raspberry Pi system, you have options. The most nuclear option is to ditch Raspberry Pi OS entirely—you can always <a href=\"https://arstechnica.com/gadgets/2020/10/ubuntu-groovy-gorilla-adds-raspberry-pi-as-a-first-class-citizen/\">run</a> Ubuntu on your Pi, for one example. There are also ready-made vanilla Debian images <a href=\"https://wiki.debian.org/RaspberryPi\">available</a> for the Pi, hosted at debian.org itself.</p><p>But it would be much simpler to just nerf the repository you're unhappy about in the first place. There are several ways to do that: for example, you can edit or remove the <code>vscode.list</code>&nbsp;file itself. And if you're worried about future Pi OS updates putting that file back or undoing your change, you can add an entry to <code>/etc/hosts</code>&nbsp;making it impossible to contact Microsoft's repository in the first place:</p><p>Presto! If your system attempts to check Microsoft's repo, it will instead check... itself, which will then fail. Problem solved.</p><p><em>Listing image by Jim Salter</em></p></div></div></div>","author":"Jim Salter","siteTitle":"Ars Technica","siteHash":"5b0ddf6e8923e49262a7894cfd77962733e43fbcc565a103b48373820b310636","entryHash":"1b150ccd62c4b7f840dfbd6e2a8e27cddd5637846f611c3711ca62b93b12c998","category":"Tech"}