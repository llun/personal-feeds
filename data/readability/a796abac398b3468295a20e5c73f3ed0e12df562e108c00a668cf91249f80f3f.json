{"title":"Golang :: ว่าง ๆ มาลองใช้งาน chi router","link":"https://www.somkiat.cc/golang-with-chi-router/","date":1616170481000,"content":"<div id=\"readability-page-1\" class=\"page\"><div id=\"page\"><article><div id=\"content_box\"><header><div><p><time>March 19, 2021</time> <span><a href=\"https://www.somkiat.cc/category/programming/\" rel=\"category tag\">Programming</a></span></p></div></header><div><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/03/go-chi.png\" alt=\"\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/03/go-chi.png 595w, https://www.somkiat.cc/wp-content/uploads/2021/03/go-chi-300x176.png 300w\" sizes=\"(max-width: 595px) 100vw, 595px\"></figure><p>ก่อนหน้านี้ทำการพัฒนา Go HTTP service นั้น<br>ใช้งานทั้ง net/http, Echo และ Gin เป็นหลัก<br>แต่มีอีกตัวที่น่าสนใจคือ <strong><a rel=\"noreferrer noopener\" href=\"https://github.com/go-chi/chi\" target=\"_blank\">Chi</a></strong><br>หลัก ๆ ทำงานในส่วนของ router สำหรับ REST API<br>โดยที่สนับสนุน context package ของ Go ด้วย</p><p><strong>จุดเด่นของ Chi ประกอบไปด้วย</strong></p><ul><li>มีขนาดเล็ก โดย code ประมาณ 1,000 บรรทัด และไม่มี depenedncy อื่น ๆ นอกจาก G standard และ net/http package เท่านั้น</li><li>มี <a href=\"https://github.com/go-chi/chi/tree/master/middleware\" target=\"_blank\" rel=\"noreferrer noopener\">Middleware</a> ให้ใช้เพียบ</li><li>เร็วใช้ได้เลย</li><li>จัดการ router ง่ายมาก ๆ ทั้งจัด group และ sub-group</li><li>Doc generation (<strong><a href=\"https://github.com/go-chi/docgen\" target=\"_blank\" rel=\"noreferrer noopener\">docgen</a></strong>) ทำการสร้างเอกสารจาก code ในรูปแบบ JSON หรือ Markdown แต่ยังไม่สนับสนุน Chi version 5</li></ul><p>ลองเขียนนิดหน่อย</p><p><strong>เริ่มจากการสร้าง router ของระบบก่อน</strong></p><p>และใช้ middleware ตัวเดียวคือ Logger</p><div itemprop=\"text\" id=\"gist108549712\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-main-go-L1\" data-line-number=\"1\"></td><td id=\"file-main-go-LC1\"><span>package</span> main</td></tr><tr><td id=\"file-main-go-L2\" data-line-number=\"2\"></td><td id=\"file-main-go-LC2\"></td></tr><tr><td id=\"file-main-go-L3\" data-line-number=\"3\"></td><td id=\"file-main-go-LC3\"><span>import</span> (</td></tr><tr><td id=\"file-main-go-L4\" data-line-number=\"4\"></td><td id=\"file-main-go-LC4\"><span>\"log\"</span></td></tr><tr><td id=\"file-main-go-L5\" data-line-number=\"5\"></td><td id=\"file-main-go-LC5\"><span>\"net/http\"</span></td></tr><tr><td id=\"file-main-go-L6\" data-line-number=\"6\"></td><td id=\"file-main-go-LC6\"></td></tr><tr><td id=\"file-main-go-L7\" data-line-number=\"7\"></td><td id=\"file-main-go-LC7\"><span>\"github.com/go-chi/chi/v5\"</span></td></tr><tr><td id=\"file-main-go-L8\" data-line-number=\"8\"></td><td id=\"file-main-go-LC8\"><span>\"github.com/go-chi/chi/v5/middleware\"</span></td></tr><tr><td id=\"file-main-go-L9\" data-line-number=\"9\"></td><td id=\"file-main-go-LC9\">)</td></tr><tr><td id=\"file-main-go-L10\" data-line-number=\"10\"></td><td id=\"file-main-go-LC10\"></td></tr><tr><td id=\"file-main-go-L11\" data-line-number=\"11\"></td><td id=\"file-main-go-LC11\"><span>func</span> <span>main</span>() {</td></tr><tr><td id=\"file-main-go-L12\" data-line-number=\"12\"></td><td id=\"file-main-go-LC12\"><span>port</span> <span>:=</span> <span>\"8080\"</span></td></tr><tr><td id=\"file-main-go-L13\" data-line-number=\"13\"></td><td id=\"file-main-go-LC13\"><span>log</span>.<span>Printf</span>(<span>\"Starting up on http://localhost:%s\"</span>, <span>port</span>)</td></tr><tr><td id=\"file-main-go-L14\" data-line-number=\"14\"></td><td id=\"file-main-go-LC14\"></td></tr><tr><td id=\"file-main-go-L15\" data-line-number=\"15\"></td><td id=\"file-main-go-LC15\"><span>r</span> <span>:=</span> <span>chi</span>.<span>NewRouter</span>()</td></tr><tr><td id=\"file-main-go-L16\" data-line-number=\"16\"></td><td id=\"file-main-go-LC16\"><span>r</span>.<span>Use</span>(<span>middleware</span>.<span>Logger</span>)</td></tr><tr><td id=\"file-main-go-L17\" data-line-number=\"17\"></td><td id=\"file-main-go-LC17\"><span>r</span>.<span>Get</span>(<span>\"/\"</span>, <span>func</span>(<span>w</span> http.<span>ResponseWriter</span>, <span>r</span> <span>*</span>http.<span>Request</span>) {</td></tr><tr><td id=\"file-main-go-L18\" data-line-number=\"18\"></td><td id=\"file-main-go-LC18\"><span>w</span>.<span>Write</span>([]<span>byte</span>(<span>\"Hello World!\"</span>))</td></tr><tr><td id=\"file-main-go-L19\" data-line-number=\"19\"></td><td id=\"file-main-go-LC19\">})</td></tr><tr><td id=\"file-main-go-L20\" data-line-number=\"20\"></td><td id=\"file-main-go-LC20\"></td></tr><tr><td id=\"file-main-go-L21\" data-line-number=\"21\"></td><td id=\"file-main-go-LC21\"><span>r</span>.<span>Mount</span>(<span>\"/posts\"</span>, <span>postsResource</span>{}.<span>Routes</span>())</td></tr><tr><td id=\"file-main-go-L22\" data-line-number=\"22\"></td><td id=\"file-main-go-LC22\"></td></tr><tr><td id=\"file-main-go-L23\" data-line-number=\"23\"></td><td id=\"file-main-go-LC23\"><span>log</span>.<span>Fatal</span>(<span>http</span>.<span>ListenAndServe</span>(<span>\":\"</span><span>+</span><span>port</span>, <span>r</span>))</td></tr><tr><td id=\"file-main-go-L24\" data-line-number=\"24\"></td><td id=\"file-main-go-LC24\">}</td></tr></tbody></table></div><p><strong>ทำในส่วนของการทำงานของ /post นิดหน่อย</strong></p><div itemprop=\"text\" id=\"gist108549712\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-post-go-L1\" data-line-number=\"1\"></td><td id=\"file-post-go-LC1\"><span>package</span> main</td></tr><tr><td id=\"file-post-go-L2\" data-line-number=\"2\"></td><td id=\"file-post-go-LC2\"></td></tr><tr><td id=\"file-post-go-L3\" data-line-number=\"3\"></td><td id=\"file-post-go-LC3\"><span>import</span> (</td></tr><tr><td id=\"file-post-go-L4\" data-line-number=\"4\"></td><td id=\"file-post-go-LC4\"><span>\"io\"</span></td></tr><tr><td id=\"file-post-go-L5\" data-line-number=\"5\"></td><td id=\"file-post-go-LC5\"><span>\"net/http\"</span></td></tr><tr><td id=\"file-post-go-L6\" data-line-number=\"6\"></td><td id=\"file-post-go-LC6\"></td></tr><tr><td id=\"file-post-go-L7\" data-line-number=\"7\"></td><td id=\"file-post-go-LC7\"><span>\"github.com/go-chi/chi/v5\"</span></td></tr><tr><td id=\"file-post-go-L8\" data-line-number=\"8\"></td><td id=\"file-post-go-LC8\">)</td></tr><tr><td id=\"file-post-go-L9\" data-line-number=\"9\"></td><td id=\"file-post-go-LC9\"></td></tr><tr><td id=\"file-post-go-L10\" data-line-number=\"10\"></td><td id=\"file-post-go-LC10\"><span>type</span> <span>postsResource</span> <span>struct</span>{}</td></tr><tr><td id=\"file-post-go-L11\" data-line-number=\"11\"></td><td id=\"file-post-go-LC11\"></td></tr><tr><td id=\"file-post-go-L12\" data-line-number=\"12\"></td><td id=\"file-post-go-LC12\"><span>func</span> (<span>rs</span> <span>postsResource</span>) <span>Routes</span>() chi.<span>Router</span> {</td></tr><tr><td id=\"file-post-go-L13\" data-line-number=\"13\"></td><td id=\"file-post-go-LC13\"><span>r</span> <span>:=</span> <span>chi</span>.<span>NewRouter</span>()</td></tr><tr><td id=\"file-post-go-L14\" data-line-number=\"14\"></td><td id=\"file-post-go-LC14\"><span>r</span>.<span>Get</span>(<span>\"/\"</span>, <span>rs</span>.<span>List</span>)</td></tr><tr><td id=\"file-post-go-L15\" data-line-number=\"15\"></td><td id=\"file-post-go-LC15\"><span>return</span> <span>r</span></td></tr><tr><td id=\"file-post-go-L16\" data-line-number=\"16\"></td><td id=\"file-post-go-LC16\">}</td></tr><tr><td id=\"file-post-go-L17\" data-line-number=\"17\"></td><td id=\"file-post-go-LC17\"></td></tr><tr><td id=\"file-post-go-L18\" data-line-number=\"18\"></td><td id=\"file-post-go-LC18\"><span>func</span> (<span>rs</span> <span>postsResource</span>) <span>List</span>(<span>w</span> http.<span>ResponseWriter</span>, <span>r</span> <span>*</span>http.<span>Request</span>) {</td></tr><tr><td id=\"file-post-go-L19\" data-line-number=\"19\"></td><td id=\"file-post-go-LC19\"><span>resp</span>, <span>err</span> <span>:=</span> <span>http</span>.<span>Get</span>(<span>\"https://jsonplaceholder.typicode.com/posts\"</span>)</td></tr><tr><td id=\"file-post-go-L20\" data-line-number=\"20\"></td><td id=\"file-post-go-LC20\"><span>if</span> <span>err</span> <span>!=</span> <span>nil</span> {</td></tr><tr><td id=\"file-post-go-L21\" data-line-number=\"21\"></td><td id=\"file-post-go-LC21\"><span>http</span>.<span>Error</span>(<span>w</span>, <span>err</span>.<span>Error</span>(), <span>http</span>.<span>StatusInternalServerError</span>)</td></tr><tr><td id=\"file-post-go-L22\" data-line-number=\"22\"></td><td id=\"file-post-go-LC22\"><span>return</span></td></tr><tr><td id=\"file-post-go-L23\" data-line-number=\"23\"></td><td id=\"file-post-go-LC23\">}</td></tr><tr><td id=\"file-post-go-L24\" data-line-number=\"24\"></td><td id=\"file-post-go-LC24\"></td></tr><tr><td id=\"file-post-go-L25\" data-line-number=\"25\"></td><td id=\"file-post-go-LC25\"><span>defer</span> <span>resp</span>.<span>Body</span>.<span>Close</span>()</td></tr><tr><td id=\"file-post-go-L26\" data-line-number=\"26\"></td><td id=\"file-post-go-LC26\"></td></tr><tr><td id=\"file-post-go-L27\" data-line-number=\"27\"></td><td id=\"file-post-go-LC27\"><span>w</span>.<span>Header</span>().<span>Set</span>(<span>\"Content-Type\"</span>, <span>\"application/json\"</span>)</td></tr><tr><td id=\"file-post-go-L28\" data-line-number=\"28\"></td><td id=\"file-post-go-LC28\"><span>if</span> <span>_</span>, <span>err</span> <span>:=</span> <span>io</span>.<span>Copy</span>(<span>w</span>, <span>resp</span>.<span>Body</span>); <span>err</span> <span>!=</span> <span>nil</span> {</td></tr><tr><td id=\"file-post-go-L29\" data-line-number=\"29\"></td><td id=\"file-post-go-LC29\"><span>http</span>.<span>Error</span>(<span>w</span>, <span>err</span>.<span>Error</span>(), <span>http</span>.<span>StatusInternalServerError</span>)</td></tr><tr><td id=\"file-post-go-L30\" data-line-number=\"30\"></td><td id=\"file-post-go-LC30\"><span>return</span></td></tr><tr><td id=\"file-post-go-L31\" data-line-number=\"31\"></td><td id=\"file-post-go-LC31\">}</td></tr><tr><td id=\"file-post-go-L32\" data-line-number=\"32\"></td><td id=\"file-post-go-LC32\">}</td></tr></tbody></table></div><p>เพียงเท่านี้ก็สามารถใช้งานแบบง่าย ๆ ได้แล้ว<br>ว่าง ๆ มาลองใช้กันดูครับ<br>เล็ก แรงดี<br>เป็นอีกหนึ่งทางเลือกของการพัฒนา</p></div><div><p><img alt=\"\" src=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=90&amp;d=mm&amp;r=g\" srcset=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=180&amp;d=mm&amp;r=g 2x\" height=\"90\" width=\"90\"></p><h4>Article by <a href=\"https://www.facebook.com/somkiatspns\">Somkiat Puisungnoen</a></h4><p>To be Craftmanship</p></div></div></article></div></div>","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"a796abac398b3468295a20e5c73f3ed0e12df562e108c00a668cf91249f80f3f","category":"Thai"}