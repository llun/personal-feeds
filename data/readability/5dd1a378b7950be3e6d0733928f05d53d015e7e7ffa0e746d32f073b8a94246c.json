{"title":"ว่าด้วยเรื่อง API Security ของ ClubHouse ที่โดนโจมตี","link":"https://www.somkiat.cc/api-security-of-clubhouse/","date":1614750091000,"content":"<div id=\"readability-page-1\" class=\"page\"><div id=\"page\"><article><div id=\"content_box\"><header><div><p><time>March 3, 2021</time> <span><a href=\"https://www.somkiat.cc/category/architecture-2/\" rel=\"category tag\">Architecture</a></span></p></div></header><div><p>วันนี้ดู <strong><a rel=\"noreferrer noopener\" href=\"https://twitter.com/_DanielSinclair/status/1363738761339826177\" target=\"_blank\">Tweet เรื่อง การวิเคราะห์ต้นเหตุปัญหาของ API ของ ClubHouse ที่โดนโจมตี</a></strong><br>ยกตัวอย่างเช่น<br>ผู้ใช้งานหนึ่งคนสามารถทำการเปิดและเข้าห้อง stream ได้มากกว่า 1 ห้อง<br>โดยใช้งานผ่าน web browser ได้เลย<br>ซึ่งแน่นอนว่า มันขัดแย้งกับ terms of service อย่างแรง</p><p><strong>โดยใน Tweet ข้างต้นจากคุณ Daniel Sinclair ได้สรุปไว้ดังนี้</strong></p><p>เริ่มจากระบบ <a rel=\"noreferrer noopener\" href=\"https://opench.aix.uy/\" target=\"_blank\">ClubHouse ที่ทำงานบน web browser</a></p><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/03/Screen-Shot-2564-03-03-at-12.22.46.png\" alt=\"\" width=\"568\" height=\"295\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/03/Screen-Shot-2564-03-03-at-12.22.46.png 628w, https://www.somkiat.cc/wp-content/uploads/2021/03/Screen-Shot-2564-03-03-at-12.22.46-300x156.png 300w\" sizes=\"(max-width: 568px) 100vw, 568px\"><figcaption>https://opench.aix.uy/</figcaption></figure><p><strong>ทำการอธิบายโครงสร้างการทำงานของ ClubHouse</strong></p><p>ทำการ stream การพูดคุยผ่านระบบของ Agora<br>ส่วนการ publish และ subscribe ต่าง ๆ ใช้งานผ่าน PubNub<br>แสดงดังรูป</p><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/03/clubhouse-architecture.png\" alt=\"\" width=\"533\" height=\"481\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/03/clubhouse-architecture.png 611w, https://www.somkiat.cc/wp-content/uploads/2021/03/clubhouse-architecture-300x271.png 300w\" sizes=\"(max-width: 533px) 100vw, 533px\"></figure><p><strong>จาก incident หรือ ปัญหา หรือ การโจมตี หรือ บุกรุก ดังกล่าวนั้น</strong></p><p>พบว่าปัญหามาจากเรื่องของระบบ API และ Token<br>แต่ตัวที่เป็นปัญหาหลักเลยคือ Token ที่ได้จากระบบของ Agora<br>ซึ่งให้สำหรับการ stream เสียงของการพูดคุยในแต่ละห้องนั้น<br>พบว่า 1 คนจะมี Token ของ Agora 1 token<br>ใช้ token นั้นไม่มีวันหมดอายุ<br>และ ไม่เปลี่ยน token เมื่อผู้ใช้ออกจากห้องด้วย</p><p>ทำให้ผู้โจมตีสามารถ ใช้งาน token นั้น ๆ<br>ไปสร้าง bot เพื่อเข้าร่วมห้องต่าง ๆ ได้หลาย ๆ ห้องพร้อมกัน</p><p>ทำให้เห็นว่า การออกแบบระบบต้องนี้<br>มันแยกการทำงานไปเลย ซึ่งกลายมาเป็นช่องโหว่ของระบบ</p><p><strong><em>ส่งผลให้เกิด drama ขึ้นมาจาก project ClubHouse บน web จากข้างต้นนั่นเอง</em></strong></p><p>โดย code ของ project ดังกว่าพัฒนาด้วยภาษา Python<br>จึงเขียน code ในการเข้าร่วมหลาย ๆ ห้องไว้ดังนี้</p><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/03/clubhouse-code-1024x459.jpeg\" alt=\"\" width=\"556\" height=\"248\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/03/clubhouse-code-1024x459.jpeg 1024w, https://www.somkiat.cc/wp-content/uploads/2021/03/clubhouse-code-300x135.jpeg 300w, https://www.somkiat.cc/wp-content/uploads/2021/03/clubhouse-code.jpeg 1342w\" sizes=\"(max-width: 556px) 100vw, 556px\"></figure><p><strong>ดังนั้น จากการวิเคราะห์นี้</strong></p><p>ทำให้เห็นว่า เราควรให้ความสำคัญต่อ Token lifecycle ของระบบงานอย่างมาก<br>รวมทั้งการเชื่อมต่อหรือ integrate เข้ากับระบบอื่น ๆ<br>ว่าทั้งผู้ใช้งาน และผู้ให้บริการ (service provider)<br>ควรจัดการให้ดีมากกว่านี้ เพื่อลดความผิดพลาดและปัญหาที่ตามมา</p><p>อีกทั้งยิ่งระบบงานเป็นที่นิยมมากเท่าไร<br>บรรดาผู้โจมตีก็ยิ่งสนใจมากเท่านั้น<br>ดังนั้นผู้ดูแลและพัฒนาระบบ ควรระวังเรื่องเหล่านี้ให้มากขึ้น</p></div><div><p><img alt=\"\" src=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=90&amp;d=mm&amp;r=g\" srcset=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=180&amp;d=mm&amp;r=g 2x\" height=\"90\" width=\"90\"></p><h4>Article by <a href=\"https://www.facebook.com/somkiatspns\">Somkiat Puisungnoen</a></h4><p>To be Craftmanship</p></div></div></article></div></div>","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"5dd1a378b7950be3e6d0733928f05d53d015e7e7ffa0e746d32f073b8a94246c","category":"Thai"}