{"title":"สวัสดี Donkey :: HTTP library สำหรับภาษา Clojure","link":"https://www.somkiat.cc/donkey-http-library-for-clojure/","date":1612516264000,"content":"<div id=\"readability-page-1\" class=\"page\"><div id=\"page\"><article><div id=\"content_box\"><header><div><p><time>February 5, 2021</time> <span><a href=\"https://www.somkiat.cc/category/programming/\" rel=\"category tag\">Programming</a></span></p></div></header><div><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/02/clojure-donkey.jpg\" alt=\"\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/02/clojure-donkey.jpg 900w, https://www.somkiat.cc/wp-content/uploads/2021/02/clojure-donkey-300x198.jpg 300w, https://www.somkiat.cc/wp-content/uploads/2021/02/clojure-donkey-768x506.jpg 768w\" sizes=\"(max-width: 900px) 100vw, 900px\"></figure><p>เพิ่งเห็น Library ชื่อว่า <strong><a rel=\"noreferrer noopener\" href=\"https://github.com/AppsFlyer/donkey\" target=\"_blank\">Donkey</a></strong><br>เป็น library สำหรับพัฒนา HTTP server และ client ในภาษา Clojure<br>โดยอ้างว่าสร้างมาเพื่อช่วยให้การพัฒนาง่ายขึ้น<br>รวมทั้ง performance ดีมากอีกด้วย<br>เป็น library ถูกสร้างจากทีมของ <a href=\"https://www.appsflyer.com/\" target=\"_blank\" rel=\"noreferrer noopener\">AppsFlyer</a><br>มีเป้าหมายเพื่อ</p><ul><li>รองรับการ scale ที่สูงขึ้นอย่างรวดเร็ว</li><li>ประหยัดค่าใช้จ่ายของการประมวลผล</li></ul><p><strong>สิ่งที่น่าสนใจของ Donkey</strong></p><ul><li>สร้างอยู่บน Vert.x สำหรับการพัฒนา reactive application บน JVM (Non-blocking IO by default)</li><li>มี API ง่าย ๆ ให้ใช้งาน</li><li>Open-source</li></ul><p><strong>ดังนั้นมาลองใช้งานกันหน่อย</strong></p><div id=\"gist107767025\"><article itemprop=\"text\"><h2>Demo</h2><h3>Create new project</h3><pre><code>$lein new app clojure-donkey\n</code></pre><h3>Add depednencies in file <code>project.clj</code></h3><pre><code>(defproject clojure-donkey \"0.1.0-SNAPSHOT\"\n  :description \"FIXME: write description\"\n  :url \"http://example.com/FIXME\"\n  :license {:name \"EPL-2.0 OR GPL-2.0-or-later WITH Classpath-exception-2.0\"\n            :url \"https://www.eclipse.org/legal/epl-2.0/\"}\n  :dependencies [\n    [org.clojure/clojure \"1.10.0\"]\n    [com.appsflyer/donkey \"0.4.2\"]]\n  :main ^:skip-aot clojure-donkey.core\n  :uberjar-name \"demo.jar\"\n  :profiles {:uberjar {:aot :all}})\n\n</code></pre><h3>Create first HTTP server</h3><pre><code>(ns clojure-donkey.core\n  (:require [com.appsflyer.donkey.core :refer [create-donkey create-server]]\n            [com.appsflyer.donkey.server :refer [start]]\n            [com.appsflyer.donkey.result :refer [on-success]])\n  (:gen-class)\n)\n\n(defn -main []\n  (-&gt;\n    (create-donkey)\n    (create-server {:port   8080\n                    :routes [{:handler (fn [_request respond _raise]\n                                        (respond {:body \"Hello, world!\"}))}]})\n    start\n    (on-success (fn [_] (println \"Server started listening on port 8080\"))))\n\n)\n</code></pre><h3>Build JAR file</h3><pre><code>$lein uberjar\n$export=JVM_OPTS=\"-Dvertx.threadChecks=false -Dvertx.disableContextTimings=true\"\n$java $JVM_OPTS -jar ./target/demo.jar \n\nSLF4J: Failed to load class \"org.slf4j.impl.StaticLoggerBinder\".\nSLF4J: Defaulting to no-operation (NOP) logger implementation\nSLF4J: See http://www.slf4j.org/codes.html#StaticLoggerBinder for further details.\nServer started listening on port 8080\n</code></pre><h3>Performance testing with wrk</h3><pre><code>$wrk -c100 -t5 -d10s http://localhost:8080\n\nRunning 10s test @ http://localhost:8080\n  5 threads and 100 connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency     1.02ms  501.07us  20.85ms   98.23%\n    Req/Sec    19.93k     2.42k   23.91k    63.96%\n  1001346 requests in 10.10s, 49.66MB read\nRequests/sec:  99120.87\nTransfer/sec:      4.92MB\n</code></pre></article></div><p>ผลที่ได้ออกมานั้น สูงใช้ได้เลยนะ<br>รวมทั้งการใช้งานก็ไม่ยาก<br>น่าสนใจมาก ๆ</p><p><strong>Reference Websites</strong></p><ul><li><a href=\"https://www.infoq.com/articles/clojure-donkey-http-stack/\" target=\"_blank\" rel=\"noreferrer noopener\">https://www.infoq.com/articles/clojure-donkey-http-stack/</a></li></ul></div><div><p><img alt=\"\" src=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=90&amp;d=mm&amp;r=g\" srcset=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=180&amp;d=mm&amp;r=g 2x\" height=\"90\" width=\"90\"></p><h4>Article by <a href=\"https://www.facebook.com/somkiatspns\">Somkiat Puisungnoen</a></h4><p>To be Craftmanship</p></div></div></article></div></div>","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"92614f7cc02205c71113bfcf243b2d74b5004ada67c88a627a3487b8d3e6c4d0","category":"Thai"}