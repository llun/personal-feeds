{"title":"[PostgreSQL] How to check null in jsonb array","link":"http://visibletrap.blogspot.com/2020/12/postgresql-how-to-check-null-in-jsonb.html","date":1608524520004,"content":"<div id=\"readability-page-1\" class=\"page\"><div id=\"post-body-4828041455345872567\" itemprop=\"description articleBody\"><p>&nbsp;Use&nbsp;<span>jsonb_array_elements</span> &nbsp;to convert jsonb array to set (queriable similar to normal table) then we can use&nbsp; <span>where x::text = 'null'</span> to match the null value.</p><div><p><span>=&gt; select x-&gt;'id' as id&nbsp;<br></span><span>from jsonb_array_elements(<br></span><span>'[{\"id\": 4, \"val\": [null,1,null]},&nbsp;<br></span><span>{\"id\": 2, \"val\": [3]}]'::jsonb<br></span><span>) as x,&nbsp;<br></span><span>jsonb_array_elements(x-&gt;'val') as y&nbsp;<br></span><span>where y::text = 'null';<br></span><span>&nbsp;id&nbsp;<br></span><span>----<br></span><span>&nbsp;4<br></span><span>&nbsp;4<br></span><span>(2 rows)</span><span><br></span><span><br></span><span><br></span><span>=&gt; select x-&gt;'id' as id<br></span><span>from jsonb_array_elements(<br></span><span>'[{\"id\": 4, \"val\": [null,1,null]},&nbsp;<br></span><span>{\"id\": 2, \"val\": [3]}]'::jsonb<br></span><span>) as x,&nbsp;<br></span><span>jsonb_array_elements(x-&gt;'val') as y&nbsp;<br></span><span>group by x-&gt;'id'&nbsp;<br></span><span>having count(x) filter (where y::text&nbsp; = 'null') &gt; 1;<br></span><span>&nbsp;id&nbsp;<br></span><span>----------<br></span><span>&nbsp;4<br></span><span>(1 row)</span></p></div></div></div>","author":"Tap","siteTitle":"tAp's blog","siteHash":"ec0b5758aa5280680c8b6839677ce27021dd9d4295725ce4f0e9f298aad77c91","entryHash":"ab0240bb7bd8b8364ababb35eb49c0d742f02d08310bfce5dc18f1a6e025854d","category":"Tech"}