{"title":"An Introduction to Terraform Cloud Agents","link":"https://www.hashicorp.com/blog/an-introduction-to-terraform-cloud-agents","date":1614897000000,"content":"<div id=\"readability-page-1\" class=\"page\"><div><section><p>Many organizations have a significant and often growing investment in their existing on-premises data centers. Even if those organizations have gone all-in on the public cloud, they frequently need to manage resources that are not necessarily accessible from the public internet. This presents a challenge for a managed service that operates on the public internet and needs to reach those private resources.</p><p><a href=\"https://www.terraform.io/cloud\">HashiCorp Terraform Cloud</a> provides customers with a new option to decide where they want to run their Terraform operations through the use of self-hosted agents. The new per-workspace agent execution mode allows private environments to continue taking advantage of Terraform Cloud’s management interface without modifying ingress network traffic access. The agents securely connect back to Terraform Cloud, retrieve any work needing to be completed, apply the changes, and return the results back to Terraform Cloud. These agents are available to Terraform Cloud customers enrolled in the <a href=\"https://www.hashicorp.com/blog/announcing-hashicorp-terraform-cloud-business\">Business tier</a>.</p><h2><a href=\"#terraform-cloud-agents-configuration\" aria-label=\"terraform cloud agents configuration permalink\">»</a><a id=\"terraform-cloud-agents-configuration\" aria-hidden=\"\"></a>Terraform Cloud Agents Configuration</h2><p>The transition to using Terraform Cloud Agents is nearly seamless. Whether agents will be used with one or several of your workspaces, there are a couple of configuration areas to know about. The first area has to do with agent pools. These pools are how you can separate the isolated, private, or on-premises environments where the agents will be deployed. Pools can be created in the Organization Settings’ Agents sub-section.</p></section><section><picture data-testid=\"image-root\"><source type=\"image/webp\" srcset=\"https://www.datocms-assets.com/2885/1614883081-agents-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=250 250w,https://www.datocms-assets.com/2885/1614883081-agents-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=500 500w,https://www.datocms-assets.com/2885/1614883081-agents-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=750 750w,https://www.datocms-assets.com/2885/1614883081-agents-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=1000 1000w,https://www.datocms-assets.com/2885/1614883081-agents-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=1500 1500w,https://www.datocms-assets.com/2885/1614883081-agents-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=2000 2000w,https://www.datocms-assets.com/2885/1614883081-agents-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=2500 2500w\" sizes=\"100vw\" data-testid=\"webp-source\"><img src=\"https://www.datocms-assets.com/2885/1614883081-agents-tf.png?fit=max&amp;fm=png&amp;q=80\" srcset=\"https://www.datocms-assets.com/2885/1614883081-agents-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=250 250w,https://www.datocms-assets.com/2885/1614883081-agents-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=500 500w,https://www.datocms-assets.com/2885/1614883081-agents-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=750 750w,https://www.datocms-assets.com/2885/1614883081-agents-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=1000 1000w,https://www.datocms-assets.com/2885/1614883081-agents-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=1500 1500w,https://www.datocms-assets.com/2885/1614883081-agents-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=2000 2000w,https://www.datocms-assets.com/2885/1614883081-agents-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=2500 2500w\" sizes=\"100vw\" alt=\"agents tab\" data-testid=\"img\"></picture></section><section><p>The next area will be token management for each pool. The token is used to authenticate agents to Terraform Cloud. Tokens can be created for each agent or for all the agents in the pool. Each agent only uses one token, but a pool can have as many as your configuration requires. These tokens can also be revoked and recreated at any point in the individual Agent Pool view.</p></section><section><picture data-testid=\"image-root\"><source type=\"image/webp\" srcset=\"https://www.datocms-assets.com/2885/1614883068-agent-pool-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=250 250w,https://www.datocms-assets.com/2885/1614883068-agent-pool-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=500 500w,https://www.datocms-assets.com/2885/1614883068-agent-pool-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=750 750w,https://www.datocms-assets.com/2885/1614883068-agent-pool-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=1000 1000w,https://www.datocms-assets.com/2885/1614883068-agent-pool-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=1500 1500w,https://www.datocms-assets.com/2885/1614883068-agent-pool-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=2000 2000w,https://www.datocms-assets.com/2885/1614883068-agent-pool-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=2500 2500w\" sizes=\"100vw\" data-testid=\"webp-source\"><img src=\"https://www.datocms-assets.com/2885/1614883068-agent-pool-tf.png?fit=max&amp;fm=png&amp;q=80\" srcset=\"https://www.datocms-assets.com/2885/1614883068-agent-pool-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=250 250w,https://www.datocms-assets.com/2885/1614883068-agent-pool-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=500 500w,https://www.datocms-assets.com/2885/1614883068-agent-pool-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=750 750w,https://www.datocms-assets.com/2885/1614883068-agent-pool-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=1000 1000w,https://www.datocms-assets.com/2885/1614883068-agent-pool-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=1500 1500w,https://www.datocms-assets.com/2885/1614883068-agent-pool-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=2000 2000w,https://www.datocms-assets.com/2885/1614883068-agent-pool-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=2500 2500w\" sizes=\"100vw\" alt=\"agent pool site tampa\" data-testid=\"img\"></picture></section><section><p>After generating a token, you’re given the token and some helpful sample code to deploy an agent into the desired environment using that token. The deployment can be performed in one of two ways, either as a <a href=\"https://hub.docker.com/r/hashicorp/tfc-agent\">container</a> image or a binary for use on 64-bit Linux operating systems. For resiliency, we recommend pairing your agent containers with an agent supervisor such as <a href=\"https://www.nomadproject.io/\">HashiCorp Nomad</a>, Kubernetes, or similar.</p><p>The following sample code will assign the environmental variables then deploy the container image:</p></section><div><pre><code><span>export</span> <span>TFC_AGENT_TOKEN</span><span>=</span><span>&lt;</span>agent_token<span>&gt;</span>\n\n<span>export</span> <span>TFC_AGENT_NAME</span><span>=</span><span>&lt;</span>agent_name<span>&gt;</span>\n\ndocker run -e TFC_AGENT_TOKEN -e TFC_AGENT_NAME hashicorp/tfc-agent:latest</code></pre></div><section><p>Alternatively you could also deploy several agents with the use of a workload orchestrator, like HashiCorp Nomad, with the following code sample:</p></section><div><pre><code>job <span>\"tfcagent\"</span> <span>{</span>\n    <span>datacenters</span> <span>=</span> <span>[</span><span>\"dc1\"</span><span>]</span>\n    group <span>\"tfcagent_tmmorg\"</span> <span>{</span>\n      <span>network</span> <span>{</span>\n          <span>mode</span> <span>=</span> <span>\"bridge\"</span>\n    <span>}</span>\n  \n      <span>count</span> <span>=</span> <span>2</span>\n      task <span>\"tfcagent_tpmmorg\"</span> <span>{</span>\n        <span>driver</span> <span>=</span> <span>\"docker\"</span>\n        \n        <span>env</span> <span>{</span>\n          <span>TFC_AGENT_TOKEN</span>             <span>=</span> <span>\"&lt;agent_token&gt;\"</span>\n          <span>TFC_AGENT_NAME</span>              <span>=</span> <span>\"&lt;agent_name&gt;\"</span>\n      <span>}</span>\n        \n        <span>config</span> <span>{</span>\n          <span>image</span> <span>=</span> <span>\"hashicorp/tfc-agent:latest\"</span>\n      <span>}</span>\n    <span>}</span>\n  <span>}</span>\n<span>}</span></code></pre></div><section><p>Once agents have been deployed, you can view information about them back on the Agents sub-section. Some of the information available will be the <a href=\"https://www.terraform.io/docs/cloud/agents/index.html#viewing-agent-statuses\">agent status</a>, which can be idle, busy, unknown, errored, or exited. You can also find the agent’s ID, IP Address, and the last time it checked in.</p></section><section><picture data-testid=\"image-root\"><source type=\"image/webp\" srcset=\"https://www.datocms-assets.com/2885/1614883076-agent-pools-list-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=250 250w,https://www.datocms-assets.com/2885/1614883076-agent-pools-list-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=500 500w,https://www.datocms-assets.com/2885/1614883076-agent-pools-list-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=750 750w,https://www.datocms-assets.com/2885/1614883076-agent-pools-list-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=1000 1000w,https://www.datocms-assets.com/2885/1614883076-agent-pools-list-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=1500 1500w,https://www.datocms-assets.com/2885/1614883076-agent-pools-list-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=2000 2000w,https://www.datocms-assets.com/2885/1614883076-agent-pools-list-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=2500 2500w\" sizes=\"100vw\" data-testid=\"webp-source\"><img src=\"https://www.datocms-assets.com/2885/1614883076-agent-pools-list-tf.png?fit=max&amp;fm=png&amp;q=80\" srcset=\"https://www.datocms-assets.com/2885/1614883076-agent-pools-list-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=250 250w,https://www.datocms-assets.com/2885/1614883076-agent-pools-list-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=500 500w,https://www.datocms-assets.com/2885/1614883076-agent-pools-list-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=750 750w,https://www.datocms-assets.com/2885/1614883076-agent-pools-list-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=1000 1000w,https://www.datocms-assets.com/2885/1614883076-agent-pools-list-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=1500 1500w,https://www.datocms-assets.com/2885/1614883076-agent-pools-list-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=2000 2000w,https://www.datocms-assets.com/2885/1614883076-agent-pools-list-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=2500 2500w\" sizes=\"100vw\" alt=\"Agents pool\" data-testid=\"img\"></picture></section><section><p>The last area will be configuring your workspace to use the configured agent pool. This setting is available in a workspace’s General Settings area, under Execution Mode. You will need to change the execution mode from the current mode to Agent. You will also need to select the desired agent pool that should be used to process this workspace’s Terraform operations.</p></section><section><picture data-testid=\"image-root\"><source type=\"image/webp\" srcset=\"https://www.datocms-assets.com/2885/1614883085-execution-mode-agents-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=250 250w,https://www.datocms-assets.com/2885/1614883085-execution-mode-agents-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=500 500w,https://www.datocms-assets.com/2885/1614883085-execution-mode-agents-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=750 750w,https://www.datocms-assets.com/2885/1614883085-execution-mode-agents-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=1000 1000w,https://www.datocms-assets.com/2885/1614883085-execution-mode-agents-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=1500 1500w,https://www.datocms-assets.com/2885/1614883085-execution-mode-agents-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=2000 2000w,https://www.datocms-assets.com/2885/1614883085-execution-mode-agents-tf.png?fit=max&amp;fm=webp&amp;q=80&amp;w=2500 2500w\" sizes=\"100vw\" data-testid=\"webp-source\"><img src=\"https://www.datocms-assets.com/2885/1614883085-execution-mode-agents-tf.png?fit=max&amp;fm=png&amp;q=80\" srcset=\"https://www.datocms-assets.com/2885/1614883085-execution-mode-agents-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=250 250w,https://www.datocms-assets.com/2885/1614883085-execution-mode-agents-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=500 500w,https://www.datocms-assets.com/2885/1614883085-execution-mode-agents-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=750 750w,https://www.datocms-assets.com/2885/1614883085-execution-mode-agents-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=1000 1000w,https://www.datocms-assets.com/2885/1614883085-execution-mode-agents-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=1500 1500w,https://www.datocms-assets.com/2885/1614883085-execution-mode-agents-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=2000 2000w,https://www.datocms-assets.com/2885/1614883085-execution-mode-agents-tf.png?fit=max&amp;fm=png&amp;q=80&amp;w=2500 2500w\" sizes=\"100vw\" alt=\"execution mode\" data-testid=\"img\"></picture></section><section><p>After those configuration steps are complete, you are now ready to use Terraform Cloud consistently in your private environments just as you would anywhere else. Additionally, those workspaces making use of agents will provide further information for each of the Terraform runs. Every Terraform plan and apply operation will include an extra line in the console to specify the agent pool and the particular agent which performed each operation.</p></section><section><picture data-testid=\"image-root\"><source type=\"image/webp\" srcset=\"https://www.datocms-assets.com/2885/1614883737-update-maintf-agents.png?fit=max&amp;fm=webp&amp;q=80&amp;w=250 250w,https://www.datocms-assets.com/2885/1614883737-update-maintf-agents.png?fit=max&amp;fm=webp&amp;q=80&amp;w=500 500w,https://www.datocms-assets.com/2885/1614883737-update-maintf-agents.png?fit=max&amp;fm=webp&amp;q=80&amp;w=750 750w,https://www.datocms-assets.com/2885/1614883737-update-maintf-agents.png?fit=max&amp;fm=webp&amp;q=80&amp;w=1000 1000w,https://www.datocms-assets.com/2885/1614883737-update-maintf-agents.png?fit=max&amp;fm=webp&amp;q=80&amp;w=1500 1500w,https://www.datocms-assets.com/2885/1614883737-update-maintf-agents.png?fit=max&amp;fm=webp&amp;q=80&amp;w=2000 2000w,https://www.datocms-assets.com/2885/1614883737-update-maintf-agents.png?fit=max&amp;fm=webp&amp;q=80&amp;w=2500 2500w\" sizes=\"100vw\" data-testid=\"webp-source\"><img src=\"https://www.datocms-assets.com/2885/1614883737-update-maintf-agents.png?fit=max&amp;fm=png&amp;q=80\" srcset=\"https://www.datocms-assets.com/2885/1614883737-update-maintf-agents.png?fit=max&amp;fm=png&amp;q=80&amp;w=250 250w,https://www.datocms-assets.com/2885/1614883737-update-maintf-agents.png?fit=max&amp;fm=png&amp;q=80&amp;w=500 500w,https://www.datocms-assets.com/2885/1614883737-update-maintf-agents.png?fit=max&amp;fm=png&amp;q=80&amp;w=750 750w,https://www.datocms-assets.com/2885/1614883737-update-maintf-agents.png?fit=max&amp;fm=png&amp;q=80&amp;w=1000 1000w,https://www.datocms-assets.com/2885/1614883737-update-maintf-agents.png?fit=max&amp;fm=png&amp;q=80&amp;w=1500 1500w,https://www.datocms-assets.com/2885/1614883737-update-maintf-agents.png?fit=max&amp;fm=png&amp;q=80&amp;w=2000 2000w,https://www.datocms-assets.com/2885/1614883737-update-maintf-agents.png?fit=max&amp;fm=png&amp;q=80&amp;w=2500 2500w\" sizes=\"100vw\" alt=\"update main.tf\" data-testid=\"img\"></picture></section><section><h2><a href=\"#summary\" aria-label=\"summary permalink\">»</a><a id=\"summary\" aria-hidden=\"\"></a>Summary</h2><p>Terraform Cloud’s <a href=\"https://www.hashicorp.com/blog/announcing-hashicorp-terraform-cloud-business\">Business tier</a> includes a number of enterprise-grade features. One of the notable features is the ability to manage more of your resources, including those in isolated, private, or on-premises environments, in the same way as the rest of your environment. The self-hosted Terraform Cloud Agents provide all the Terraform Cloud features without the requirement of modifying any ingress networking policies.</p><p>Terraform Cloud is free to get started, and organizations can upgrade to the Team and Governance or the Business tier at any time. To get started, <a href=\"https://app.terraform.io/session\">sign-up for Terraform Cloud</a> and follow our <a href=\"https://learn.hashicorp.com/collections/terraform/cloud-get-started\">Get Started tutorial</a> or <a href=\"https://www.hashicorp.com/contact-sales/?utm_source=TFC4B\">contact HashiCorp Sales</a>.</p><p>To discover more about using Terraform Cloud Agents, review the <a href=\"https://learn.hashicorp.com/tutorials/terraform/cloud-agents\">guides</a> on HashiCorp Learn.</p></section></div></div>","author":"Kyle Ruddy","siteTitle":"HashiCorp Blog","siteHash":"219aa6310b3388f2335eba49871f4df9581f2c58eaeb5e498363b54e835b7001","entryHash":"02d26b1028d20275c52d492cc92c7cd23c1750dffe01cec13fadd36f64981f47","category":"Tech"}