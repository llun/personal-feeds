{"title":"[Docker] บันทึกการใช้งาน extra hosts และ fix ip ของ container","link":"https://www.somkiat.cc/docker-with-extra-hosts-and-fix-ip/","date":1621265952000,"content":"<div id=\"readability-page-1\" class=\"page\"><div id=\"page\"><article><div id=\"content_box\"><header></header><div><p><strong>ปัญหา</strong></p><p>มี requirement น่าสนใจ เกี่ยวกับการใช้งาน Docker<br>เพื่อใช้ในการพัฒนาระบบงาน<br>โดยต้องการให้แต่ละ container มี IP ตามที่ต้องการ (Fix IP)<br>จากนั้นแต่ละ container จะติดต่อกันผ่าน domain ที่เรากำหนด<br>การทำงานแสดงดังรูป</p><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/05/Screen-Shot-2564-05-17-at-22.26.07-1024x546.png\" alt=\"\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/05/Screen-Shot-2564-05-17-at-22.26.07-1024x546.png 1024w, https://www.somkiat.cc/wp-content/uploads/2021/05/Screen-Shot-2564-05-17-at-22.26.07-300x160.png 300w, https://www.somkiat.cc/wp-content/uploads/2021/05/Screen-Shot-2564-05-17-at-22.26.07-768x409.png 768w, https://www.somkiat.cc/wp-content/uploads/2021/05/Screen-Shot-2564-05-17-at-22.26.07-1536x818.png 1536w, https://www.somkiat.cc/wp-content/uploads/2021/05/Screen-Shot-2564-05-17-at-22.26.07.png 1618w\" sizes=\"(max-width: 1024px) 100vw, 1024px\"></figure><p><strong>วิธีการแก้ไขปัญหาตามที่ต้องการด้วย Docker + Docker compose</strong></p><p>โดยใน docker และ docker compose นั้น<br>จะมีความสามารถในการกำหนด</p><ul><li>Networks ทั้ง subnet mask และ ช่วงของ IP ที่ต้องการ</li><li>แต่ละ container ต้องกำหนด IP ที่ต้องการได้</li><li>พร้องกับเพิ่ม extra_hosts ของแต่ละ container มันคือการเพิ่ม mapping ในไฟล์ /etc/hosts ให้นั่นเอง</li></ul><p><strong>ตัวอย่างของ Docker compose file ที่ใช้งานแบบง่าย ๆ เป็นดังนี้</strong></p><p>โดยใช้งานร่วมกับ NGINX ไปด้วย</p><div itemprop=\"text\" id=\"gist109550987\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-docker-compose-yml-L1\" data-line-number=\"1\"></td><td id=\"file-docker-compose-yml-LC1\"><span>version</span>: <span><span>\"</span>3.9<span>\"</span></span></td></tr><tr><td id=\"file-docker-compose-yml-L2\" data-line-number=\"2\"></td><td id=\"file-docker-compose-yml-LC2\"><span>services</span>:</td></tr><tr><td id=\"file-docker-compose-yml-L3\" data-line-number=\"3\"></td><td id=\"file-docker-compose-yml-LC3\"><span>app1</span>:</td></tr><tr><td id=\"file-docker-compose-yml-L4\" data-line-number=\"4\"></td><td id=\"file-docker-compose-yml-LC4\"><span>image</span>: <span>nginx:alpine</span></td></tr><tr><td id=\"file-docker-compose-yml-L5\" data-line-number=\"5\"></td><td id=\"file-docker-compose-yml-LC5\"><span>container_name</span>: <span>app1</span></td></tr><tr><td id=\"file-docker-compose-yml-L6\" data-line-number=\"6\"></td><td id=\"file-docker-compose-yml-LC6\"><span>networks</span>:</td></tr><tr><td id=\"file-docker-compose-yml-L7\" data-line-number=\"7\"></td><td id=\"file-docker-compose-yml-LC7\"><span>app_network</span>:</td></tr><tr><td id=\"file-docker-compose-yml-L8\" data-line-number=\"8\"></td><td id=\"file-docker-compose-yml-LC8\"><span>ipv4_address</span>: <span>172.16.238.10</span></td></tr><tr><td id=\"file-docker-compose-yml-L9\" data-line-number=\"9\"></td><td id=\"file-docker-compose-yml-LC9\"><span>extra_hosts</span>:</td></tr><tr><td id=\"file-docker-compose-yml-L10\" data-line-number=\"10\"></td><td id=\"file-docker-compose-yml-LC10\">- <span><span>\"</span>app1.service.dev:172.16.238.10<span>\"</span></span></td></tr><tr><td id=\"file-docker-compose-yml-L11\" data-line-number=\"11\"></td><td id=\"file-docker-compose-yml-LC11\">- <span><span>\"</span>app2.service.dev:172.16.238.11<span>\"</span></span></td></tr><tr><td id=\"file-docker-compose-yml-L12\" data-line-number=\"12\"></td><td id=\"file-docker-compose-yml-LC12\"><span>volumes</span>:</td></tr><tr><td id=\"file-docker-compose-yml-L13\" data-line-number=\"13\"></td><td id=\"file-docker-compose-yml-LC13\">- <span>./app1:/etc/nginx</span></td></tr><tr><td id=\"file-docker-compose-yml-L14\" data-line-number=\"14\"></td><td id=\"file-docker-compose-yml-LC14\">- <span>./app1/index.html:/usr/share/nginx/html/index.html</span></td></tr><tr><td id=\"file-docker-compose-yml-L15\" data-line-number=\"15\"></td><td id=\"file-docker-compose-yml-LC15\"></td></tr><tr><td id=\"file-docker-compose-yml-L16\" data-line-number=\"16\"></td><td id=\"file-docker-compose-yml-LC16\"><span>app2</span>:</td></tr><tr><td id=\"file-docker-compose-yml-L17\" data-line-number=\"17\"></td><td id=\"file-docker-compose-yml-LC17\"><span>image</span>: <span>nginx:alpine</span></td></tr><tr><td id=\"file-docker-compose-yml-L18\" data-line-number=\"18\"></td><td id=\"file-docker-compose-yml-LC18\"><span>container_name</span>: <span>app2</span></td></tr><tr><td id=\"file-docker-compose-yml-L19\" data-line-number=\"19\"></td><td id=\"file-docker-compose-yml-LC19\"><span>networks</span>:</td></tr><tr><td id=\"file-docker-compose-yml-L20\" data-line-number=\"20\"></td><td id=\"file-docker-compose-yml-LC20\"><span>app_network</span>:</td></tr><tr><td id=\"file-docker-compose-yml-L21\" data-line-number=\"21\"></td><td id=\"file-docker-compose-yml-LC21\"><span>ipv4_address</span>: <span>172.16.238.11</span></td></tr><tr><td id=\"file-docker-compose-yml-L22\" data-line-number=\"22\"></td><td id=\"file-docker-compose-yml-LC22\"><span>extra_hosts</span>:</td></tr><tr><td id=\"file-docker-compose-yml-L23\" data-line-number=\"23\"></td><td id=\"file-docker-compose-yml-LC23\">- <span><span>\"</span>app1.service.dev:172.16.238.10<span>\"</span></span></td></tr><tr><td id=\"file-docker-compose-yml-L24\" data-line-number=\"24\"></td><td id=\"file-docker-compose-yml-LC24\">- <span><span>\"</span>app2.service.dev:172.16.238.11<span>\"</span></span></td></tr><tr><td id=\"file-docker-compose-yml-L25\" data-line-number=\"25\"></td><td id=\"file-docker-compose-yml-LC25\"><span>volumes</span>:</td></tr><tr><td id=\"file-docker-compose-yml-L26\" data-line-number=\"26\"></td><td id=\"file-docker-compose-yml-LC26\">- <span>./app2:/etc/nginx</span></td></tr><tr><td id=\"file-docker-compose-yml-L27\" data-line-number=\"27\"></td><td id=\"file-docker-compose-yml-LC27\">- <span>./app2/index.html:/usr/share/nginx/html/index.html</span></td></tr><tr><td id=\"file-docker-compose-yml-L28\" data-line-number=\"28\"></td><td id=\"file-docker-compose-yml-LC28\"></td></tr><tr><td id=\"file-docker-compose-yml-L29\" data-line-number=\"29\"></td><td id=\"file-docker-compose-yml-LC29\"><span>networks</span>:</td></tr><tr><td id=\"file-docker-compose-yml-L30\" data-line-number=\"30\"></td><td id=\"file-docker-compose-yml-LC30\"><span>app_network</span>:</td></tr><tr><td id=\"file-docker-compose-yml-L31\" data-line-number=\"31\"></td><td id=\"file-docker-compose-yml-LC31\"><span>ipam</span>:</td></tr><tr><td id=\"file-docker-compose-yml-L32\" data-line-number=\"32\"></td><td id=\"file-docker-compose-yml-LC32\"><span>driver</span>: <span>default</span></td></tr><tr><td id=\"file-docker-compose-yml-L33\" data-line-number=\"33\"></td><td id=\"file-docker-compose-yml-LC33\"><span>config</span>:</td></tr><tr><td id=\"file-docker-compose-yml-L34\" data-line-number=\"34\"></td><td id=\"file-docker-compose-yml-LC34\">- <span>subnet</span>: <span><span>\"</span>172.16.238.0/24<span>\"</span></span></td></tr></tbody></table></div><p>เพียงเท่านี้ก็สามารถทำงานตามที่ต้องการได้แล้ว</p></div><div><p><img alt=\"\" src=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=90&amp;d=mm&amp;r=g\" srcset=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=180&amp;d=mm&amp;r=g 2x\" height=\"90\" width=\"90\"></p><h4>Article by <a href=\"https://www.facebook.com/somkiatspns\">Somkiat Puisungnoen</a></h4><p>To be Craftmanship</p></div></div></article></div></div>","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"fcd1082ea9555f1239920119e196e77ad932eafc03079f1ae9ce6a571d2b3fc1","category":"Thai"}