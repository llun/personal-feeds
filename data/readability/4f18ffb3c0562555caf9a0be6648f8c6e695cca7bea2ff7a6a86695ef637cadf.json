{"title":"Hardening HashiCorp Vault with SELinux","link":"https://www.hashicorp.com/blog/hardening-hashicorp-vault-with-selinux","date":1612976400000,"content":"<div id=\"readability-page-1\" class=\"page\"><div><section><p>Hardening the production environment that runs your HashiCorp Vault clusters is one of the most important tasks you can do to secure the secret data managed by Vault. Our Learn guide on <a href=\"https://learn.hashicorp.com/tutorials/vault/production-hardening\">Production Hardening</a> provides a number of invaluable recommendations, each of which add layers of defense in depth to help reduce the likelihood or impact of compromise.</p><p>Some of the Operating System specific recommendations include things like not running Vault as the <code>root</code> user and disabling core dumps. Another recommendation is to configure <a href=\"https://www.redhat.com/en/topics/linux/what-is-selinux\">SELinux</a> or <a href=\"https://apparmor.net/\">AppArmor</a>. SELinux and AppArmor are two methods to provide <a href=\"http://web.mit.edu/rhel-doc/5/RHEL-5-manual/Deployment_Guide-en-US/selg-overview.html\">Mandatory Access Controls</a> to processes running on Linux distributions. SELinux was originally developed by the United States National Security Agency (NSA), and since then has been included in Red Hat-based Linux Distributions, such as CentOS or Fedora. AppArmor, while very similar to SELinux, is supported by Canonical, and is therefore available on Ubuntu and related Linux Distributions.</p><p>To help operations staff implement this recommendation we’re happy to announce a baseline SELinux policy for securing Vault on Red Hat-based Linux Distributions. This will be initially available as an open source <a href=\"https://github.com/hashicorp/vault-selinux-policies\">GitHub repo</a>, and may eventually make its way to our <a href=\"https://www.hashicorp.com/blog/announcing-the-hashicorp-linux-repository\">Linux Repository</a> too.</p><p><strong>It is important that you test the SELinux policy out in your non-production environments before running it in production. While we have done baseline testing with CentOS and Fedora, your Vault environment is likely unique and will require modification to the policy.</strong></p><p>One of the benefits of SELinux is that it is customizable to your particular security requirements, but with that flexibility comes complexity. To provide an initial, out-of-box experience, the current Targeted Policy is configured to label Vault files and folders as per those deployed if you install Vault using one of our <a href=\"https://learn.hashicorp.com/tutorials/vault/getting-started-install\">Linux Packages</a>.</p><h2><a href=\"#getting-started\" aria-label=\"getting started permalink\">»</a><a id=\"getting-started\" aria-hidden=\"\"></a>Getting Started</h2><p>The easiest way to get started is to download and install one of the RPMs from our <a href=\"https://github.com/hashicorp/vault-selinux-policies/releases\">releases page</a>. The <code>el</code> RPM files have been packaged and tested on CentOS 7 and 8, while the <code>fc</code> packages have been packaged and tested on Fedora 31, 32, and 33.</p></section><section><picture data-testid=\"image-root\"><source type=\"image/webp\" srcset=\"https://www.datocms-assets.com/2885/1612333129-screen-shot-2020-11-17-at-2-44-08-pm.png?fit=max&amp;fm=webp&amp;q=80&amp;w=250 250w,https://www.datocms-assets.com/2885/1612333129-screen-shot-2020-11-17-at-2-44-08-pm.png?fit=max&amp;fm=webp&amp;q=80&amp;w=500 500w,https://www.datocms-assets.com/2885/1612333129-screen-shot-2020-11-17-at-2-44-08-pm.png?fit=max&amp;fm=webp&amp;q=80&amp;w=750 750w,https://www.datocms-assets.com/2885/1612333129-screen-shot-2020-11-17-at-2-44-08-pm.png?fit=max&amp;fm=webp&amp;q=80&amp;w=1000 1000w,https://www.datocms-assets.com/2885/1612333129-screen-shot-2020-11-17-at-2-44-08-pm.png?fit=max&amp;fm=webp&amp;q=80&amp;w=1500 1500w,https://www.datocms-assets.com/2885/1612333129-screen-shot-2020-11-17-at-2-44-08-pm.png?fit=max&amp;fm=webp&amp;q=80&amp;w=2000 2000w,https://www.datocms-assets.com/2885/1612333129-screen-shot-2020-11-17-at-2-44-08-pm.png?fit=max&amp;fm=webp&amp;q=80&amp;w=2500 2500w\" sizes=\"100vw\" data-testid=\"webp-source\"><img src=\"https://www.datocms-assets.com/2885/1612333129-screen-shot-2020-11-17-at-2-44-08-pm.png?fit=max&amp;fm=png&amp;q=80\" srcset=\"https://www.datocms-assets.com/2885/1612333129-screen-shot-2020-11-17-at-2-44-08-pm.png?fit=max&amp;fm=png&amp;q=80&amp;w=250 250w,https://www.datocms-assets.com/2885/1612333129-screen-shot-2020-11-17-at-2-44-08-pm.png?fit=max&amp;fm=png&amp;q=80&amp;w=500 500w,https://www.datocms-assets.com/2885/1612333129-screen-shot-2020-11-17-at-2-44-08-pm.png?fit=max&amp;fm=png&amp;q=80&amp;w=750 750w,https://www.datocms-assets.com/2885/1612333129-screen-shot-2020-11-17-at-2-44-08-pm.png?fit=max&amp;fm=png&amp;q=80&amp;w=1000 1000w,https://www.datocms-assets.com/2885/1612333129-screen-shot-2020-11-17-at-2-44-08-pm.png?fit=max&amp;fm=png&amp;q=80&amp;w=1500 1500w,https://www.datocms-assets.com/2885/1612333129-screen-shot-2020-11-17-at-2-44-08-pm.png?fit=max&amp;fm=png&amp;q=80&amp;w=2000 2000w,https://www.datocms-assets.com/2885/1612333129-screen-shot-2020-11-17-at-2-44-08-pm.png?fit=max&amp;fm=png&amp;q=80&amp;w=2500 2500w\" sizes=\"100vw\" alt=\"HashiCorp Vault SELinux Policy\" data-testid=\"img\"></picture></section><section><h2><a href=\"#customized-policy\" aria-label=\"customized policy permalink\">»</a><a id=\"customized-policy\" aria-hidden=\"\"></a>Customized Policy</h2><p>If you have a customized deployment of Vault then the packaged RPMs will not work. The best way to proceed is to clone the <a href=\"https://github.com/hashicorp/vault-selinux-policies\">repo</a>, then follow the steps under <a href=\"https://github.com/hashicorp/vault-selinux-policies#testing-locally\">Testing Locally</a> to install the policy.</p><p>After initial installation, the SELinux policy files that reside in <code>products/vault_selinux</code> may be edited and re-deployed by re-running the <code>vault.sh</code> script from within that same directory.</p><h2><a href=\"#next-steps\" aria-label=\"next steps permalink\">»</a><a id=\"next-steps\" aria-hidden=\"\"></a>Next Steps</h2><p>Long-term we plan to make these RPMs available for installation from our official Linux repository. This will help streamline the process for operators that want to easily install Vault and the <a href=\"https://github.com/hashicorp/vault-selinux-policies\">Vault SELinux Policy</a>. We’re also going to investigate providing a similar policy for AppArmor for those practitioners running Vault on Ubuntu, Debian, and similar Linux Distributions. As always, we’re interested in <a href=\"https://discuss.hashicorp.com/c/vault/30\">community feedback</a>.</p></section></div></div>","author":"Christian Frichot","siteTitle":"HashiCorp Blog","siteHash":"219aa6310b3388f2335eba49871f4df9581f2c58eaeb5e498363b54e835b7001","entryHash":"4f18ffb3c0562555caf9a0be6648f8c6e695cca7bea2ff7a6a86695ef637cadf","category":"Tech"}