{"title":"Deno 1.9 เพิ่ม native HTTP 2 server เข้ามาแล้ว","link":"https://www.somkiat.cc/deno-new-http2-server-api/","date":1618641277000,"content":"<div id=\"readability-page-1\" class=\"page\"><div id=\"page\"><article><div id=\"content_box\"><header><div><p><time>April 17, 2021</time> <span><a href=\"https://www.somkiat.cc/category/programming/\" rel=\"category tag\">Programming</a></span></p></div></header><div><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/04/feature-03.jpeg\" alt=\"\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/04/feature-03.jpeg 800w, https://www.somkiat.cc/wp-content/uploads/2021/04/feature-03-300x163.jpeg 300w, https://www.somkiat.cc/wp-content/uploads/2021/04/feature-03-768x418.jpeg 768w\" sizes=\"(max-width: 800px) 100vw, 800px\"></figure><p>ก่อนหน้านี้ Deno นั้นจะสนับสนุนเพียง HTTP 1 เท่านั้น<br>ซึ่งพัฒนาอยู่ใน package std/http นั่นเอง<br>ใน <strong><a href=\"https://deno.com/blog/v1.9\">Deno 1.9</a></strong> นั้นทำการเพิ่ม HTTP 2 เข้ามา<br>แต่การไปแก้ไขหรือเพิ่มใน package std/http ไม่ใช่เรื่องง่ายเลย<br>จึงทำการพัฒนาใหม่เป็น native มาใน Deno เลย<br>โดยใช้งาน <a rel=\"noreferrer noopener\" href=\"https://hyper.rs/\" target=\"_blank\">Hyper เป็น fast HTTP </a>implementation พัฒนาด้วยภาษา Rust นั่นเอง<br>ผลที่ได้คือ ทำงานเร็วขึ้น 48%</p><p><strong>ตัวอย่าง code</strong></p><p><strong>จากนั้นทำการ run และดูผล</strong><br>ซึ่งยังต้องใส่ flag –unstable ด้วย ดังนี้</p><div itemprop=\"text\" id=\"gist109048526\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-1-txt-L1\" data-line-number=\"1\"></td><td id=\"file-1-txt-LC1\">$deno --version</td></tr><tr><td id=\"file-1-txt-L2\" data-line-number=\"2\"></td><td id=\"file-1-txt-LC2\">deno 1.9.0 (release, x86_64-apple-darwin)</td></tr><tr><td id=\"file-1-txt-L3\" data-line-number=\"3\"></td><td id=\"file-1-txt-LC3\">v8 9.1.269.5</td></tr><tr><td id=\"file-1-txt-L4\" data-line-number=\"4\"></td><td id=\"file-1-txt-LC4\">typescript 4.2.2</td></tr><tr><td id=\"file-1-txt-L5\" data-line-number=\"5\"></td><td id=\"file-1-txt-LC5\"></td></tr><tr><td id=\"file-1-txt-L6\" data-line-number=\"6\"></td><td id=\"file-1-txt-LC6\">$deno run --unstable --allow-net http2.ts</td></tr><tr><td id=\"file-1-txt-L7\" data-line-number=\"7\"></td><td id=\"file-1-txt-LC7\"></td></tr><tr><td id=\"file-1-txt-L8\" data-line-number=\"8\"></td><td id=\"file-1-txt-LC8\"></td></tr><tr><td id=\"file-1-txt-L9\" data-line-number=\"9\"></td><td id=\"file-1-txt-LC9\">$wrk -c 100 -t 5 -d 10s http://localhost</td></tr><tr><td id=\"file-1-txt-L10\" data-line-number=\"10\"></td><td id=\"file-1-txt-LC10\">Running 10s test @ http://localhost</td></tr><tr><td id=\"file-1-txt-L11\" data-line-number=\"11\"></td><td id=\"file-1-txt-LC11\">5 threads and 100 connections</td></tr><tr><td id=\"file-1-txt-L12\" data-line-number=\"12\"></td><td id=\"file-1-txt-LC12\">Thread Stats Avg Stdev Max +/- Stdev</td></tr><tr><td id=\"file-1-txt-L13\" data-line-number=\"13\"></td><td id=\"file-1-txt-LC13\">Latency 1.78ms 1.69ms 61.59ms 98.89%</td></tr><tr><td id=\"file-1-txt-L14\" data-line-number=\"14\"></td><td id=\"file-1-txt-LC14\">Req/Sec 11.91k 1.22k 13.38k 90.10%</td></tr><tr><td id=\"file-1-txt-L15\" data-line-number=\"15\"></td><td id=\"file-1-txt-LC15\">598376 requests in 10.10s, 49.65MB read</td></tr><tr><td id=\"file-1-txt-L16\" data-line-number=\"16\"></td><td id=\"file-1-txt-LC16\">Requests/sec: 59236.41</td></tr><tr><td id=\"file-1-txt-L17\" data-line-number=\"17\"></td><td id=\"file-1-txt-LC17\">Transfer/sec: 4.91MB</td></tr></tbody></table></div><p><strong>จาก blog ของ Deno ก็ได้วัด performance มาให้ดู</strong></p><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/04/hist.png\" alt=\"\" width=\"549\" height=\"365\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/04/hist.png 864w, https://www.somkiat.cc/wp-content/uploads/2021/04/hist-300x200.png 300w, https://www.somkiat.cc/wp-content/uploads/2021/04/hist-768x512.png 768w\" sizes=\"(max-width: 549px) 100vw, 549px\"></figure><p>ลองทำการ Download มาใช้งานกันดูครับ</p></div><div><p><img alt=\"\" src=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=90&amp;d=mm&amp;r=g\" srcset=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=180&amp;d=mm&amp;r=g 2x\" height=\"90\" width=\"90\"></p><h4>Article by <a href=\"https://www.facebook.com/somkiatspns\">Somkiat Puisungnoen</a></h4><p>To be Craftmanship</p></div></div></article></div></div>","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"7c1cc99b65cf315b78a2f03df1e855d09becb95218ec1af301f58e2b39789d9f","category":"Thai"}