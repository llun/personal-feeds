{"title":"มาใช้งาน Telepresence 2 กัน","link":"https://www.somkiat.cc/use-telepresence-2/","date":1615896235000,"content":"<div id=\"readability-page-1\" class=\"page\"><div id=\"page\"><article><div id=\"content_box\"><header></header><div><p>Telepresence คือเครื่องมือที่ช่วยให้ developer สามารถพัฒนาระบบงาน<br>ที่ deploy บน Kubernetes ได้ง่ายและสะดวกขึ้น<br>ตามแนวคิดคือ <strong>Fast Local development in Kubernetes</strong></p><p>นั่นคือ developer พัฒนาได้รวดเร็วยิ่งขึ้น<br>โดยไม่ต้องรอการ build, push image และสร้าง container เลย<br>ใช้งานร่วมกับ IDE ต่าง ๆ ได้ดี</p><p><strong>ก่อนอื่น Telepresence 2.0 นั้น ทำการเขียนใหม่ด้วยภาษา Go</strong><br>นำความรู้ที่ได้จาก version 1 มาปรับปรุงให้ดีขึ้น<br>ทั้งการใช้งานที่ง่าย และประสิทธิภาพที่ดีขึ้น</p><p><strong>โครงสร้างของ Telepresence 2 เป็นดังภาพ</strong></p><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/03/telepresence-1024x863.png\" alt=\"\" width=\"544\" height=\"458\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/03/telepresence-1024x863.png 1024w, https://www.somkiat.cc/wp-content/uploads/2021/03/telepresence-300x253.png 300w, https://www.somkiat.cc/wp-content/uploads/2021/03/telepresence-768x647.png 768w, https://www.somkiat.cc/wp-content/uploads/2021/03/telepresence.png 1400w\" sizes=\"(max-width: 544px) 100vw, 544px\"></figure><p><strong>เพื่อความเข้าใจที่ดีขึ้น มาลองใช้กันดีกว่า</strong></p><p><strong>ขั้นตอนที่ 1</strong></p><p>ทำการสร้างและ connect ไปยัง Kubernetes Cluster จริง ๆ<br>จากเครื่อง Local ของ developer ให้ได้<br>และทำการ deploy ระบบงานไปยัง Kubernetes Cluster แบบปกติก่อน</p><p><strong>ขั้นตอนที่ 2</strong></p><p>ทำการติดตั้ง <a rel=\"noreferrer noopener\" href=\"https://www.getambassador.io/docs/latest/telepresence/install/\" target=\"_blank\">TelePresence</a> บนเครื่อง<br>จากนั้นทำการ connect จาก TelePresence ไปยัง Kubernetes Cluster</p><div itemprop=\"text\" id=\"gist108480732\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-1-txt-L1\" data-line-number=\"1\"></td><td id=\"file-1-txt-LC1\">$telepresence connect</td></tr><tr><td id=\"file-1-txt-L2\" data-line-number=\"2\"></td><td id=\"file-1-txt-LC2\"></td></tr><tr><td id=\"file-1-txt-L3\" data-line-number=\"3\"></td><td id=\"file-1-txt-LC3\">Launching Telepresence Daemon</td></tr><tr><td id=\"file-1-txt-L4\" data-line-number=\"4\"></td><td id=\"file-1-txt-LC4\">...</td></tr><tr><td id=\"file-1-txt-L5\" data-line-number=\"5\"></td><td id=\"file-1-txt-LC5\">Connected to context default (https://&lt;cluster-public-IP&gt;)</td></tr></tbody></table></div><p><strong>ขั้นตอนที่ 3</strong></p><p>จาก service ที่ทำงาน deploy Kubernetes Cluster แล้วนั้น<br>สามารถเข้าถึงได้โดยตรงด้วยชื่อและ port ของ service ต่าง ๆ จาก Local ของเราแล้ว</p><p><strong>ขั้นตอนที่ 4</strong></p><p>ทำการ intercept request ต่าง ๆ ที่จะส่งเข้ามายัง service ใน Kubernetes Cluster<br>โดยจะส่ง request นั้นมายัง Local ของเรานั่นเอง<br>ดังนั้นถ้าเราแก้ไข code ที่ Local ก็จะเห็นการเปลี่ยนแปลงนั้น ๆ เลย<br>ช่วยให้เราทดสอบได้ง่ายขึ้น<br>ก่อนจะไปเข้าสู่ขั้นตอน build, push และ deploy ต่อไป ถ้าทุกอย่างเรียบร้อย<br>ด้วยการใช้คำสั่งดังนี้</p><div itemprop=\"text\" id=\"gist108480732\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-2-txt-L1\" data-line-number=\"1\"></td><td id=\"file-2-txt-LC1\">$telepresence intercept &lt;service name&gt; --port &lt;port&gt;</td></tr><tr><td id=\"file-2-txt-L2\" data-line-number=\"2\"></td><td id=\"file-2-txt-LC2\"></td></tr><tr><td id=\"file-2-txt-L3\" data-line-number=\"3\"></td><td id=\"file-2-txt-LC3\">Using deployment &lt;service name&gt;</td></tr><tr><td id=\"file-2-txt-L4\" data-line-number=\"4\"></td><td id=\"file-2-txt-LC4\">intercepted</td></tr><tr><td id=\"file-2-txt-L5\" data-line-number=\"5\"></td><td id=\"file-2-txt-LC5\">Intercept name: &lt;service name&gt;</td></tr><tr><td id=\"file-2-txt-L6\" data-line-number=\"6\"></td><td id=\"file-2-txt-LC6\">State : ACTIVE</td></tr><tr><td id=\"file-2-txt-L7\" data-line-number=\"7\"></td><td id=\"file-2-txt-LC7\">Destination : 127.0.0.1:&lt;port&gt;</td></tr><tr><td id=\"file-2-txt-L8\" data-line-number=\"8\"></td><td id=\"file-2-txt-LC8\">Intercepting : all TCP connections</td></tr></tbody></table></div><p><strong>ขั้นตอนที่ 5</strong></p><p>อีกอย่างเราสามารถเลือกที่จะ intercept เฉพาะบาง URL ที่เรียกใช้งานมาอีกด้วย<br>หรือเรียกว่า <strong>การ intercept จาก Preview URL</strong><br>โดยที่เราต้อง clear สิ่งที่ intercept ทั้งหมดก่อน<br>จากนั้นก็ intercept แบบปกติดังนี้</p><div itemprop=\"text\" id=\"gist108480732\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-3-txt-L1\" data-line-number=\"1\"></td><td id=\"file-3-txt-LC1\">$telepresence leave dataprocessingservice</td></tr><tr><td id=\"file-3-txt-L2\" data-line-number=\"2\"></td><td id=\"file-3-txt-LC2\">$telepresence login</td></tr><tr><td id=\"file-3-txt-L3\" data-line-number=\"3\"></td><td id=\"file-3-txt-LC3\">$telepresence intercept dataprocessingservice --port 3000</td></tr></tbody></table></div><p>จากนั้นเรียกใช้งานผ่าน service ที่ทำการกำหนดไป<br>จะไปใช้งาน service ปลายทางจาก Local นั่นเอง</p><p><strong>จากการใช้งานพบว่า</strong></p><p>ช่วยให้การพัฒนาระบบงาน<br>และ deploy บน Kubernetes มีความยืดหยุ่นมากขึ้น<br>ที่สำคัญสามารถทดสอบการทำงานระหว่าง service ได้ง่ายและรวดเร็วขึ้น<br>เพื่อให้เรารู้ผลการทำงานได้รวดเร็วขึ้น<br>มีผลดีต่อ productivity อย่างมาก</p><p><strong>มีตัวอย่างของ Application ที่พัฒนาด้วยภาษาต่าง ๆ ให้ลองใช้งาน</strong></p><ul><li><a href=\"https://www.getambassador.io/docs/latest/telepresence/quick-start/qs-go/\" target=\"_blank\" rel=\"noreferrer noopener\">Go</a></li><li><a href=\"https://www.getambassador.io/docs/latest/telepresence/quick-start/qs-node/\" target=\"_blank\" rel=\"noreferrer noopener\">NodeJS</a></li><li><a href=\"https://www.getambassador.io/docs/latest/telepresence/quick-start/qs-python/\" target=\"_blank\" rel=\"noreferrer noopener\">Python with Flask</a></li><li><a href=\"https://www.getambassador.io/docs/latest/telepresence/quick-start/qs-python-fastapi/\" target=\"_blank\" rel=\"noreferrer noopener\">Python with FastAPI</a></li><li><a href=\"https://www.getambassador.io/docs/latest/telepresence/quick-start/qs-java/\" target=\"_blank\" rel=\"noreferrer noopener\">Java</a></li></ul><p><strong>Reference Websites</strong></p><ul><li><a href=\"https://blog.getambassador.io/whats-new-in-telepresence-2-dbdff62b82d5\" target=\"_blank\" rel=\"noreferrer noopener\">What’s new in TelePresence 2 ?</a></li></ul></div><div><p><img alt=\"\" src=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=90&amp;d=mm&amp;r=g\" srcset=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=180&amp;d=mm&amp;r=g 2x\" height=\"90\" width=\"90\"></p><h4>Article by <a href=\"https://www.facebook.com/somkiatspns\">Somkiat Puisungnoen</a></h4><p>To be Craftmanship</p></div></div></article></div></div>","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"91d262cc6b8a8619ee413dfd6e1d153d92de7173b5a4a8909aea7adf163ee21b","category":"Thai"}