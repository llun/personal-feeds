{"title":"คำแนะนำสำหรับ Docker + Angular","link":"https://www.somkiat.cc/docker-and-angular/","date":1619435743000,"content":"<div id=\"readability-page-1\" class=\"page\"><div id=\"page\"><article><div id=\"content_box\"><header><div><p><time>April 26, 2021</time> <span><a href=\"https://www.somkiat.cc/category/programming/\" rel=\"category tag\">Programming</a></span></p></div></header><div><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/04/angular_docker.png\" alt=\"\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/04/angular_docker.png 632w, https://www.somkiat.cc/wp-content/uploads/2021/04/angular_docker-300x139.png 300w\" sizes=\"(max-width: 632px) 100vw, 632px\"></figure><p>จากคำถามในกลุ่ม <strong><a href=\"https://www.facebook.com/groups/858633044176588/permalink/4185026948203831\" target=\"_blank\" rel=\"noreferrer noopener\">Docker in Thai</a></strong><br>เรื่องการ build Angular project ใน Docker<br>ว่าเกิด error ขึ้นมา คือ ไม่เจอคำสั่ง ng (Angular CLI)<br>ในการสร้าง Docker Image ด้วย Dockerfile<br>ดังนั้นจึงสรุปแนวทางการแก้ไขไว้นิดหน่อย</p><p><strong>ในการใช้ Docker เพื่อ build Docker image</strong></p><p>ควรรู้และเข้าใจก่อนว่า<br>เราต้องทำการติดตั้งอะไรบ้าง<br>เมื่อติดตั้งในแต่ละ OS แล้วจะเข้าใช้งานอย่างไร<br>จะทำให้การทำงานง่ายขึ้นและสามารถทำซ้ำได้<br>ทั้งในเครื่องเราและเครื่องอื่น ๆ (Repeatable)<br>ไม่ควรเกิดเหตุการณ์ที่ Work on my Machaine/Docker อีกแล้ว<br>นั่นหมายความว่า มีอะไรที่แตกต่างอย่างแน่นอน</p><p><strong>สิ่งที่ควรระวังมีดังต่อไปนี้</strong></p><ul><li>อย่า copy node_modules จากเครื่องเราไป ให้ทำการ build ในการสร้าง Image เท่านั้น</li><li>เพื่อไม่ให้ลืมหรือพลาด ควรกำหนดพวก node_module ในไฟล์ .dockerignore ไปด้วยเสมอ</li><li>ใช้คำสั่ง COPY . . เมื่อคุณเข้าใจและต้องการมันจริง ๆ อย่าใช้เพราะว่า เห็นตัวอย่างเขาก็ทำแบบนี้</li></ul><p><strong>มาดูตัวอย่าง Dockerfile ในการ build Angular app แบบง่าย ๆ</strong></p><p>โดยสิ่งที่ทำเพิ่มเข้ามาคือ <strong>การ set PATH ไปยัง node_module</strong> ที่สร้างใน Image ด้วย</p><div itemprop=\"text\" id=\"gist109197430\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-dockerfile-L1\" data-line-number=\"1\"></td><td id=\"file-dockerfile-LC1\"><span>FROM</span> node:15.14.0-alpine3.10 AS builder</td></tr><tr><td id=\"file-dockerfile-L2\" data-line-number=\"2\"></td><td id=\"file-dockerfile-LC2\"><span>WORKDIR</span> /myweb</td></tr><tr><td id=\"file-dockerfile-L3\" data-line-number=\"3\"></td><td id=\"file-dockerfile-LC3\"></td></tr><tr><td id=\"file-dockerfile-L4\" data-line-number=\"4\"></td><td id=\"file-dockerfile-LC4\"><span>COPY</span> package.json package-lock.json ./</td></tr><tr><td id=\"file-dockerfile-L5\" data-line-number=\"5\"></td><td id=\"file-dockerfile-LC5\"><span>RUN</span> npm install</td></tr><tr><td id=\"file-dockerfile-L6\" data-line-number=\"6\"></td><td id=\"file-dockerfile-LC6\"></td></tr><tr><td id=\"file-dockerfile-L7\" data-line-number=\"7\"></td><td id=\"file-dockerfile-LC7\"><span>ENV</span> PATH=<span>\"./node_modules/.bin:$PATH\"</span></td></tr><tr><td id=\"file-dockerfile-L8\" data-line-number=\"8\"></td><td id=\"file-dockerfile-LC8\"><span>COPY</span> . ./</td></tr><tr><td id=\"file-dockerfile-L9\" data-line-number=\"9\"></td><td id=\"file-dockerfile-LC9\"><span>RUN</span> ng build --prod</td></tr><tr><td id=\"file-dockerfile-L10\" data-line-number=\"10\"></td><td id=\"file-dockerfile-LC10\"></td></tr><tr><td id=\"file-dockerfile-L11\" data-line-number=\"11\"></td><td id=\"file-dockerfile-LC11\"><span>FROM</span> nginx:1.19.10-alpine</td></tr><tr><td id=\"file-dockerfile-L12\" data-line-number=\"12\"></td><td id=\"file-dockerfile-LC12\"><span>COPY</span> --from=builder /myweb/dist/demo /usr/share/nginx/html</td></tr></tbody></table></div><p>ลองใช้งานดูครับ</p><p><strong><em>ปล. จะสังเกตได้ว่า ในการสร้าง Dockerfile นั้น<br>จำเป็นต้องใช้ skill ทั้ง developer และ operation ด้วย<br>ดังนั้นควรทำงานร่วมกันเพื่อสร้าง Dockerfile ขึ้นมา<br>ไม่ใช่กำหนดไปเลยว่าต้องหน้าที่ใคร<br>เพราะว่าต้องใช้งานจากทั้งคู่ครับ</em></strong></p></div><div><p><img alt=\"\" src=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=90&amp;d=mm&amp;r=g\" srcset=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=180&amp;d=mm&amp;r=g 2x\" height=\"90\" width=\"90\"></p><h4>Article by <a href=\"https://www.facebook.com/somkiatspns\">Somkiat Puisungnoen</a></h4><p>To be Craftmanship</p></div></div></article></div></div>","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"3968ad37625189e374e09f56248c4e1e121f820cbd5c8133ae4ebda52e1e9ef5","category":"Thai"}