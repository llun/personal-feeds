{"title":"[Slack API] ทำการดึง API token สำหรับ client scope","link":"https://www.somkiat.cc/slack-api-token-with-client-scope/","date":1622995320000,"content":"<div id=\"readability-page-1\" class=\"page\"><div id=\"page\"><article><div id=\"content_box\"><header></header><div><p><strong>ปัญหาสำหรับการ integrate กับ Slack API</strong><br>โดยทำการสร้าง app ใน workspace<br>จากนั้นกำหนด permission scope เป็น admin<br>จะได้ token สำหรับการเข้าถึง<br>แต่เมื่อนำ token นี้ไปใช้งานกลับเจอปัญหานี้</p><div itemprop=\"text\" id=\"gist109955479\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-1-txt-L1\" data-line-number=\"1\"></td><td id=\"file-1-txt-LC1\">// ทดสอบการ invite ด้วย email</td></tr><tr><td id=\"file-1-txt-L2\" data-line-number=\"2\"></td><td id=\"file-1-txt-LC2\">$curl -X POST 'https://&lt;workspace name&gt;.slack.com/api/users.admin.invite' \\</td></tr><tr><td id=\"file-1-txt-L3\" data-line-number=\"3\"></td><td id=\"file-1-txt-LC3\">--data 'email=&lt;your email&gt;&amp;token=&lt;your token&gt;&amp;set_active=true' \\</td></tr><tr><td id=\"file-1-txt-L4\" data-line-number=\"4\"></td><td id=\"file-1-txt-LC4\">--compressed</td></tr><tr><td id=\"file-1-txt-L5\" data-line-number=\"5\"></td><td id=\"file-1-txt-LC5\"></td></tr><tr><td id=\"file-1-txt-L6\" data-line-number=\"6\"></td><td id=\"file-1-txt-LC6\">{\"ok\":false,\"error\":\"missing_scope\",\"needed\":\"client\",\"provided\":\"admin,identify\"}</td></tr></tbody></table></div><p>ไปดูในการ config app ก็ไม่เจอ<br>สำหรับการเพิ่ม scope ของ client</p><p><strong>ก็เลยลองไปดูหน่อยว่า Token มันทำงานอย่างไร ?</strong></p><p>เป็น Legacy feature !!</p><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/06/slack_oauth_flow_diagram-1024x575.png\" alt=\"\" width=\"491\" height=\"275\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/06/slack_oauth_flow_diagram-1024x575.png 1024w, https://www.somkiat.cc/wp-content/uploads/2021/06/slack_oauth_flow_diagram-300x168.png 300w, https://www.somkiat.cc/wp-content/uploads/2021/06/slack_oauth_flow_diagram-768x431.png 768w, https://www.somkiat.cc/wp-content/uploads/2021/06/slack_oauth_flow_diagram.png 1340w\" sizes=\"(max-width: 491px) 100vw, 491px\"></figure><p><strong>ดังนั้นต้องทำการส่ง request ไปเพื่อ Authorization สำหรับ scope=client</strong><br>และ client_id ของ app ดังนี้</p><div itemprop=\"text\" id=\"gist109955479\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-2-txt-L1\" data-line-number=\"1\"></td><td id=\"file-2-txt-LC1\"># อย่าลืมไปใส่ redirect url ของ app ด้วย</td></tr><tr><td id=\"file-2-txt-L2\" data-line-number=\"2\"></td><td id=\"file-2-txt-LC2\"></td></tr><tr><td id=\"file-2-txt-L3\" data-line-number=\"3\"></td><td id=\"file-2-txt-LC3\">เปิด URL นี้ใน browser</td></tr><tr><td id=\"file-2-txt-L4\" data-line-number=\"4\"></td><td id=\"file-2-txt-LC4\"></td></tr><tr><td id=\"file-2-txt-L5\" data-line-number=\"5\"></td><td id=\"file-2-txt-LC5\">https://&lt;workspace name&gt;.slack.com/oauth/authorize?client_id=&lt;client id of app&gt;&amp;scope=client</td></tr><tr><td id=\"file-2-txt-L6\" data-line-number=\"6\"></td><td id=\"file-2-txt-LC6\"></td></tr><tr><td id=\"file-2-txt-L7\" data-line-number=\"7\"></td><td id=\"file-2-txt-LC7\">หลังจากทำการ Allow request ข้างต้น จะ redirect ไปยัง URL ที่กำหนด</td></tr><tr><td id=\"file-2-txt-L8\" data-line-number=\"8\"></td><td id=\"file-2-txt-LC8\">ซึ่งใน URL จะมี parameter ชื่อว่า code</td></tr><tr><td id=\"file-2-txt-L9\" data-line-number=\"9\"></td><td id=\"file-2-txt-LC9\">จะใช้ในขั้นตอนต่อไป</td></tr></tbody></table></div><p><strong>จากนั้นทำการขอ Token จากผลการ Authorization</strong></p><div itemprop=\"text\" id=\"gist109955479\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-3-txt-L1\" data-line-number=\"1\"></td><td id=\"file-3-txt-LC1\">เปิดใน browser</td></tr><tr><td id=\"file-3-txt-L2\" data-line-number=\"2\"></td><td id=\"file-3-txt-LC2\"></td></tr><tr><td id=\"file-3-txt-L3\" data-line-number=\"3\"></td><td id=\"file-3-txt-LC3\">https://&lt;workspace name&gt;.slack.com/api/oauth.access?client_id=&lt;client id of app&gt;&amp;client_secret=&lt;client secret of app&gt;&amp;code=&lt;code จากขั้นตอนก่อนหน้า&gt;</td></tr><tr><td id=\"file-3-txt-L4\" data-line-number=\"4\"></td><td id=\"file-3-txt-LC4\"></td></tr><tr><td id=\"file-3-txt-L5\" data-line-number=\"5\"></td><td id=\"file-3-txt-LC5\">ได้ผลดังนี้</td></tr><tr><td id=\"file-3-txt-L6\" data-line-number=\"6\"></td><td id=\"file-3-txt-LC6\"></td></tr><tr><td id=\"file-3-txt-L7\" data-line-number=\"7\"></td><td id=\"file-3-txt-LC7\">{</td></tr><tr><td id=\"file-3-txt-L8\" data-line-number=\"8\"></td><td id=\"file-3-txt-LC8\">\"ok\": true,</td></tr><tr><td id=\"file-3-txt-L9\" data-line-number=\"9\"></td><td id=\"file-3-txt-LC9\">\"access_token\": \"your token\",</td></tr><tr><td id=\"file-3-txt-L10\" data-line-number=\"10\"></td><td id=\"file-3-txt-LC10\">\"scope\": \"read,client,admin,identify,post\",</td></tr><tr><td id=\"file-3-txt-L11\" data-line-number=\"11\"></td><td id=\"file-3-txt-LC11\">\"user_id\": \"xxx\",</td></tr><tr><td id=\"file-3-txt-L12\" data-line-number=\"12\"></td><td id=\"file-3-txt-LC12\">\"team_id\": \"xxx\",</td></tr><tr><td id=\"file-3-txt-L13\" data-line-number=\"13\"></td><td id=\"file-3-txt-LC13\">\"enterprise_id\": null,</td></tr><tr><td id=\"file-3-txt-L14\" data-line-number=\"14\"></td><td id=\"file-3-txt-LC14\">\"team_name\": \"&lt;workspace name&gt;\"</td></tr><tr><td id=\"file-3-txt-L15\" data-line-number=\"15\"></td><td id=\"file-3-txt-LC15\">}</td></tr></tbody></table></div><p>สุดท้ายก็ได้ <strong>Token</strong> ที่เอาไปใช้งานได้แล้ว<br>ง่ายไหมเนี่ย !!</p></div><div><p><img alt=\"\" src=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=90&amp;d=mm&amp;r=g\" srcset=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=180&amp;d=mm&amp;r=g 2x\" height=\"90\" width=\"90\"></p><h4>Article by <a href=\"https://www.facebook.com/somkiatspns\">Somkiat Puisungnoen</a></h4><p>To be Craftmanship</p></div></div></article></div></div>","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"2557c1e612db432c4e0c722ad3f0f743e6053e91b883bbd6f5ad98fae06deb38","category":"Thai"}