{"title":"[Arduino] สร้าง Custom Library เองใน PlatformIO แบบกากๆ","link":"https://thanapon.info/arduino-platformio-lib/","date":1609340487000,"content":"<div id=\"readability-page-1\" class=\"page\"><div id=\"post-549\"><div><p><span>December 30, 2020</span> <span><a href=\"https://thanapon.info/category/arduino/\" rel=\"category tag\">arduino</a>, <a href=\"https://thanapon.info/category/platformio/\" rel=\"category tag\">PlatformIO</a></span></p></div><p><img width=\"800\" height=\"375\" src=\"https://thanapon.info/wp-content/uploads/2020/12/New-Project.png\" alt=\"[Arduino] สร้าง Custom Library เองใน PlatformIO แบบกากๆ\" loading=\"lazy\" srcset=\"https://thanapon.info/wp-content/uploads/2020/12/New-Project.png 800w, https://thanapon.info/wp-content/uploads/2020/12/New-Project-300x141.png 300w, https://thanapon.info/wp-content/uploads/2020/12/New-Project-768x360.png 768w, https://thanapon.info/wp-content/uploads/2020/12/New-Project-600x281.png 600w\" sizes=\"(max-width: 800px) 100vw, 800px\"></p><div><p>สวัสดีครับ หลังจากที่ไม่ได้เขียน blog มาประมาณ 2 เดือน พอดีได้ลองไปศึกษาสไตล์การเขียนโปรแกรมมานิดหน่อย ก็เลยอยากจะมาแชร์วิธีการทำ custom library ใน PlatformIO เพื่อให้ project ของเรามีความเป็นระเบียบเรียบร้อยและสวยหรู</p><hr><h3>โม้ PlatformIO หน่อย</h3><div><figure><img loading=\"lazy\" width=\"730\" height=\"711\" src=\"https://thanapon.info/wp-content/uploads/2020/12/image.png\" alt=\"\" srcset=\"https://thanapon.info/wp-content/uploads/2020/12/image.png 730w, https://thanapon.info/wp-content/uploads/2020/12/image-300x292.png 300w, https://thanapon.info/wp-content/uploads/2020/12/image-600x584.png 600w\" sizes=\"(max-width: 730px) 100vw, 730px\"></figure><p>สำหรับท่านใดที่ไม่เคยใช้ PlatformIO หรือยังไม่รู้ว่าคืออะไรไม่ต้องตกใจจะครับ ตัว PlatformIO จริงๆเป็นแค่ extension ตัวหนึ่งใน Visual studio วิธีติดตั้งก็ง่ายมากครับแค่ไปค้นหา extension ใน Visual studio เอ๊งงง…..</p></div><p>ส่วน PlatformIO เป็น extension แต่ไม่ได้เป็น extension กระจอกๆ โดยตัวของมันเองเป็น tools สำหรับให้พวก developer สามารถพัฒนา embedded system ไม่ว่าจะเป็น coding, compile และ upload binary file ไปยังอุปกรณ์ ที่เราใช้ได้</p><p>ถ้าเราไปดูใน <a href=\"https://platformio.org/\" target=\"_blank\" rel=\"noreferrer noopener\">document</a> ของเขาก็จะเห็นว่า PlatformIO สามารถรองรับ</p><ul><li>932 Board ไม่ว่าจะเป็นบอร์ดตระกูล AVR, ARM, ESP</li><li>10690 Library ที่จำเป็นๆ มีหมดเช่น Adafruit และต่างๆ</li></ul><p>ซึ่งถือว่าพร้อมใช้งานมากครับ ถ้าเทียบกับ ArduinoIDE เพราะเราจำเป็นต้องลง library เยอะแยะ ถ้าหากว่าเราย้ายที่ทำงานบ่อยๆ แต่ปัญหาจะหมดไปเมื่อใช้ PlatformIO เราก็แค่กำหนด <a rel=\"noreferrer noopener\" href=\"https://docs.platformio.org/en/latest/projectconf/section_env_library.html#lib-deps\" target=\"_blank\">lib_deps </a>[Library dependencies] ใน platformio.ini แล้วจากนั้นก็จะสามารถใช้งานได้อย่างไม่ต้องกังวลเรื่องการย้ายเครื่องบ่อยๆ เพราะ PlatformIO จะทำการ sync library เองอัตโนมัติ</p><p>อีกทั้ง Visual studio code นั้นจะมี Git version control เพิ่มเข้ามาทำให้สะดวกใช้งานและเทียบการเปลี่ยนแปลงของโค๊ดเราได้และไม่ต้องกลัวโค๊ดหายอีกต่อไปครับ</p><h3>เริ่มสร้าง Library ของเราดีกว่า</h3><p>เบื้องต้นหลังจากที่เราทำการสร้าง Project จาก PlatformIO แล้ว Project structure จะได้เป็น</p><div><figure><img loading=\"lazy\" src=\"https://thanapon.info/wp-content/uploads/2020/12/image-1.png\" alt=\"\" width=\"307\" height=\"264\" srcset=\"https://thanapon.info/wp-content/uploads/2020/12/image-1.png 455w, https://thanapon.info/wp-content/uploads/2020/12/image-1-300x258.png 300w\" sizes=\"(max-width: 307px) 100vw, 307px\"><figcaption>Project structure</figcaption></figure></div><p>เริ่มต้นเราจะต้องเข้าไปสร้าง Library ของเราใน [lib] โดยผมจะตั้งชื่อ folder ว่า calculator หลังจากนั้นทำการสร้างไฟล์ .cpp และ .h ขึ้นมา</p><figure><img loading=\"lazy\" width=\"765\" height=\"163\" src=\"https://thanapon.info/wp-content/uploads/2020/12/image-4.png\" alt=\"\" srcset=\"https://thanapon.info/wp-content/uploads/2020/12/image-4.png 765w, https://thanapon.info/wp-content/uploads/2020/12/image-4-300x64.png 300w, https://thanapon.info/wp-content/uploads/2020/12/image-4-600x128.png 600w\" sizes=\"(max-width: 765px) 100vw, 765px\"></figure><p>โดยภายในไฟล์ calculator.h นั้นเราจะทำการเพิ่มในส่วนของ header และจะสร้าง class ในส่วนของ content นะครับ ซึ่ง Class ของเครื่องคิดเลขที่ผมสร้างก็จะมี method แค่ บวก กับลบแค่นั้นนะครับ ตามสไตล์ library กากๆ</p><div><pre data-file=\"calculator.h\" data-lang=\"C++\"><code data-hcb-clip=\"1\"><span>#<span>ifndef</span> CALCULATOR_H</span>\n<span>#<span>define</span> CALCULATOR_H</span>\n<span>#<span>include</span> <span>&lt;Arduino.h&gt;</span></span>\n<span>class</span> <span>Calculator</span>\n<span>{</span>\n<span>public</span><span>:</span>\n    <span>Calculator</span><span>(</span><span>)</span> <span>{</span><span>}</span>\n    <span>int</span> <span>add</span><span>(</span><span>int</span> a<span>,</span> <span>int</span> b<span>)</span><span>;</span>\n    <span>int</span> <span>minus</span><span>(</span><span>int</span> a<span>,</span> <span>int</span> b<span>)</span><span>;</span>\n<span>}</span><span>;</span>\n<span>#<span>endif</span></span></code></pre></div><p>หลังจากเราสร้างไฟล์ header สำหรับให้ไฟล์ main เรียกใช้แล้ว ต่อมาให้เราสร้างไฟล์ source code ของ class ที่เราประกาศไปก่อนหน้านี้ครับ</p><div><pre data-file=\"calculator.cpp\" data-lang=\"C++\"><code data-hcb-clip=\"2\"><span>#<span>include</span> <span>&lt;calculator.h&gt;</span></span>\n<span>int</span> Calculator <span>::</span><span>add</span><span>(</span><span>int</span> a<span>,</span> <span>int</span> b<span>)</span>\n<span>{</span>\n    <span>return</span> a <span>+</span> b<span>;</span>\n<span>}</span>\n<span>int</span> Calculator <span>::</span><span>minus</span><span>(</span><span>int</span> a<span>,</span> <span>int</span> b<span>)</span>\n<span>{</span>\n    <span>return</span> a <span>-</span> b<span>;</span>\n<span>}</span></code></pre></div><p>สำหรับการสร้าง library เครื่องคิดเลขสไตล์กากๆ ก็เสร็จแล้วครับส่วนการใช้งานเราก็ต้องกลับมายังไฟล์ main.cpp ซึ่งจะอยู่ใน src/main.cpp โดยจะต้อง include header ของ library เราเข้ามาในไฟล์ main ก่อน แล้วหลังจากนั้น declare class ของ Calculator ซึ่งเราจะสามารถเรียกใช้ method Add กับ Minus ได้นะครับ</p><div><pre data-file=\"src/main.cpp\" data-lang=\"C++\"><code data-hcb-clip=\"3\"><span>#<span>include</span> <span>&lt;Arduino.h&gt;</span></span>\n<span>#<span>include</span> <span>&lt;calculator.h&gt;</span></span>\n\nCalculator calculator<span>;</span>\n\n<span>void</span> <span>setup</span><span>(</span><span>)</span>\n<span>{</span>\n  <span>// put your setup code here, to run once:</span>\n  calculator<span>.</span><span>add</span><span>(</span><span>1</span><span>,</span> <span>2</span><span>)</span><span>;</span>\n  calculator<span>.</span><span>minus</span><span>(</span><span>2</span><span>,</span> <span>1</span><span>)</span><span>;</span>\n<span>}</span>\n\n<span>void</span> <span>loop</span><span>(</span><span>)</span>\n<span>{</span>\n  <span>// put your main code here, to run repeatedly:</span>\n<span>}</span></code></pre></div><p>จากนั้นทดสอบ build โปรเจคดูนะครับ ถ้าไม่มี error แสดงว่าผ่านครับโผมมม</p><div><figure><img loading=\"lazy\" width=\"1024\" height=\"275\" src=\"https://thanapon.info/wp-content/uploads/2020/12/image-5-1024x275.png\" alt=\"\" srcset=\"https://thanapon.info/wp-content/uploads/2020/12/image-5-1024x275.png 1024w, https://thanapon.info/wp-content/uploads/2020/12/image-5-300x81.png 300w, https://thanapon.info/wp-content/uploads/2020/12/image-5-768x206.png 768w, https://thanapon.info/wp-content/uploads/2020/12/image-5-600x161.png 600w, https://thanapon.info/wp-content/uploads/2020/12/image-5.png 1166w\" sizes=\"(max-width: 1024px) 100vw, 1024px\"></figure></div><p>เป็นอันว่าจบการสร้าง custom library ฉบับสไตล์กากๆของผมนะครับ สำหรับวันนี้ขอบคุณและสวัสดีปีใหม่ 2021 ครับผม <img draggable=\"false\" role=\"img\" alt=\"😉\" src=\"https://s.w.org/images/core/emoji/13.0.0/svg/1f609.svg\"></p><hr><blockquote><p><a href=\"https://platformio.org/\" target=\"_blank\" rel=\"noreferrer noopener\">PlatformIO is a cross-platform, cross-architecture, multiple framework, professional tool for….</a></p><cite>https://platformio.org/</cite></blockquote><blockquote><p><a href=\"https://github.com/toygame/platformio-example.git\" target=\"_blank\" rel=\"noreferrer noopener\">PlatformIO Project Structure: Github</a></p><cite>https://github.com/toygame/platformio-example.git</cite></blockquote></div></div></div>","author":"thanapon.tap","siteTitle":"Thanapon","siteHash":"6a039c2f54d76e4c49227d80968f2a30de5427cc57525c047c383ea3563cde5f","entryHash":"40449e0a98834ffdc843c27ad041a16d06955f586aa4fc62b05be781328f3d27","category":"Thai"}