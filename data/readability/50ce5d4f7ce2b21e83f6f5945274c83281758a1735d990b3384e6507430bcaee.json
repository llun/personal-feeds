{"title":"ใช้งาน Selenium 4 กับ Chrome DevTool APIs","link":"https://www.somkiat.cc/selenium-4-with-chrome-devtools-api/","date":1616939567000,"content":"<div id=\"readability-page-1\" class=\"page\"><div id=\"page\"><article><div id=\"content_box\"><header><div><p><time>March 28, 2021</time> <span><a href=\"https://www.somkiat.cc/category/programming/\" rel=\"category tag\">Programming</a>, <a href=\"https://www.somkiat.cc/category/tools/\" rel=\"category tag\">Tools</a></span></p></div></header><div><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/03/selenium-4-devtools-1024x613.png\" alt=\"\" width=\"511\" height=\"306\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/03/selenium-4-devtools-1024x613.png 1024w, https://www.somkiat.cc/wp-content/uploads/2021/03/selenium-4-devtools-300x179.png 300w, https://www.somkiat.cc/wp-content/uploads/2021/03/selenium-4-devtools-768x459.png 768w, https://www.somkiat.cc/wp-content/uploads/2021/03/selenium-4-devtools.png 1140w\" sizes=\"(max-width: 511px) 100vw, 511px\"></figure><p>ใน Selenium 4 นั้นเป็นเหมือนกับการยกเครื่องใหม่ของ Selenium กันเลย<br>โดยหนึ่งใน API ที่เพิ่มเข้ามาก็คือ <strong><a rel=\"noreferrer noopener\" href=\"https://www.selenium.dev/documentation/en/support_packages/chrome_devtools/\" target=\"_blank\">Chrome DevTool APIs</a></strong><br>ทำให้ Selenium สามารถจัดการ browser ที่สร้างมาจาก Chromium ได้<br>ยกตัวอย่างเช่น Chrome, Opera และ Microsoft Edge<br>ช่วยให้ง่ายต่อการ debug และ investigate ปัญหาต่าง ๆ ของ web</p><p><strong>มาดูความสามารถที่มีใน Selenium Chrome DevTool APIs</strong></p><ul><li>URL filter</li><li>เพิ่ม Header ของ HTTP Request ได้</li><li>Intercept ทั้ง request และ response ที่เข้าและออกจาก browser ทำหน้าที่เป็นเหมือน proxy นั่นเอง</li><li>ดึงข้อมูลเรื่อง performance metric การทำงานทั้ง browser และเรื่องของ network ได้</li><li>จำลองการทำงานของ Network ตามที่เราต้องการ</li><li>จัดการเรื่อง security</li><li>ทำงานกับ console</li><li>จัดการเรื่องของ Geo Location</li></ul><p><strong>ตัวอย่างการใช้งานก็ไม่ยาก</strong></p><p>มาดูตัวอย่างง่าย ๆ ที่พัฒนาด้วยภาษา Java<br></p><p><strong>เริ่มจากการเพิ่ม dependency ของ <a href=\"https://mvnrepository.com/artifact/org.seleniumhq.selenium/selenium-java\" target=\"_blank\" rel=\"noreferrer noopener\">Selenium 4 Java</a> มา</strong></p><p>ซึ่งยังเป็น beta version อยู่</p><div itemprop=\"text\" id=\"gist108702598\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-pom-xml-L1\" data-line-number=\"1\"></td><td id=\"file-pom-xml-LC1\">&lt;<span>dependency</span>&gt;</td></tr><tr><td id=\"file-pom-xml-L2\" data-line-number=\"2\"></td><td id=\"file-pom-xml-LC2\">&lt;<span>groupId</span>&gt;org.seleniumhq.selenium&lt;/<span>groupId</span>&gt;</td></tr><tr><td id=\"file-pom-xml-L3\" data-line-number=\"3\"></td><td id=\"file-pom-xml-LC3\">&lt;<span>artifactId</span>&gt;selenium-java&lt;/<span>artifactId</span>&gt;</td></tr><tr><td id=\"file-pom-xml-L4\" data-line-number=\"4\"></td><td id=\"file-pom-xml-LC4\">&lt;<span>version</span>&gt;4.0.0-beta-2&lt;/<span>version</span>&gt;</td></tr><tr><td id=\"file-pom-xml-L5\" data-line-number=\"5\"></td><td id=\"file-pom-xml-LC5\">&lt;/<span>dependency</span>&gt;</td></tr></tbody></table></div><p><strong>การสร้าง session การทำงานของ DevTools</strong></p><p>ซึ่งสร้างจาก <a href=\"https://github.com/SeleniumHQ/selenium/wiki/ChromeDriver\" target=\"_blank\" rel=\"noreferrer noopener\">ChromeDriver</a> ผลที่ได้คือ เปิด Chrome ขึ้นมา ดังนี้</p><div itemprop=\"text\" id=\"gist108702598\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-1-java-L1\" data-line-number=\"1\"></td><td id=\"file-1-java-LC1\"><span>private</span> <span>static</span> <span>ChromeDriver</span> chromeDriver;</td></tr><tr><td id=\"file-1-java-L2\" data-line-number=\"2\"></td><td id=\"file-1-java-LC2\"><span>private</span> <span>static</span> <span>DevTools</span> devTool;</td></tr><tr><td id=\"file-1-java-L3\" data-line-number=\"3\"></td><td id=\"file-1-java-LC3\"></td></tr><tr><td id=\"file-1-java-L4\" data-line-number=\"4\"></td><td id=\"file-1-java-LC4\"></td></tr><tr><td id=\"file-1-java-L5\" data-line-number=\"5\"></td><td id=\"file-1-java-LC5\"><span>@BeforeAll</span></td></tr><tr><td id=\"file-1-java-L6\" data-line-number=\"6\"></td><td id=\"file-1-java-LC6\"><span>public</span> <span>static</span> <span>void</span> start() {</td></tr><tr><td id=\"file-1-java-L7\" data-line-number=\"7\"></td><td id=\"file-1-java-LC7\"><span>System</span><span>.</span>setProperty(<span><span>\"</span>webdriver.chrome.driver<span>\"</span></span>, <span><span>\"</span>&lt;PAth to chromedriver&gt;<span>\"</span></span>);</td></tr><tr><td id=\"file-1-java-L8\" data-line-number=\"8\"></td><td id=\"file-1-java-LC8\"></td></tr><tr><td id=\"file-1-java-L9\" data-line-number=\"9\"></td><td id=\"file-1-java-LC9\">chromeDriver <span>=</span> <span>new</span> <span>ChromeDriver</span>();</td></tr><tr><td id=\"file-1-java-L10\" data-line-number=\"10\"></td><td id=\"file-1-java-LC10\">devTool <span>=</span> chromeDriver<span>.</span>getDevTools();</td></tr><tr><td id=\"file-1-java-L11\" data-line-number=\"11\"></td><td id=\"file-1-java-LC11\">devTool<span>.</span>createSession();</td></tr><tr><td id=\"file-1-java-L12\" data-line-number=\"12\"></td><td id=\"file-1-java-LC12\">}</td></tr></tbody></table></div><p><strong>ทำการ Ignore certificated ที่ Errorถ้านึกไม่ออก</strong></p><p>คือ หน้า error แบบนี้ จะทำการ ignore ไปเลย</p><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/03/Screen-Shot-2564-03-28-at-20.34.16-1024x681.png\" alt=\"\" width=\"511\" height=\"339\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/03/Screen-Shot-2564-03-28-at-20.34.16-1024x681.png 1024w, https://www.somkiat.cc/wp-content/uploads/2021/03/Screen-Shot-2564-03-28-at-20.34.16-300x200.png 300w, https://www.somkiat.cc/wp-content/uploads/2021/03/Screen-Shot-2564-03-28-at-20.34.16-768x511.png 768w, https://www.somkiat.cc/wp-content/uploads/2021/03/Screen-Shot-2564-03-28-at-20.34.16-1536x1022.png 1536w, https://www.somkiat.cc/wp-content/uploads/2021/03/Screen-Shot-2564-03-28-at-20.34.16.png 1716w\" sizes=\"(max-width: 511px) 100vw, 511px\"></figure><p>ตัวอย่าง code</p><div itemprop=\"text\" id=\"gist108702598\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-2-java-L1\" data-line-number=\"1\"></td><td id=\"file-2-java-LC1\"><span>@Test</span></td></tr><tr><td id=\"file-2-java-L2\" data-line-number=\"2\"></td><td id=\"file-2-java-LC2\"><span>public</span> <span>void</span> loadInsecureWeb() {</td></tr><tr><td id=\"file-2-java-L3\" data-line-number=\"3\"></td><td id=\"file-2-java-LC3\">devTool<span>.</span>send(<span>Security</span><span>.</span>enable());</td></tr><tr><td id=\"file-2-java-L4\" data-line-number=\"4\"></td><td id=\"file-2-java-LC4\">devTool<span>.</span>send(<span>Security</span><span>.</span>setIgnoreCertificateErrors(<span>true</span>));</td></tr><tr><td id=\"file-2-java-L5\" data-line-number=\"5\"></td><td id=\"file-2-java-LC5\"></td></tr><tr><td id=\"file-2-java-L6\" data-line-number=\"6\"></td><td id=\"file-2-java-LC6\">chromeDriver<span>.</span>get(<span><span>\"</span>https://expired.badssl.com/<span>\"</span></span>);</td></tr><tr><td id=\"file-2-java-L7\" data-line-number=\"7\"></td><td id=\"file-2-java-LC7\"></td></tr><tr><td id=\"file-2-java-L8\" data-line-number=\"8\"></td><td id=\"file-2-java-LC8\">assertEquals(<span>true</span>, chromeDriver<span>.</span>getPageSource()<span>.</span>contains(<span><span>\"</span>expired<span>\"</span></span>));</td></tr><tr><td id=\"file-2-java-L9\" data-line-number=\"9\"></td><td id=\"file-2-java-LC9\">}</td></tr></tbody></table></div><p>เพียงเท่านี้ก็สามารถใช้งานได้แล้ว<br>ลองศึกษาเพิ่มเติมกันดูครับ</p><p><strong>Reference Websites</strong></p><ul><li><a rel=\"noreferrer noopener\" href=\"https://medium.com/@ohanaadi/chrome-devtools-and-selenium-4-eadab5d755b7\" target=\"_blank\">Demo selenium 4 and DevTools API</a></li><li><a rel=\"noreferrer noopener\" href=\"https://developers.google.com/web/tools/chrome-devtools\" target=\"_blank\">Chrome DevTools</a></li><li><a href=\"https://www.selenium.dev/documentation/en/support_packages/chrome_devtools/\" target=\"_blank\" rel=\"noreferrer noopener\">Official :: Selenium 4 DevTools</a></li></ul></div><div><p><img alt=\"\" src=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=90&amp;d=mm&amp;r=g\" srcset=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=180&amp;d=mm&amp;r=g 2x\" height=\"90\" width=\"90\"></p><h4>Article by <a href=\"https://www.facebook.com/somkiatspns\">Somkiat Puisungnoen</a></h4><p>To be Craftmanship</p></div></div></article></div></div>","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"50ce5d4f7ce2b21e83f6f5945274c83281758a1735d990b3384e6507430bcaee","category":"Thai"}