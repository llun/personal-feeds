{"title":"0247 | internal linux traffic flow","link":"https://www.icez.net/blog/167435/0247-internal-linux-traffic-flow","date":1591007951000,"content":"<div id=\"readability-page-1\" class=\"page\"><div id=\"wrap\"><h2><a href=\"https://www.icez.net/blog/167435/0247-internal-linux-traffic-flow\" rel=\"bookmark\" title=\"Permanent Link: 0247 | internal linux traffic flow\">0247 | internal linux traffic flow</a></h2><p>June 1st, 2020 by icez | Posted in <a href=\"https://www.icez.net/blog/topics/misc\" rel=\"category tag\">Misc</a> |</p><p>diagram จาก wikipedia</p><p><a href=\"https://en.wikipedia.org/wiki/Netfilter\"><img src=\"https://upload.wikimedia.org/wikipedia/commons/3/37/Netfilter-packet-flow.svg\" alt=\"\"></a></p><p>action log จาก linux box จริงๆ</p><pre><span>Jun</span><span> </span><span>14</span><span> </span><span>13</span><span>:</span><span>02</span><span>:</span><span>12</span><span> deb8 kernel</span><span>:</span><span> </span><span>[</span><span> </span><span>4273.341087</span><span>]</span><span> simple</span><span>:</span><span> tc</span><span>[</span><span>eth1</span><span>]</span><span>ingress_1\n</span><span>Jun</span><span> </span><span>14</span><span> </span><span>13</span><span>:</span><span>02</span><span>:</span><span>12</span><span> deb8 kernel</span><span>:</span><span> </span><span>[</span><span> </span><span>4273.341114</span><span>]</span><span> simple</span><span>:</span><span> tc</span><span>[</span><span>ifb1</span><span>]</span><span>egress_1\n</span><span>Jun</span><span> </span><span>14</span><span> </span><span>13</span><span>:</span><span>02</span><span>:</span><span>12</span><span> deb8 kernel</span><span>:</span><span> </span><span>[</span><span> </span><span>4273.341229</span><span>]</span><span> ipt</span><span>[</span><span>PREROUTING</span><span>]</span><span>raw IN</span><span>=</span><span>eth1 OUT</span><span>=</span><span> MAC</span><span>=</span><span>08</span><span>:</span><span>00</span><span>:</span><span>27</span><span>:</span><span>ee</span><span>:</span><span>8f</span><span>:</span><span>15</span><span>:</span><span>08</span><span>:</span><span>00</span><span>:</span><span>27</span><span>:</span><span>89</span><span>:</span><span>16</span><span>:</span><span>5b</span><span>:</span><span>08</span><span>:</span><span>00</span><span> SRC</span><span>=</span><span>10.1</span><span>.</span><span>1.3</span><span> DST</span><span>=</span><span>10.1</span><span>.</span><span>1.2</span><span> LEN</span><span>=</span><span>84</span><span> TOS</span><span>=</span><span>0x00</span><span> PREC</span><span>=</span><span>0x00</span><span> TTL</span><span>=</span><span>64</span><span> ID</span><span>=</span><span>53979</span><span> DF PROTO</span><span>=</span><span>ICMP TYPE</span><span>=</span><span>8</span><span> CODE</span><span>=</span><span>0</span><span> ID</span><span>=</span><span>1382</span><span> SEQ</span><span>=</span><span>1</span><span>\n</span><span>Jun</span><span> </span><span>14</span><span> </span><span>13</span><span>:</span><span>02</span><span>:</span><span>12</span><span> deb8 kernel</span><span>:</span><span> </span><span>[</span><span> </span><span>4273.341238</span><span>]</span><span> ipt</span><span>[</span><span>PREROUTING</span><span>]</span><span>mangle IN</span><span>=</span><span>eth1 OUT</span><span>=</span><span> MAC</span><span>=</span><span>08</span><span>:</span><span>00</span><span>:</span><span>27</span><span>:</span><span>ee</span><span>:</span><span>8f</span><span>:</span><span>15</span><span>:</span><span>08</span><span>:</span><span>00</span><span>:</span><span>27</span><span>:</span><span>89</span><span>:</span><span>16</span><span>:</span><span>5b</span><span>:</span><span>08</span><span>:</span><span>00</span><span> SRC</span><span>=</span><span>10.1</span><span>.</span><span>1.3</span><span> DST</span><span>=</span><span>10.1</span><span>.</span><span>1.2</span><span> LEN</span><span>=</span><span>84</span><span> TOS</span><span>=</span><span>0x00</span><span> PREC</span><span>=</span><span>0x00</span><span> TTL</span><span>=</span><span>64</span><span> ID</span><span>=</span><span>53979</span><span> DF PROTO</span><span>=</span><span>ICMP TYPE</span><span>=</span><span>8</span><span> CODE</span><span>=</span><span>0</span><span> ID</span><span>=</span><span>1382</span><span> SEQ</span><span>=</span><span>1</span><span>\n</span><span>Jun</span><span> </span><span>14</span><span> </span><span>13</span><span>:</span><span>02</span><span>:</span><span>12</span><span> deb8 kernel</span><span>:</span><span> </span><span>[</span><span> </span><span>4273.341242</span><span>]</span><span> ipt</span><span>[</span><span>PREROUTING</span><span>]</span><span>nat IN</span><span>=</span><span>eth1 OUT</span><span>=</span><span> MAC</span><span>=</span><span>08</span><span>:</span><span>00</span><span>:</span><span>27</span><span>:</span><span>ee</span><span>:</span><span>8f</span><span>:</span><span>15</span><span>:</span><span>08</span><span>:</span><span>00</span><span>:</span><span>27</span><span>:</span><span>89</span><span>:</span><span>16</span><span>:</span><span>5b</span><span>:</span><span>08</span><span>:</span><span>00</span><span> SRC</span><span>=</span><span>10.1</span><span>.</span><span>1.3</span><span> DST</span><span>=</span><span>10.1</span><span>.</span><span>1.2</span><span> LEN</span><span>=</span><span>84</span><span> TOS</span><span>=</span><span>0x00</span><span> PREC</span><span>=</span><span>0x00</span><span> TTL</span><span>=</span><span>64</span><span> ID</span><span>=</span><span>53979</span><span> DF PROTO</span><span>=</span><span>ICMP TYPE</span><span>=</span><span>8</span><span> CODE</span><span>=</span><span>0</span><span> ID</span><span>=</span><span>1382</span><span> SEQ</span><span>=</span><span>1</span><span>\n</span><span>Jun</span><span> </span><span>14</span><span> </span><span>13</span><span>:</span><span>02</span><span>:</span><span>12</span><span> deb8 kernel</span><span>:</span><span> </span><span>[</span><span> </span><span>4273.341249</span><span>]</span><span> ipt</span><span>[</span><span>INPUT</span><span>]</span><span>mangle IN</span><span>=</span><span>eth1 OUT</span><span>=</span><span> MAC</span><span>=</span><span>08</span><span>:</span><span>00</span><span>:</span><span>27</span><span>:</span><span>ee</span><span>:</span><span>8f</span><span>:</span><span>15</span><span>:</span><span>08</span><span>:</span><span>00</span><span>:</span><span>27</span><span>:</span><span>89</span><span>:</span><span>16</span><span>:</span><span>5b</span><span>:</span><span>08</span><span>:</span><span>00</span><span> SRC</span><span>=</span><span>10.1</span><span>.</span><span>1.3</span><span> DST</span><span>=</span><span>10.1</span><span>.</span><span>1.2</span><span> LEN</span><span>=</span><span>84</span><span> TOS</span><span>=</span><span>0x00</span><span> PREC</span><span>=</span><span>0x00</span><span> TTL</span><span>=</span><span>64</span><span> ID</span><span>=</span><span>53979</span><span> DF PROTO</span><span>=</span><span>ICMP TYPE</span><span>=</span><span>8</span><span> CODE</span><span>=</span><span>0</span><span> ID</span><span>=</span><span>1382</span><span> SEQ</span><span>=</span><span>1</span><span>\n</span><span>Jun</span><span> </span><span>14</span><span> </span><span>13</span><span>:</span><span>02</span><span>:</span><span>12</span><span> deb8 kernel</span><span>:</span><span> </span><span>[</span><span> </span><span>4273.341252</span><span>]</span><span> ipt</span><span>[</span><span>INPUT</span><span>]</span><span>filter IN</span><span>=</span><span>eth1 OUT</span><span>=</span><span> MAC</span><span>=</span><span>08</span><span>:</span><span>00</span><span>:</span><span>27</span><span>:</span><span>ee</span><span>:</span><span>8f</span><span>:</span><span>15</span><span>:</span><span>08</span><span>:</span><span>00</span><span>:</span><span>27</span><span>:</span><span>89</span><span>:</span><span>16</span><span>:</span><span>5b</span><span>:</span><span>08</span><span>:</span><span>00</span><span> SRC</span><span>=</span><span>10.1</span><span>.</span><span>1.3</span><span> DST</span><span>=</span><span>10.1</span><span>.</span><span>1.2</span><span> LEN</span><span>=</span><span>84</span><span> TOS</span><span>=</span><span>0x00</span><span> PREC</span><span>=</span><span>0x00</span><span> TTL</span><span>=</span><span>64</span><span> ID</span><span>=</span><span>53979</span><span> DF PROTO</span><span>=</span><span>ICMP TYPE</span><span>=</span><span>8</span><span> CODE</span><span>=</span><span>0</span><span> ID</span><span>=</span><span>1382</span><span> SEQ</span><span>=</span><span>1</span><span>\n</span><span>Jun</span><span> </span><span>14</span><span> </span><span>13</span><span>:</span><span>02</span><span>:</span><span>12</span><span> deb8 kernel</span><span>:</span><span> </span><span>[</span><span> </span><span>4273.341255</span><span>]</span><span> ipt</span><span>[</span><span>INPUT</span><span>]</span><span>nat IN</span><span>=</span><span>eth1 OUT</span><span>=</span><span> MAC</span><span>=</span><span>08</span><span>:</span><span>00</span><span>:</span><span>27</span><span>:</span><span>ee</span><span>:</span><span>8f</span><span>:</span><span>15</span><span>:</span><span>08</span><span>:</span><span>00</span><span>:</span><span>27</span><span>:</span><span>89</span><span>:</span><span>16</span><span>:</span><span>5b</span><span>:</span><span>08</span><span>:</span><span>00</span><span> SRC</span><span>=</span><span>10.1</span><span>.</span><span>1.3</span><span> DST</span><span>=</span><span>10.1</span><span>.</span><span>1.2</span><span> LEN</span><span>=</span><span>84</span><span> TOS</span><span>=</span><span>0x00</span><span> PREC</span><span>=</span><span>0x00</span><span> TTL</span><span>=</span><span>64</span><span> ID</span><span>=</span><span>53979</span><span> DF PROTO</span><span>=</span><span>ICMP TYPE</span><span>=</span><span>8</span><span> CODE</span><span>=</span><span>0</span><span> ID</span><span>=</span><span>1382</span><span> SEQ</span><span>=</span><span>1</span><span>\n</span><span>Jun</span><span> </span><span>14</span><span> </span><span>13</span><span>:</span><span>02</span><span>:</span><span>12</span><span> deb8 kernel</span><span>:</span><span> </span><span>[</span><span> </span><span>4273.341267</span><span>]</span><span> ipt</span><span>[</span><span>OUTPUT</span><span>]</span><span>raw IN</span><span>=</span><span> OUT</span><span>=</span><span>eth1 SRC</span><span>=</span><span>10.1</span><span>.</span><span>1.2</span><span> DST</span><span>=</span><span>10.1</span><span>.</span><span>1.3</span><span> LEN</span><span>=</span><span>84</span><span> TOS</span><span>=</span><span>0x00</span><span> PREC</span><span>=</span><span>0x00</span><span> TTL</span><span>=</span><span>64</span><span> ID</span><span>=</span><span>37735</span><span> PROTO</span><span>=</span><span>ICMP TYPE</span><span>=</span><span>0</span><span> CODE</span><span>=</span><span>0</span><span> ID</span><span>=</span><span>1382</span><span> SEQ</span><span>=</span><span>1</span><span>\n</span><span>Jun</span><span> </span><span>14</span><span> </span><span>13</span><span>:</span><span>02</span><span>:</span><span>12</span><span> deb8 kernel</span><span>:</span><span> </span><span>[</span><span> </span><span>4273.341270</span><span>]</span><span> ipt</span><span>[</span><span>OUTPUT</span><span>]</span><span>mangle IN</span><span>=</span><span> OUT</span><span>=</span><span>eth1 SRC</span><span>=</span><span>10.1</span><span>.</span><span>1.2</span><span> DST</span><span>=</span><span>10.1</span><span>.</span><span>1.3</span><span> LEN</span><span>=</span><span>84</span><span> TOS</span><span>=</span><span>0x00</span><span> PREC</span><span>=</span><span>0x00</span><span> TTL</span><span>=</span><span>64</span><span> ID</span><span>=</span><span>37735</span><span> PROTO</span><span>=</span><span>ICMP TYPE</span><span>=</span><span>0</span><span> CODE</span><span>=</span><span>0</span><span> ID</span><span>=</span><span>1382</span><span> SEQ</span><span>=</span><span>1</span><span>\n</span><span>Jun</span><span> </span><span>14</span><span> </span><span>13</span><span>:</span><span>02</span><span>:</span><span>12</span><span> deb8 kernel</span><span>:</span><span> </span><span>[</span><span> </span><span>4273.341272</span><span>]</span><span> ipt</span><span>[</span><span>OUTPUT</span><span>]</span><span>filter IN</span><span>=</span><span> OUT</span><span>=</span><span>eth1 SRC</span><span>=</span><span>10.1</span><span>.</span><span>1.2</span><span> DST</span><span>=</span><span>10.1</span><span>.</span><span>1.3</span><span> LEN</span><span>=</span><span>84</span><span> TOS</span><span>=</span><span>0x00</span><span> PREC</span><span>=</span><span>0x00</span><span> TTL</span><span>=</span><span>64</span><span> ID</span><span>=</span><span>37735</span><span> PROTO</span><span>=</span><span>ICMP TYPE</span><span>=</span><span>0</span><span> CODE</span><span>=</span><span>0</span><span> ID</span><span>=</span><span>1382</span><span> SEQ</span><span>=</span><span>1</span><span>\n</span><span>Jun</span><span> </span><span>14</span><span> </span><span>13</span><span>:</span><span>02</span><span>:</span><span>12</span><span> deb8 kernel</span><span>:</span><span> </span><span>[</span><span> </span><span>4273.341274</span><span>]</span><span> ipt</span><span>[</span><span>POSTROUTING</span><span>]</span><span>mangle IN</span><span>=</span><span> OUT</span><span>=</span><span>eth1 SRC</span><span>=</span><span>10.1</span><span>.</span><span>1.2</span><span> DST</span><span>=</span><span>10.1</span><span>.</span><span>1.3</span><span> LEN</span><span>=</span><span>84</span><span> TOS</span><span>=</span><span>0x00</span><span> PREC</span><span>=</span><span>0x00</span><span> TTL</span><span>=</span><span>64</span><span> ID</span><span>=</span><span>37735</span><span> PROTO</span><span>=</span><span>ICMP TYPE</span><span>=</span><span>0</span><span> CODE</span><span>=</span><span>0</span><span> ID</span><span>=</span><span>1382</span><span> SEQ</span><span>=</span><span>1</span><span>\n</span><span>Jun</span><span> </span><span>14</span><span> </span><span>13</span><span>:</span><span>02</span><span>:</span><span>12</span><span> deb8 kernel</span><span>:</span><span> </span><span>[</span><span> </span><span>4273.341278</span><span>]</span><span> simple</span><span>:</span><span> tc</span><span>[</span><span>eth1</span><span>]</span><span>egress_1\n</span><span>Jun</span><span> </span><span>14</span><span> </span><span>13</span><span>:</span><span>02</span><span>:</span><span>12</span><span> deb8 kernel</span><span>:</span><span> </span><span>[</span><span> </span><span>4273.341280</span><span>]</span><span> simple</span><span>:</span><span> tc</span><span>[</span><span>ifb0</span><span>]</span><span>egress_1</span></pre><p>source: <a href=\"https://unix.stackexchange.com/questions/288959/how-is-the-ifb-device-positioned-in-the-packet-flow-of-the-linux-kernel\">https://unix.stackexchange.com/questions/288959/how-is-the-ifb-device-positioned-in-the-packet-flow-of-the-linux-kernel</a></p></div></div>","author":"icez","siteTitle":"icez network","siteHash":"88787adba55f9deb5660f47c4b8baf580eb765815e4a6d536737656e8ab8bde4","entryHash":"f45608563cd2d916a10ef5fe980f4b68ab241a75c7683898a11c503a83f74001","category":"Thai"}