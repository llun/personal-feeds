{"title":"ใช้งาน GIN index ของ PostgreSQL database สำหรับค้นหาข้อมูล","link":"https://www.somkiat.cc/gin-index-in-postgresql/","date":1613810801000,"content":"<div id=\"readability-page-1\" class=\"page\"><div id=\"page\"><article><div id=\"content_box\"><header><div><p><time>February 20, 2021</time> <span><a href=\"https://www.somkiat.cc/category/programming/\" rel=\"category tag\">Programming</a></span></p></div></header><div><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/02/gin-00.jpeg\" alt=\"\" width=\"548\" height=\"308\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/02/gin-00.jpeg 960w, https://www.somkiat.cc/wp-content/uploads/2021/02/gin-00-300x169.jpeg 300w, https://www.somkiat.cc/wp-content/uploads/2021/02/gin-00-768x432.jpeg 768w\" sizes=\"(max-width: 548px) 100vw, 548px\"></figure><p>ใน PostgreSQL database นั้นเตรียม index ประเภทต่าง ๆ ไว้ให้ใช้งาน<br>สำหรับการเพิ่ม performace ของการ query ข้อมูล<br>แต่ก็ต้องแลกมากับ การเพิ่มหรือแก้ไขข้อมูลที่ช้าลง<br>รวมทั้งใช้พื้นที่ disk ในการจัดเก็บที่สูงขึ้น<br>เลือกใช้งานตาม use case ต่าง ๆ ดังนี้</p><ul><li>B-Tree (default index)</li><li>Hash</li><li>GiST (Generalized Search Tree)</li><li>SP-GiST (Space-Partitioned GiST)</li><li>GIN (Generalized Inverted Index)</li><li>BRIN (Block Range INdexes)</li></ul><p><strong>หนึ่งตัวที่น่าสนใจคือ <a href=\"https://www.postgresql.org/docs/current/gin-intro.html\" target=\"_blank\" rel=\"noreferrer noopener\">GIN</a> (Generalized Inverted Index)</strong></p><p>เนื่องจากชื่อ index มันคุ้น ๆ คือ <strong><a href=\"https://en.wikipedia.org/wiki/Inverted_index\" target=\"_blank\" rel=\"noreferrer noopener\">Inverted Index</a></strong><br>ซึ่งใช้งานใน Apache Lucene ที่ Elasticsearch ใช้งานนั่นเอง<br>มีเป้าหมายเพื่อค้นหาข้อมูลจากคำที่ต้องการ</p><p><strong>การทำงานจะไม่มีอะไรมาก</strong></p><p>นั่นคือ การแบ่งคำ และ จัดเก็บแต่ละคำว่าอยู่ตรงไหนใน table<br>ตัวอย่างของ Inverted Index แสดงดังรูป</p><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/02/gin-01.png\" alt=\"\" width=\"567\" height=\"257\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/02/gin-01.png 914w, https://www.somkiat.cc/wp-content/uploads/2021/02/gin-01-300x137.png 300w, https://www.somkiat.cc/wp-content/uploads/2021/02/gin-01-768x350.png 768w\" sizes=\"(max-width: 567px) 100vw, 567px\"></figure><p><strong>การใช้งานเป็นดังนี้</strong></p><div itemprop=\"text\" id=\"gist108035387\"><table data-tab-size=\"8\" data-paste-markdown-skip=\"\"><tbody><tr><td id=\"file-1-txt-L1\" data-line-number=\"1\"></td><td id=\"file-1-txt-LC1\"># Create search table</td></tr><tr><td id=\"file-1-txt-L2\" data-line-number=\"2\"></td><td id=\"file-1-txt-LC2\">CREATE TABLE search (</td></tr><tr><td id=\"file-1-txt-L3\" data-line-number=\"3\"></td><td id=\"file-1-txt-LC3\">body text,</td></tr><tr><td id=\"file-1-txt-L4\" data-line-number=\"4\"></td><td id=\"file-1-txt-LC4\">body_indexed text</td></tr><tr><td id=\"file-1-txt-L5\" data-line-number=\"5\"></td><td id=\"file-1-txt-LC5\">);</td></tr><tr><td id=\"file-1-txt-L6\" data-line-number=\"6\"></td><td id=\"file-1-txt-LC6\"></td></tr><tr><td id=\"file-1-txt-L7\" data-line-number=\"7\"></td><td id=\"file-1-txt-LC7\"># add an index :: ตัดคำแบบ tri-gram (https://en.wikipedia.org/wiki/N-gram)</td></tr><tr><td id=\"file-1-txt-L8\" data-line-number=\"8\"></td><td id=\"file-1-txt-LC8\">CREATE INDEX search_idx ON search USING gin (body_indexed gin_trgm_ops);</td></tr><tr><td id=\"file-1-txt-L9\" data-line-number=\"9\"></td><td id=\"file-1-txt-LC9\"></td></tr><tr><td id=\"file-1-txt-L10\" data-line-number=\"10\"></td><td id=\"file-1-txt-LC10\"># Insert data</td></tr><tr><td id=\"file-1-txt-L11\" data-line-number=\"11\"></td><td id=\"file-1-txt-LC11\">INSERT INTO search</td></tr><tr><td id=\"file-1-txt-L12\" data-line-number=\"12\"></td><td id=\"file-1-txt-LC12\">SELECT</td></tr><tr><td id=\"file-1-txt-L13\" data-line-number=\"13\"></td><td id=\"file-1-txt-LC13\">md5(random()::text),</td></tr><tr><td id=\"file-1-txt-L14\" data-line-number=\"14\"></td><td id=\"file-1-txt-LC14\">md5(random()::text)</td></tr><tr><td id=\"file-1-txt-L15\" data-line-number=\"15\"></td><td id=\"file-1-txt-LC15\">from (</td></tr><tr><td id=\"file-1-txt-L16\" data-line-number=\"16\"></td><td id=\"file-1-txt-LC16\">SELECT * FROM generate_series(1,1000000) AS id</td></tr><tr><td id=\"file-1-txt-L17\" data-line-number=\"17\"></td><td id=\"file-1-txt-LC17\">) AS data;</td></tr><tr><td id=\"file-1-txt-L18\" data-line-number=\"18\"></td><td id=\"file-1-txt-LC18\"></td></tr><tr><td id=\"file-1-txt-L19\" data-line-number=\"19\"></td><td id=\"file-1-txt-LC19\"># Search data without index</td></tr><tr><td id=\"file-1-txt-L20\" data-line-number=\"20\"></td><td id=\"file-1-txt-LC20\">SELECT count(*) FROM search where body ilike '%abc%';</td></tr><tr><td id=\"file-1-txt-L21\" data-line-number=\"21\"></td><td id=\"file-1-txt-LC21\"></td></tr><tr><td id=\"file-1-txt-L22\" data-line-number=\"22\"></td><td id=\"file-1-txt-LC22\"># Search data with GIN index (better performance)</td></tr><tr><td id=\"file-1-txt-L23\" data-line-number=\"23\"></td><td id=\"file-1-txt-LC23\">SELECT count(*) FROM search where body_indexed ilike'%abc%';</td></tr></tbody></table></div><p>นี่คือหนึ่งในแนวทางการเลือกใช้งาน Index ให้เหมาะสมกับงาน</p></div><div><p><img alt=\"\" src=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=90&amp;d=mm&amp;r=g\" srcset=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=180&amp;d=mm&amp;r=g 2x\" height=\"90\" width=\"90\"></p><h4>Article by <a href=\"https://www.facebook.com/somkiatspns\">Somkiat Puisungnoen</a></h4><p>To be Craftmanship</p></div></div></article></div></div>","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"d3485b917074a2f1f7cea4dc86564f2c7eb0e1feefc704dc716f1653e4d2a708","category":"Thai"}