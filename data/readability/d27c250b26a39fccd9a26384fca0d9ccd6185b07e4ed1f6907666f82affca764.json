{"title":"0243 | upgrade centos 7 เป็น centos 8","link":"https://www.icez.net/blog/167388/upgrade-centos-7-to-centos-8","date":1581527208000,"content":"<div id=\"readability-page-1\" class=\"page\"><div id=\"wrap\"><h2><a href=\"https://www.icez.net/blog/167388/upgrade-centos-7-to-centos-8\" rel=\"bookmark\" title=\"Permanent Link: 0243 | upgrade centos 7 เป็น centos 8\">0243 | upgrade centos 7 เป็น centos 8</a></h2><p>February 13th, 2020 by icez | Posted in <a href=\"https://www.icez.net/blog/topics/linux\" rel=\"category tag\">Linux</a> |</p><ul><li>อาจไม่ได้ผลในกรณีที่ลง software จาก repository ภายนอก</li><li>ตรวจสอบให้แน่ใจว่าทุก repository ที่ใช้งานอยู่ รองรับ centos 8 ก่อนอัพเกรด</li><li>backup ก่อนเสมอ</li></ul><p>reference: <a href=\"https://www.tecmint.com/upgrade-centos-7-to-centos-8/\">https://www.tecmint.com/upgrade-centos-7-to-centos-8/</a></p><p>1) ลง epel repository</p><pre><span>yum install epel</span><span>-</span><span>release </span><span>-</span><span>y</span></pre><p>2) ลง package yum-utils กับ rpmconf</p><pre><span>yum install yum</span><span>-</span><span>utils rpmconf</span></pre><p>3) check ไฟล์ config ว่ามีอะไรเปลี่ยนบ้าง ให้ revert กลับมาที่ default rpm ก่อน ** ระวัง</p><pre><span>rpmconf </span><span>-</span><span>a</span></pre><p>4) cleanup package ที่ซ้ำซ้อน</p><pre><span>package</span><span>-</span><span>cleanup </span><span>--</span><span>leaves\n</span><span>package</span><span>-</span><span>cleanup </span><span>--</span><span>orphans</span></pre><p>5) ติดตั้ง dnf แล้วลบ yum ทิ้ง (package manager ตัวใหม่ที่มาแทน yum)</p><pre><span>yum install dnf\ndnf </span><span>-</span><span>y remove yum yum</span><span>-</span><span>metadata</span><span>-</span><span>parser\nrm </span><span>-</span><span>Rf</span><span> </span><span>/</span><span>etc</span><span>/</span><span>yum</span></pre><p>6) upgrade package ทั้งหมดของ centos 7 ให้เป็น version ล่าสุด</p><pre><span>dnf upgrade</span></pre><p>7) ติดตั้ง centos release ของ centos 8 <u>ถ้าวันไหน centos 8 ออก update ก็ต้องแก้ version package ตาม</u></p><pre><span>dnf install \\\n    http</span><span>:</span><span>//mirror.centos.org/centos/8/BaseOS/x86_64/os/Packages/centos-repos-8.1-1.1911.0.8.el8.x86_64.rpm \\</span><span>\n    http</span><span>:</span><span>//mirror.centos.org/centos/8/BaseOS/x86_64/os/Packages/centos-gpg-keys-8.1-1.1911.0.8.el8.noarch.rpm \\</span><span>\n    http</span><span>:</span><span>//mirror.centos.org/centos/8/BaseOS/x86_64/os/Packages/centos-release-8.1-1.1911.0.8.el8.x86_64.rpm</span></pre><p>8) upgrade epel repository และ repository อื่นๆ ให้เป็น package ของ centos 8</p><pre><span>dnf </span><span>-</span><span>y upgrade https</span><span>:</span><span>//dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm</span></pre><p>** ถ้ามีใช้งาน repository ภายนอก เช่น remi ก็ไล่ upgrade release package ของแต่ละ repository ให้หมด<br>9) ลบ kernel เก่าของ centos 7 ออก</p><pre><span>rpm </span><span>-</span><span>e </span><span>`rpm -q kernel`</span></pre><p>10) ลบ conflict package ระหว่าง centos 7 กับ 8 (อาจมีอีก ถ้า error ตอน upgrade ในขั้นถัดไปก็มาไล่ลบ)</p><pre><span>rpm </span><span>-</span><span>e </span><span>--</span><span>nodeps sysvinit</span><span>-</span><span>tools</span></pre><p>11) <em>upgrade เป็น centos 8</em></p><pre><span>dnf </span><span>-</span><span>y </span><span>--</span><span>releasever</span><span>=</span><span>8</span><span> </span><span>--</span><span>allowerasing </span><span>--</span><span>setopt</span><span>=</span><span>deltarpm</span><span>=</span><span>false</span><span> distro</span><span>-</span><span>sync</span></pre><p>12) ติดตั้ง kernel ใหม่</p><pre><span>dnf </span><span>-</span><span>y install kernel</span><span>-</span><span>core</span></pre><p>13) ติดตั้ง package ใน group minimal ของ centos 8 เพิ่มให้ครบ</p><pre><span>dnf </span><span>-</span><span>y groupupdate </span><span>\"Core\"</span><span> </span><span>\"Minimal Install\"</span></pre><p>14) <strong>สำคัญมาก</strong> ตรวจสอบให้แน่ใจว่า SELINUX ปิดไปแล้ว (ในไฟล์ /etc/selinux/config)</p><p>เสร็จแล้วก็ reboot แล้วก็สวดภาวนาได้เลยครับ</p></div></div>","author":"icez","siteTitle":"icez network","siteHash":"88787adba55f9deb5660f47c4b8baf580eb765815e4a6d536737656e8ab8bde4","entryHash":"d27c250b26a39fccd9a26384fca0d9ccd6185b07e4ed1f6907666f82affca764","category":"Thai"}