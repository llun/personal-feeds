{"title":"GitOps คืออะไร","link":"https://www.somkiat.cc/gitops-flow/","date":1625734281000,"content":"<div id=\"readability-page-1\" class=\"page\"><div id=\"page\"><article><div id=\"content_box\"><header></header><div><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/07/gitops-1024x640.png\" alt=\"\" width=\"549\" height=\"343\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/07/gitops-1024x640.png 1024w, https://www.somkiat.cc/wp-content/uploads/2021/07/gitops-300x188.png 300w, https://www.somkiat.cc/wp-content/uploads/2021/07/gitops-768x480.png 768w, https://www.somkiat.cc/wp-content/uploads/2021/07/gitops-1536x960.png 1536w, https://www.somkiat.cc/wp-content/uploads/2021/07/gitops.png 1600w\" sizes=\"(max-width: 549px) 100vw, 549px\"></figure><p>หลังจากที่ใช้งานมาสักพักใหญ่ ๆ<br>ก็เลยมาอ่านที่มาที่ไปหน่อยว่า <strong><a href=\"https://www.weave.works/technologies/gitops/\" target=\"_blank\" rel=\"noreferrer noopener\">GitOps</a></strong> เป็นมาอย่างไร<br>จะนำมาจาก <strong><a href=\"https://www.gitops.tech/\" target=\"_blank\" rel=\"noreferrer noopener\">GitOps Tech</a></strong><br>โดย GitOps เริ่มมาตั้งแต่ปี 2017 จากบริษัท Weaveworks<br>ซึ่งมีการพูดคุยที่เยอะมาก ๆ<br>รวมทั้งทำให้เกิดความสับสน<br>จึงทำการสรุปไว้ในบทความข้างต้น<br>เพื่อให้เข้าใจตรงกัน</p><p><strong>GitOps คืออะไร</strong></p><div><p>เป็นรูปแบบหนึ่งของการสร้างระบบ Continuous Delivery (CD)<br>สำหรับ cloud native application<br>มีเป้าหมายหลักคือ developer-centric experience<br>นั่นคือใช้เครื่องมือที่ทีมพัฒนาถนัดหรือใช้งานอยู่แล้ว<br>ทั้ง Git และ CD tool ต่าง ๆ</p><p><strong>แนวคิดหลักคือ การเก็บสิ่งต่าง ๆ ที่จำเป็นต่อการสร้าง</strong></p></div><ul><li>Infrastructure</li><li>Environment</li><li>Automation process</li></ul><p>ไว้ใน Git repository<br>ดังนั้นถ้าต้องการ deploy ระบบงานใน version ใหม่<br>ก็เพียงทำการ update ข้อมูลใน Git repository เท่านั้น<br>จะ trigger ให้การทำงานแบบอัตโนมัติขึ้นมาตาม pipeline ที่กำหนดไว้</p><p><strong>ทำไมต้องใช้งาน GitOps</strong></p><ul><li>ง่ายต่อการ deploy ทำให้ deploy ได้เร็วและบ่อยขึ้น</li><li>เมื่อเกิดปัญหา สามารถ recovery กลับมาได้ง่ายและเร็วขึ้น (git revert)</li><li>ง่ายต่อการจัดการเรื่องของ credentail ต่าง ๆ เพราะว่า GitOps จะทำงานใน environment นั้น ๆ เลย ส่วนทีมพัฒนาไม่สามารถเข้าถึง environment ต่าง ๆ ได้</li><li>ทุก ๆ การเปลี่ยนแปลงจะอยู่ใน Git repository ทำให้เราเก็บ history ของการ deploy ไว้ได้ทั้งหมด ตอบโจทย์เรื่องของการ audit อย่างมาก และรู้ทั้งหมดว่าเกิดอะไรขึ้นบ้าง</li><li>สิ่งต่าง ๆ จะอยู๋ใน Git repository ทำให้สามารถ share ความรู้เกี่ยวกับการทำงานได้เลย ไม่ต้องกระโดดไปมาหลาย ๆ ที่ หลาย ๆ ระบบ</li></ul><p><strong>GitOps ทำงานอย่างไร</strong></p><p>เริ่มจากการทำงานจะทำงานผ่าน Git repository<br>แบ่งออกเป็น 2 repository คือ</p><ul><li><strong>application</strong> คือ source code ต่าง ๆ ของระบบงาน และ manifest file ต่าง ๆ ในการ deploy ระบบ</li><li><strong>environment configuration</strong> คือ configuration สำหรับการสร้าง infrastructure ของ environment ที่ใช้ deploy ระบบงาน เช่น messaging broker และ monitoring tool เป็นต้น รวมไปถึงเรื่องการจัดการ version อีกด้วย</li></ul><p><strong>การทำงานมีทั้งแบบ Push และ Pull deployment</strong></p><p><strong>Push deployment</strong></p><p>คือรูปแบบการทำงานปกติของ CI/CD tool ต่าง ๆ เช่น</p><ul><li>Jenkins</li><li>CircleCI</li><li>TravisCI</li><li>Cloud build ใน GKE</li></ul><p>การทำงานง่าย ๆ คือ<br>เมื่อ Git repository มีการเปลี่ยนแปลงก็จะ trigger ให้ pipeline ทำงาน<br>ไปจนถึง trigger ให้ทำการ deploy<br>มีขั้นตอนการทำงานดังรูป</p><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/07/push-1024x307.png\" alt=\"\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/07/push-1024x307.png 1024w, https://www.somkiat.cc/wp-content/uploads/2021/07/push-300x90.png 300w, https://www.somkiat.cc/wp-content/uploads/2021/07/push-768x230.png 768w, https://www.somkiat.cc/wp-content/uploads/2021/07/push-1536x461.png 1536w, https://www.somkiat.cc/wp-content/uploads/2021/07/push-2048x614.png 2048w\" sizes=\"(max-width: 1024px) 100vw, 1024px\"></figure><p><strong>ตัวอย่างการทำงานของ <a href=\"https://cloud.google.com/kubernetes-engine/docs/tutorials/gitops-cloud-build\" target=\"_blank\" rel=\"noreferrer noopener\">Google cloud build</a></strong></p><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/07/Screen-Shot-2564-07-08-at-15.46.46-1024x497.png\" alt=\"\" width=\"572\" height=\"277\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/07/Screen-Shot-2564-07-08-at-15.46.46-1024x497.png 1024w, https://www.somkiat.cc/wp-content/uploads/2021/07/Screen-Shot-2564-07-08-at-15.46.46-300x146.png 300w, https://www.somkiat.cc/wp-content/uploads/2021/07/Screen-Shot-2564-07-08-at-15.46.46-768x373.png 768w, https://www.somkiat.cc/wp-content/uploads/2021/07/Screen-Shot-2564-07-08-at-15.46.46-1536x745.png 1536w, https://www.somkiat.cc/wp-content/uploads/2021/07/Screen-Shot-2564-07-08-at-15.46.46.png 1542w\" sizes=\"(max-width: 572px) 100vw, 572px\"></figure><p><strong>Pull deployment</strong></p><div><p>มีความต่างตรงการ deploy<br>แทนที่จะทำการ trigger เพื่อ deploy เมื่อมีการเปลี่ยนแปลง<br>จะใช้แนวคิดของ <strong>operator</strong> เข้ามาช่วยในการทำงาน</p><p><strong>ซึ่ง Operator จะคอยเฝ้าดูว่า</strong><br>state หรือ version ของ environment repository<br>กับ state ของระบบที่ทำงาน deploy นั้น<br>เหมือนหรือต่างกันหรือไม่<br>ถ้าต่างกันก็จะทำการ deploy ให้ทันที</p><p>รวมทั้ง operator จะอยู่ใน enviroment เดียวกันกับการที่จะ deploy นั่นเอง<br>เพื่อลดปัญหาเรื่องของ permission แบบไม่ปกติ<br>จาก push deployment (God-mode !!)<br>อีกทั้งตัดปัญหาเรื่องการจัดการ credential ไปได้<br>แสดงดังรูป</p></div><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/07/pull-1024x300.png\" alt=\"\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/07/pull-1024x300.png 1024w, https://www.somkiat.cc/wp-content/uploads/2021/07/pull-300x88.png 300w, https://www.somkiat.cc/wp-content/uploads/2021/07/pull-768x225.png 768w, https://www.somkiat.cc/wp-content/uploads/2021/07/pull-1536x450.png 1536w, https://www.somkiat.cc/wp-content/uploads/2021/07/pull-2048x599.png 2048w\" sizes=\"(max-width: 1024px) 100vw, 1024px\"></figure><p><strong>และช่วยให้ง่ายต่อการ deploy ระบบงานในหลาย ๆ Enviroment อีกด้วย</strong></p><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/07/multiple-1024x270.png\" alt=\"\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/07/multiple-1024x270.png 1024w, https://www.somkiat.cc/wp-content/uploads/2021/07/multiple-300x79.png 300w, https://www.somkiat.cc/wp-content/uploads/2021/07/multiple-768x202.png 768w, https://www.somkiat.cc/wp-content/uploads/2021/07/multiple-1536x405.png 1536w, https://www.somkiat.cc/wp-content/uploads/2021/07/multiple-2048x540.png 2048w\" sizes=\"(max-width: 1024px) 100vw, 1024px\"></figure><p><strong>จากแนวคิดต่าง ๆ เหล่านี้ ทำให้เกิด implementation ต่าง ๆ ตามมา</strong></p><p>เช่น GitOps operator ใน Kubernetes cluster เช่น</p><ul><li><a href=\"https://argoproj.github.io/argo-cd/\" target=\"_blank\" rel=\"noreferrer noopener\">ArgoCD</a></li><li><a href=\"https://fluxcd.io/\" target=\"_blank\" rel=\"noreferrer noopener\">FluxCD</a></li><li><a href=\"https://www.jenkins.io/projects/jenkins-operator/\" target=\"_blank\" rel=\"noreferrer noopener\">Jenkins operator</a></li></ul><p><strong>ตัวอย่าง GitOps บน Kubernetes cluster ซึ่งเป็น Pull deployment</strong></p><figure><img src=\"https://www.somkiat.cc/wp-content/uploads/2021/07/demo-gitops-1024x671.png\" alt=\"\" srcset=\"https://www.somkiat.cc/wp-content/uploads/2021/07/demo-gitops-1024x671.png 1024w, https://www.somkiat.cc/wp-content/uploads/2021/07/demo-gitops-300x197.png 300w, https://www.somkiat.cc/wp-content/uploads/2021/07/demo-gitops-768x504.png 768w, https://www.somkiat.cc/wp-content/uploads/2021/07/demo-gitops.png 1400w\" sizes=\"(max-width: 1024px) 100vw, 1024px\"></figure><p><strong>DevOps คือการเปลี่ยน culture ขององค์กร เพื่อช่วยให้คนทำงานร่วมกันได้ดีขึ้น</strong></p><p>ส่วน GitOps คือเทคนิคในการสร้างระบบ Continuous Delivery<br>โดยทั้งคู่จะมีแนวคิดเหมือนกันคือ</p><ul><li>Automation process</li><li>Self-service infrastructure</li></ul><p>ดังนั้นการสร้าง GitOps workflow จะง่ายขึ้นเมื่อนำ DevOps มาปรับใช้งานแล้ว</p></div><div><p><img alt=\"\" src=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=90&amp;d=mm&amp;r=g\" srcset=\"https://secure.gravatar.com/avatar/e5cb9aad7bf4f0e43462bd51d6ff7021?s=180&amp;d=mm&amp;r=g 2x\" height=\"90\" width=\"90\"></p><h4>Article by <a href=\"https://www.facebook.com/somkiatspns\">Somkiat Puisungnoen</a></h4><p>To be Craftmanship</p></div></div></article></div></div>","author":"somkiat","siteTitle":"cc :: somkiat","siteHash":"3a23a5a4389e1e40c6fbb16520a8cc20df5b3591c25145ce72aaa18b19e48201","entryHash":"922d5efb3bbfa10603259be2017fc24c16dabb3fa2f7f60eb71e6acbc75b0dbf","category":"Thai"}